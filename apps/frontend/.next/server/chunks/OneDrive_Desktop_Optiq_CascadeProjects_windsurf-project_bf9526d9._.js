module.exports=[25881,(e,i,t)=>{"use strict";i.exports=e.r(13493).vendored["react-rsc"].ReactServerDOMTurbopackServer},86040,(e,i,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"registerServerReference",{enumerable:!0,get:function(){return n.registerServerReference}});let n=e.r(25881)},67650,(e,i,t)=>{"use strict";function n(e){for(let i=0;i<e.length;i++){let t=e[i];if("function"!=typeof t)throw Object.defineProperty(Error(`A "use server" file can only export async functions, found ${typeof t}.
Read more: https://nextjs.org/docs/messages/invalid-use-server-value`),"__NEXT_ERROR_CODE",{value:"E352",enumerable:!1,configurable:!0})}}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"ensureServerEntryExports",{enumerable:!0,get:function(){return n}})},38478,39063,12329,e=>{"use strict";e.i(55007);var i=e.i(60806);let t={spendThresholdMicros:BigInt(5e7),targetCpaMicros:BigInt(25e6),cpaTolerancePercent:50,minImpressions:1e3,minCtrPercent:.5,rollingWindowDays:7};function n(e){return Number(e)/1e6}function s(e,i){return i===BigInt(0)?null:Number(e)/Number(i)}function r(e,i){return i===BigInt(0)?0:Number(e)/Number(i)*100}function o(e,i,t){let s=n(e),r=n(i.spendThresholdMicros);if("zero_conversions_high_spend"===t)return s>=5*r?"critical":s>=2*r?"high":s>=r?"medium":"low";if("cpa_above_target"===t){if(s>=3*r)return"high";if(s>=r)return"medium"}return"low"}function a(e,i){let t=i??new Date;t.setHours(23,59,59,999);let n=new Date(t);return n.setDate(n.getDate()-e+1),n.setHours(0,0,0,0),{start:n,end:t,days:e}}function c(e,i,t,n){let s=n.toISOString().split("T")[0];return`${e}_${i}_${t}_${s}`}function d(e,i){switch(e){case"zero_conversions_high_spend":return`Consider pausing this ${i.entityType.replace("_"," ")} or reviewing targeting. Spent $${n(i.spendMicros).toFixed(2)} with no conversions.`;case"cpa_above_target":let t=s(i.spendMicros,i.conversions);return`CPA of $${t?.toFixed(2)??"N/A"} exceeds target. Review ad creative, landing page, or audience targeting.`;case"low_ctr_high_spend":let o=r(i.clicks,i.impressions);return`CTR of ${o.toFixed(2)}% is below threshold. Consider refreshing creative or adjusting targeting.`;case"declining_performance":return"Performance has declined over the analysis period. Review recent changes and consider optimization.";default:return`Review this ${i.entityType.replace("_"," ")} for potential optimization opportunities.`}}e.s(["DEFAULT_WASTE_CONFIG",0,t,"computeCpa",()=>s,"computeCtr",()=>r,"determineWasteLevel",()=>o,"microsToDollars",()=>n],39063);class p{config;constructor(e={}){this.config={...t,...e}}async evaluateOrganization(e){let i=a(e.windowDays??this.config.rollingWindowDays,e.endDate),[t,n,s]=await Promise.all([this.evaluateAdAccounts(e.organizationId,i),this.evaluateCampaigns(e.organizationId,i),this.evaluateAds(e.organizationId,i)]),r=[...t,...n,...s],o=r.reduce((e,i)=>e+i.spendMicros,BigInt(0)),c={none:0,low:0,medium:0,high:0,critical:0},d={zero_conversions_high_spend:0,cpa_above_target:0,low_ctr_high_spend:0,declining_performance:0},p={ad_account:0,campaign:0,ad:0};for(let e of r)c[e.level]++,d[e.reason]++,p[e.entityType]++;return{organizationId:e.organizationId,windowStart:i.start,windowEnd:i.end,totalWastedSpendMicros:o,alerts:r,byLevel:c,byReason:d,byEntityType:p}}async evaluateAdAccounts(e,t){let n=await i.prisma.dailyAdAccountMetric.groupBy({by:["adAccountId"],where:{organizationId:e,date:{gte:t.start,lte:t.end}},_sum:{impressions:!0,clicks:!0,spendMicros:!0,conversions:!0,revenueMicros:!0}}),s=[];for(let r of n){let n=await i.prisma.adAccount.findUnique({where:{id:r.adAccountId},select:{id:!0,name:!0,platform:{select:{code:!0}}}});if(!n)continue;let o={entityId:r.adAccountId,entityName:n.name,entityType:"ad_account",platformCode:n.platform.code,impressions:r._sum.impressions??BigInt(0),clicks:r._sum.clicks??BigInt(0),spendMicros:r._sum.spendMicros??BigInt(0),conversions:r._sum.conversions??BigInt(0),revenueMicros:r._sum.revenueMicros??BigInt(0)},a=this.detectWaste(o,t,e);s.push(...a)}return s}async evaluateCampaigns(e,t){let n=await i.prisma.dailyCampaignMetric.groupBy({by:["campaignId"],where:{organizationId:e,date:{gte:t.start,lte:t.end}},_sum:{impressions:!0,clicks:!0,spendMicros:!0,conversions:!0,revenueMicros:!0}}),s=[];for(let r of n){let n=await i.prisma.campaign.findUnique({where:{id:r.campaignId},select:{id:!0,name:!0,platform:{select:{code:!0}}}});if(!n)continue;let o={entityId:r.campaignId,entityName:n.name,entityType:"campaign",platformCode:n.platform.code,impressions:r._sum.impressions??BigInt(0),clicks:r._sum.clicks??BigInt(0),spendMicros:r._sum.spendMicros??BigInt(0),conversions:r._sum.conversions??BigInt(0),revenueMicros:r._sum.revenueMicros??BigInt(0)},a=this.detectWaste(o,t,e);s.push(...a)}return s}async evaluateAds(e,t){let n=await i.prisma.dailyAdMetric.groupBy({by:["adId"],where:{organizationId:e,date:{gte:t.start,lte:t.end}},_sum:{impressions:!0,clicks:!0,spendMicros:!0,conversions:!0,revenueMicros:!0}}),s=[];for(let r of n){let n=await i.prisma.ad.findUnique({where:{id:r.adId},select:{id:!0,name:!0,platform:{select:{code:!0}}}});if(!n)continue;let o={entityId:r.adId,entityName:n.name??`Ad ${r.adId}`,entityType:"ad",platformCode:n.platform.code,impressions:r._sum.impressions??BigInt(0),clicks:r._sum.clicks??BigInt(0),spendMicros:r._sum.spendMicros??BigInt(0),conversions:r._sum.conversions??BigInt(0),revenueMicros:r._sum.revenueMicros??BigInt(0)},a=this.detectWaste(o,t,e);s.push(...a)}return s}detectWaste(e,i,t){let r=[];if(e.spendMicros>=this.config.spendThresholdMicros&&e.conversions===BigInt(0)){let s="zero_conversions_high_spend",a=o(e.spendMicros,this.config,s);r.push({id:c(e.entityType,e.entityId,s,i.end),entityType:e.entityType,entityId:e.entityId,entityName:e.entityName,organizationId:t,platformCode:e.platformCode,reason:s,level:a,spendMicros:e.spendMicros,conversions:0,cpa:null,targetCpa:n(this.config.targetCpaMicros),windowStart:i.start,windowEnd:i.end,message:`${e.entityName} spent $${n(e.spendMicros).toFixed(2)} with zero conversions in the last ${i.days} days.`,recommendation:d(s,e)})}if(e.conversions>BigInt(0)){let a=s(e.spendMicros,e.conversions),p=n(this.config.targetCpaMicros),u=p*(1+this.config.cpaTolerancePercent/100);if(null!==a&&a>1e6*u){let n="cpa_above_target",s=o(e.spendMicros,this.config,n),u=e.spendMicros-BigInt(Math.round(1e6*p*Number(e.conversions)));r.push({id:c(e.entityType,e.entityId,n,i.end),entityType:e.entityType,entityId:e.entityId,entityName:e.entityName,organizationId:t,platformCode:e.platformCode,reason:n,level:s,spendMicros:u>BigInt(0)?u:e.spendMicros,conversions:Number(e.conversions),cpa:a/1e6,targetCpa:p,windowStart:i.start,windowEnd:i.end,message:`${e.entityName} has CPA of $${(a/1e6).toFixed(2)} vs target of $${p.toFixed(2)} (${((a/1e6/p-1)*100).toFixed(0)}% over).`,recommendation:d(n,e)})}}return r}async evaluateCampaign(e){let t=a(e.windowDays??this.config.rollingWindowDays,e.endDate),n=await i.prisma.dailyCampaignMetric.aggregate({where:{organizationId:e.organizationId,campaignId:e.campaignId,date:{gte:t.start,lte:t.end}},_sum:{impressions:!0,clicks:!0,spendMicros:!0,conversions:!0,revenueMicros:!0}}),s=await i.prisma.campaign.findUnique({where:{id:e.campaignId},select:{id:!0,name:!0,platform:{select:{code:!0}}}});if(!s)return[];let r={entityId:e.campaignId,entityName:s.name,entityType:"campaign",platformCode:s.platform.code,impressions:n._sum.impressions??BigInt(0),clicks:n._sum.clicks??BigInt(0),spendMicros:n._sum.spendMicros??BigInt(0),conversions:n._sum.conversions??BigInt(0),revenueMicros:n._sum.revenueMicros??BigInt(0)};return this.detectWaste(r,t,e.organizationId)}async evaluateAd(e){let t=a(e.windowDays??this.config.rollingWindowDays,e.endDate),n=await i.prisma.dailyAdMetric.aggregate({where:{organizationId:e.organizationId,adId:e.adId,date:{gte:t.start,lte:t.end}},_sum:{impressions:!0,clicks:!0,spendMicros:!0,conversions:!0,revenueMicros:!0}}),s=await i.prisma.ad.findUnique({where:{id:e.adId},select:{id:!0,name:!0,platform:{select:{code:!0}}}});if(!s)return[];let r={entityId:e.adId,entityName:s.name??`Ad ${e.adId}`,entityType:"ad",platformCode:s.platform.code,impressions:n._sum.impressions??BigInt(0),clicks:n._sum.clicks??BigInt(0),spendMicros:n._sum.spendMicros??BigInt(0),conversions:n._sum.conversions??BigInt(0),revenueMicros:n._sum.revenueMicros??BigInt(0)};return this.detectWaste(r,t,e.organizationId)}getConfig(){return{...this.config}}withConfig(e){return new p({...this.config,...e})}}let u=new p;e.s(["wasteEvaluator",0,u],12329),e.s([],38478)}];

//# sourceMappingURL=OneDrive_Desktop_Optiq_CascadeProjects_windsurf-project_bf9526d9._.js.map