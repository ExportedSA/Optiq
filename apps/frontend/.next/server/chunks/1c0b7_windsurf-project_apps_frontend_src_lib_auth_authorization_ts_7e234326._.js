module.exports=[94238,e=>{"use strict";e.i(55007);var r=e.i(68050),t=e.i(70081),a=e.i(16336),n=e.i(60806);let i={VIEWER:["org:read","connectors:read","campaigns:read","tracking:read","journeys:read","alerts:read","settings:read","reports:read"],MEMBER:["org:read","connectors:read","campaigns:read","tracking:read","journeys:read","alerts:read","settings:read","reports:read","campaigns:create","campaigns:update","tracking:create","tracking:update","journeys:create","journeys:update","alerts:create","alerts:update","alerts:acknowledge","reports:export"],ADMIN:["org:read","connectors:read","campaigns:read","tracking:read","journeys:read","alerts:read","settings:read","reports:read","campaigns:create","campaigns:update","tracking:create","tracking:update","journeys:create","journeys:update","alerts:create","alerts:update","alerts:acknowledge","reports:export","org:update","org:manage_members","connectors:create","connectors:update","connectors:delete","campaigns:delete","tracking:delete","journeys:delete","alerts:delete","settings:update","api_keys:read","api_keys:create","api_keys:delete"],OWNER:["org:read","org:update","org:delete","org:manage_billing","org:manage_members","org:transfer_ownership","connectors:read","connectors:create","connectors:update","connectors:delete","campaigns:read","campaigns:create","campaigns:update","campaigns:delete","tracking:read","tracking:create","tracking:update","tracking:delete","journeys:read","journeys:create","journeys:update","journeys:delete","alerts:read","alerts:create","alerts:update","alerts:delete","alerts:acknowledge","settings:read","settings:update","reports:read","reports:export","api_keys:read","api_keys:create","api_keys:delete"]},o=["VIEWER","MEMBER","ADMIN","OWNER"];function s(e,r){let t=i[e];return t?.includes(r)??!1}async function c(){let e=await (0,r.getServerSession)(a.authOptions);if(!e?.user?.id||!e?.user?.activeOrgId)return null;let t=await n.prisma.membership.findUnique({where:{userId_organizationId:{userId:e.user.id,organizationId:e.user.activeOrgId}},select:{role:!0}});return t?{userId:e.user.id,organizationId:e.user.activeOrgId,role:t.role,email:e.user.email??""}:null}async function u(){let e=await c();return e?{authorized:!0,context:e}:{authorized:!1,error:"Authentication required",status:401}}async function d(e){let r=await u();return r.authorized&&r.context?s(r.context.role,e)?r:{authorized:!1,context:r.context,error:`Permission denied: ${e}`,status:403}:r}async function g(e){var r;let t=await u();return t.authorized&&t.context?(r=t.context.role,e.some(e=>s(r,e)))?t:{authorized:!1,context:t.context,error:`Permission denied: requires one of ${e.join(", ")}`,status:403}:t}async function l(e){var r;let t=await u();return t.authorized&&t.context?(r=t.context.role,o.indexOf(r)>=o.indexOf(e))?t:{authorized:!1,context:t.context,error:`Role ${e} or higher required`,status:403}:t}function p(e){return t.NextResponse.json({error:e.error??"Unauthorized"},{status:e.status??403})}async function m(e,r,t){switch(r){case"adAccount":return y(e.organizationId,t);case"campaign":return h(e.organizationId,t);case"trackingSite":return f(e.organizationId,t);case"alertRule":return w(e.organizationId,t);case"journey":return k(e.organizationId,t);default:return!1}}async function y(e,r){return await n.prisma.adAccount.count({where:{id:r,organizationId:e}})>0}async function h(e,r){return await n.prisma.campaign.count({where:{id:r,organizationId:e}})>0}async function f(e,r){return await n.prisma.trackingSite.count({where:{id:r,organizationId:e}})>0}async function w(e,r){return await n.prisma.alertRule.count({where:{id:r,organizationId:e}})>0}async function k(e,r){return await n.prisma.journey.count({where:{id:r,organizationId:e}})>0}function I(e,r){return{...r,organizationId:e.organizationId}}async function x(e,r){let t=await n.prisma.membership.findUnique({where:{userId_organizationId:{userId:e,organizationId:r}},select:{role:!0}});return t?{isMember:!0,role:t.role}:{isMember:!1}}e.s(["authErrorResponse",()=>p,"getAuthContext",()=>c,"requireAnyPermission",()=>g,"requireAuth",()=>u,"requirePermission",()=>d,"requireRole",()=>l,"scopedWhere",()=>I,"verifyMembership",()=>x,"verifyResourceOwnership",()=>m],94238)}];

//# sourceMappingURL=1c0b7_windsurf-project_apps_frontend_src_lib_auth_authorization_ts_7e234326._.js.map