module.exports=[42797,e=>{e.v({name:"openid-client",version:"5.7.1",description:"OpenID Connect Relying Party (RP, Client) implementation for Node.js runtime, supports passportjs",keywords:["auth","authentication","basic","certified","client","connect","dynamic","electron","hybrid","identity","implicit","oauth","oauth2","oidc","openid","passport","relying party","strategy"],homepage:"https://github.com/panva/openid-client",repository:"panva/openid-client",funding:{url:"https://github.com/sponsors/panva"},license:"MIT",author:"Filip Skokan <panva.ip@gmail.com>",exports:{types:"./types/index.d.ts",import:"./lib/index.mjs",require:"./lib/index.js"},main:"./lib/index.js",types:"./types/index.d.ts",files:["lib","types/index.d.ts"],scripts:{format:"npx prettier --loglevel silent --write ./lib ./test ./certification ./types",test:"mocha test/**/*.test.js"},dependencies:{jose:"^4.15.9","lru-cache":"^6.0.0","object-hash":"^2.2.0","oidc-token-hash":"^5.0.3"},devDependencies:{"@types/node":"^16.18.106","@types/passport":"^1.0.16",base64url:"^3.0.1",chai:"^4.5.0",mocha:"^10.7.3",nock:"^13.5.5",prettier:"^2.8.8","readable-mock-req":"^0.2.2",sinon:"^9.2.4",timekeeper:"^2.3.1"},"standard-version":{scripts:{postchangelog:"sed -i '' -e 's/### \\[/## [/g' CHANGELOG.md"},types:[{type:"feat",section:"Features"},{type:"fix",section:"Fixes"},{type:"chore",hidden:!0},{type:"docs",hidden:!0},{type:"style",hidden:!0},{type:"refactor",section:"Refactor",hidden:!1},{type:"perf",section:"Performance",hidden:!1},{type:"test",hidden:!0}]}})},24361,(e,r,t)=>{r.exports=e.x("util",()=>require("util"))},14747,(e,r,t)=>{r.exports=e.x("path",()=>require("path"))},54799,(e,r,t)=>{r.exports=e.x("crypto",()=>require("crypto"))},92509,(e,r,t)=>{r.exports=e.x("url",()=>require("url"))},49719,(e,r,t)=>{r.exports=e.x("assert",()=>require("assert"))},874,(e,r,t)=>{r.exports=e.x("buffer",()=>require("buffer"))},27699,(e,r,t)=>{r.exports=e.x("events",()=>require("events"))},62562,(e,r,t)=>{r.exports=e.x("module",()=>require("module"))},50227,(e,r,t)=>{r.exports=e.x("node:path",()=>require("node:path"))},48934,e=>{e.v({name:"thread-stream",version:"3.1.0",description:"A streaming way to send data to a Node.js Worker Thread",main:"index.js",types:"index.d.ts",dependencies:{"real-require":"^0.2.0"},devDependencies:{"@types/node":"^20.1.0","@types/tap":"^15.0.0","@yao-pkg/pkg":"^5.11.5",desm:"^1.3.0",fastbench:"^1.0.1",husky:"^9.0.6","pino-elasticsearch":"^8.0.0","sonic-boom":"^4.0.1",standard:"^17.0.0",tap:"^16.2.0","ts-node":"^10.8.0",typescript:"^5.3.2","why-is-node-running":"^2.2.2"},scripts:{build:"tsc --noEmit",test:'standard && npm run build && npm run transpile && tap "test/**/*.test.*js" && tap --ts test/*.test.*ts',"test:ci":"standard && npm run transpile && npm run test:ci:js && npm run test:ci:ts","test:ci:js":'tap --no-check-coverage --timeout=120 --coverage-report=lcovonly "test/**/*.test.*js"',"test:ci:ts":'tap --ts --no-check-coverage --coverage-report=lcovonly "test/**/*.test.*ts"',"test:yarn":'npm run transpile && tap "test/**/*.test.js" --no-check-coverage',transpile:"sh ./test/ts/transpile.sh",prepare:"husky install"},standard:{ignore:["test/ts/**/*","test/syntax-error.mjs"]},repository:{type:"git",url:"git+https://github.com/mcollina/thread-stream.git"},keywords:["worker","thread","threads","stream"],author:"Matteo Collina <hello@matteocollina.com>",license:"MIT",bugs:{url:"https://github.com/mcollina/thread-stream/issues"},homepage:"https://github.com/mcollina/thread-stream#readme"})},37702,(e,r,t)=>{r.exports=e.x("worker_threads",()=>require("worker_threads"))},60526,(e,r,t)=>{r.exports=e.x("node:os",()=>require("node:os"))},87769,(e,r,t)=>{r.exports=e.x("node:events",()=>require("node:events"))},77652,(e,r,t)=>{r.exports=e.x("node:diagnostics_channel",()=>require("node:diagnostics_channel"))},22734,(e,r,t)=>{r.exports=e.x("fs",()=>require("fs"))},21517,(e,r,t)=>{r.exports=e.x("http",()=>require("http"))},45706,(e,r,t)=>{r.exports=e.x("querystring",()=>require("querystring"))},6461,(e,r,t)=>{r.exports=e.x("zlib",()=>require("zlib"))},24836,(e,r,t)=>{r.exports=e.x("https",()=>require("https"))},46069,(e,r,t)=>{r.exports=e.x("argon2",()=>require("argon2"))},80608,e=>{"use strict";var r=e.i(46989);e.i(1466);var t=e.i(37966);let s=r.z.object({APP_ENV:t.AppEnvSchema.default("development"),NODE_ENV:r.z.enum(["development","production","test"]).default("development"),DATABASE_URL:r.z.string().url().describe("PostgreSQL connection string"),NEXTAUTH_SECRET:r.z.string().min(32).describe("Secret for NextAuth session encryption (min 32 chars)"),NEXTAUTH_URL:r.z.string().url().optional().describe("Canonical URL of your site"),DATA_ENCRYPTION_KEY:r.z.string().min(32).describe("AES-256 key for encrypting sensitive data (32+ chars)"),GOOGLE_OAUTH_CLIENT_ID:r.z.string().min(1).describe("Google OAuth 2.0 Client ID"),GOOGLE_OAUTH_CLIENT_SECRET:r.z.string().min(1).describe("Google OAuth 2.0 Client Secret"),GOOGLE_OAUTH_REDIRECT_URI:r.z.string().url().describe("OAuth redirect URI for Google"),GOOGLE_ADS_DEVELOPER_TOKEN:r.z.string().min(1).describe("Google Ads API Developer Token"),GOOGLE_ADS_LOGIN_CUSTOMER_ID:r.z.string().min(1).optional().describe("Google Ads Manager Account ID (optional)"),META_APP_ID:r.z.string().min(1).describe("Meta App ID"),META_APP_SECRET:r.z.string().min(1).describe("Meta App Secret"),META_OAUTH_REDIRECT_URI:r.z.string().url().describe("OAuth redirect URI for Meta"),META_API_VERSION:r.z.string().min(1).default("v20.0").describe("Meta Graph API version"),TIKTOK_APP_ID:r.z.string().min(1).describe("TikTok App ID"),TIKTOK_APP_SECRET:r.z.string().min(1).describe("TikTok App Secret"),TIKTOK_OAUTH_REDIRECT_URI:r.z.string().url().describe("OAuth redirect URI for TikTok"),TIKTOK_API_BASE_URL:r.z.string().url().default("https://business-api.tiktok.com").describe("TikTok Business API base URL"),SMTP_HOST:r.z.string().optional().describe("SMTP server hostname"),SMTP_PORT:r.z.coerce.number().int().min(1).max(65535).optional().describe("SMTP server port"),SMTP_USER:r.z.string().optional().describe("SMTP username"),SMTP_PASSWORD:r.z.string().optional().describe("SMTP password"),SMTP_FROM_EMAIL:r.z.string().email().optional().describe("From email address for notifications"),SMTP_FROM_NAME:r.z.string().optional().describe("From name for notifications")}),n=(0,t.loadEnv)(s,{APP_ENV:process.env.APP_ENV,NODE_ENV:"production",DATABASE_URL:process.env.DATABASE_URL,NEXTAUTH_SECRET:process.env.NEXTAUTH_SECRET,NEXTAUTH_URL:process.env.NEXTAUTH_URL,DATA_ENCRYPTION_KEY:process.env.DATA_ENCRYPTION_KEY,GOOGLE_OAUTH_CLIENT_ID:process.env.GOOGLE_OAUTH_CLIENT_ID,GOOGLE_OAUTH_CLIENT_SECRET:process.env.GOOGLE_OAUTH_CLIENT_SECRET,GOOGLE_OAUTH_REDIRECT_URI:process.env.GOOGLE_OAUTH_REDIRECT_URI,GOOGLE_ADS_DEVELOPER_TOKEN:process.env.GOOGLE_ADS_DEVELOPER_TOKEN,GOOGLE_ADS_LOGIN_CUSTOMER_ID:process.env.GOOGLE_ADS_LOGIN_CUSTOMER_ID,META_APP_ID:process.env.META_APP_ID,META_APP_SECRET:process.env.META_APP_SECRET,META_OAUTH_REDIRECT_URI:process.env.META_OAUTH_REDIRECT_URI,META_API_VERSION:process.env.META_API_VERSION,TIKTOK_APP_ID:process.env.TIKTOK_APP_ID,TIKTOK_APP_SECRET:process.env.TIKTOK_APP_SECRET,TIKTOK_OAUTH_REDIRECT_URI:process.env.TIKTOK_OAUTH_REDIRECT_URI,TIKTOK_API_BASE_URL:process.env.TIKTOK_API_BASE_URL,SMTP_HOST:process.env.SMTP_HOST,SMTP_PORT:process.env.SMTP_PORT,SMTP_USER:process.env.SMTP_USER,SMTP_PASSWORD:process.env.SMTP_PASSWORD,SMTP_FROM_EMAIL:process.env.SMTP_FROM_EMAIL,SMTP_FROM_NAME:process.env.SMTP_FROM_NAME},{redactKeys:["DATABASE_URL","NEXTAUTH_SECRET","DATA_ENCRYPTION_KEY","GOOGLE_OAUTH_CLIENT_SECRET","GOOGLE_ADS_DEVELOPER_TOKEN","META_APP_SECRET","TIKTOK_APP_SECRET","SMTP_PASSWORD"]}),i={...n,...(0,t.buildEnvMeta)(n.APP_ENV)};e.s(["env",0,i])},4587,e=>{"use strict";e.i(55007);var r=e.i(46069);async function t(e){return r.default.hash(e,{type:r.default.argon2id})}async function s(e,t){return r.default.verify(e,t)}e.s(["hashPassword",()=>t,"verifyPassword",()=>s])},94238,e=>{"use strict";e.i(55007);var r=e.i(68050),t=e.i(70081),s=e.i(16336),n=e.i(60806);let i={VIEWER:["org:read","connectors:read","campaigns:read","tracking:read","journeys:read","alerts:read","settings:read","reports:read"],MEMBER:["org:read","connectors:read","campaigns:read","tracking:read","journeys:read","alerts:read","settings:read","reports:read","campaigns:create","campaigns:update","tracking:create","tracking:update","journeys:create","journeys:update","alerts:create","alerts:update","alerts:acknowledge","reports:export"],ADMIN:["org:read","connectors:read","campaigns:read","tracking:read","journeys:read","alerts:read","settings:read","reports:read","campaigns:create","campaigns:update","tracking:create","tracking:update","journeys:create","journeys:update","alerts:create","alerts:update","alerts:acknowledge","reports:export","org:update","org:manage_members","connectors:create","connectors:update","connectors:delete","campaigns:delete","tracking:delete","journeys:delete","alerts:delete","settings:update","api_keys:read","api_keys:create","api_keys:delete"],OWNER:["org:read","org:update","org:delete","org:manage_billing","org:manage_members","org:transfer_ownership","connectors:read","connectors:create","connectors:update","connectors:delete","campaigns:read","campaigns:create","campaigns:update","campaigns:delete","tracking:read","tracking:create","tracking:update","tracking:delete","journeys:read","journeys:create","journeys:update","journeys:delete","alerts:read","alerts:create","alerts:update","alerts:delete","alerts:acknowledge","settings:read","settings:update","reports:read","reports:export","api_keys:read","api_keys:create","api_keys:delete"]},a=["VIEWER","MEMBER","ADMIN","OWNER"];function o(e,r){let t=i[e];return t?.includes(r)??!1}async function c(){let e=await (0,r.getServerSession)(s.authOptions);if(!e?.user?.id||!e?.user?.activeOrgId)return null;let t=await n.prisma.membership.findUnique({where:{userId_organizationId:{userId:e.user.id,organizationId:e.user.activeOrgId}},select:{role:!0}});return t?{userId:e.user.id,organizationId:e.user.activeOrgId,role:t.role,email:e.user.email??""}:null}async function d(){let e=await c();return e?{authorized:!0,context:e}:{authorized:!1,error:"Authentication required",status:401}}async function p(e){let r=await d();return r.authorized&&r.context?o(r.context.role,e)?r:{authorized:!1,context:r.context,error:`Permission denied: ${e}`,status:403}:r}async function u(e){var r;let t=await d();return t.authorized&&t.context?(r=t.context.role,e.some(e=>o(r,e)))?t:{authorized:!1,context:t.context,error:`Permission denied: requires one of ${e.join(", ")}`,status:403}:t}async function _(e){var r;let t=await d();return t.authorized&&t.context?(r=t.context.role,a.indexOf(r)>=a.indexOf(e))?t:{authorized:!1,context:t.context,error:`Role ${e} or higher required`,status:403}:t}function l(e){return t.NextResponse.json({error:e.error??"Unauthorized"},{status:e.status??403})}async function E(e,r,t){switch(r){case"adAccount":return T(e.organizationId,t);case"campaign":return g(e.organizationId,t);case"trackingSite":return A(e.organizationId,t);case"alertRule":return m(e.organizationId,t);case"journey":return O(e.organizationId,t);default:return!1}}async function T(e,r){return await n.prisma.adAccount.count({where:{id:r,organizationId:e}})>0}async function g(e,r){return await n.prisma.campaign.count({where:{id:r,organizationId:e}})>0}async function A(e,r){return await n.prisma.trackingSite.count({where:{id:r,organizationId:e}})>0}async function m(e,r){return await n.prisma.alertRule.count({where:{id:r,organizationId:e}})>0}async function O(e,r){return await n.prisma.journey.count({where:{id:r,organizationId:e}})>0}function h(e,r){return{...r,organizationId:e.organizationId}}async function I(e,r){let t=await n.prisma.membership.findUnique({where:{userId_organizationId:{userId:e,organizationId:r}},select:{role:!0}});return t?{isMember:!0,role:t.role}:{isMember:!1}}e.s(["authErrorResponse",()=>l,"getAuthContext",()=>c,"requireAnyPermission",()=>u,"requireAuth",()=>d,"requirePermission",()=>p,"requireRole",()=>_,"scopedWhere",()=>h,"verifyMembership",()=>I,"verifyResourceOwnership",()=>E],94238)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__16a2f6e0._.js.map