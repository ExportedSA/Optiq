{"version":3,"sources":["turbopack:///[project]/OneDrive/Desktop/Optiq/CascadeProjects/windsurf-project/node_modules/openid-client/package.json","turbopack:///[project]/OneDrive/Desktop/Optiq/CascadeProjects/windsurf-project/node_modules/thread-stream/package.json","../../../../../../../../../../OneDrive/Desktop/Optiq/CascadeProjects/windsurf-project/apps/frontend/src/lib/env.ts","../../../../../../../../../../OneDrive/Desktop/Optiq/CascadeProjects/windsurf-project/apps/frontend/src/lib/password.ts","../../../../../../../../../../OneDrive/Desktop/Optiq/CascadeProjects/windsurf-project/apps/frontend/src/lib/auth/authorization.ts","../../../../../../../../../../OneDrive/Desktop/Optiq/CascadeProjects/windsurf-project/apps/frontend/src/lib/auth/rbac.ts"],"sourcesContent":["{\"name\":\"openid-client\",\"version\":\"5.7.1\",\"description\":\"OpenID Connect Relying Party (RP, Client) implementation for Node.js runtime, supports passportjs\",\"keywords\":[\"auth\",\"authentication\",\"basic\",\"certified\",\"client\",\"connect\",\"dynamic\",\"electron\",\"hybrid\",\"identity\",\"implicit\",\"oauth\",\"oauth2\",\"oidc\",\"openid\",\"passport\",\"relying party\",\"strategy\"],\"homepage\":\"https://github.com/panva/openid-client\",\"repository\":\"panva/openid-client\",\"funding\":{\"url\":\"https://github.com/sponsors/panva\"},\"license\":\"MIT\",\"author\":\"Filip Skokan <panva.ip@gmail.com>\",\"exports\":{\"types\":\"./types/index.d.ts\",\"import\":\"./lib/index.mjs\",\"require\":\"./lib/index.js\"},\"main\":\"./lib/index.js\",\"types\":\"./types/index.d.ts\",\"files\":[\"lib\",\"types/index.d.ts\"],\"scripts\":{\"format\":\"npx prettier --loglevel silent --write ./lib ./test ./certification ./types\",\"test\":\"mocha test/**/*.test.js\"},\"dependencies\":{\"jose\":\"^4.15.9\",\"lru-cache\":\"^6.0.0\",\"object-hash\":\"^2.2.0\",\"oidc-token-hash\":\"^5.0.3\"},\"devDependencies\":{\"@types/node\":\"^16.18.106\",\"@types/passport\":\"^1.0.16\",\"base64url\":\"^3.0.1\",\"chai\":\"^4.5.0\",\"mocha\":\"^10.7.3\",\"nock\":\"^13.5.5\",\"prettier\":\"^2.8.8\",\"readable-mock-req\":\"^0.2.2\",\"sinon\":\"^9.2.4\",\"timekeeper\":\"^2.3.1\"},\"standard-version\":{\"scripts\":{\"postchangelog\":\"sed -i '' -e 's/### \\\\[/## [/g' CHANGELOG.md\"},\"types\":[{\"type\":\"feat\",\"section\":\"Features\"},{\"type\":\"fix\",\"section\":\"Fixes\"},{\"type\":\"chore\",\"hidden\":true},{\"type\":\"docs\",\"hidden\":true},{\"type\":\"style\",\"hidden\":true},{\"type\":\"refactor\",\"section\":\"Refactor\",\"hidden\":false},{\"type\":\"perf\",\"section\":\"Performance\",\"hidden\":false},{\"type\":\"test\",\"hidden\":true}]}}","{\"name\":\"thread-stream\",\"version\":\"3.1.0\",\"description\":\"A streaming way to send data to a Node.js Worker Thread\",\"main\":\"index.js\",\"types\":\"index.d.ts\",\"dependencies\":{\"real-require\":\"^0.2.0\"},\"devDependencies\":{\"@types/node\":\"^20.1.0\",\"@types/tap\":\"^15.0.0\",\"@yao-pkg/pkg\":\"^5.11.5\",\"desm\":\"^1.3.0\",\"fastbench\":\"^1.0.1\",\"husky\":\"^9.0.6\",\"pino-elasticsearch\":\"^8.0.0\",\"sonic-boom\":\"^4.0.1\",\"standard\":\"^17.0.0\",\"tap\":\"^16.2.0\",\"ts-node\":\"^10.8.0\",\"typescript\":\"^5.3.2\",\"why-is-node-running\":\"^2.2.2\"},\"scripts\":{\"build\":\"tsc --noEmit\",\"test\":\"standard && npm run build && npm run transpile && tap \\\"test/**/*.test.*js\\\" && tap --ts test/*.test.*ts\",\"test:ci\":\"standard && npm run transpile && npm run test:ci:js && npm run test:ci:ts\",\"test:ci:js\":\"tap --no-check-coverage --timeout=120 --coverage-report=lcovonly \\\"test/**/*.test.*js\\\"\",\"test:ci:ts\":\"tap --ts --no-check-coverage --coverage-report=lcovonly \\\"test/**/*.test.*ts\\\"\",\"test:yarn\":\"npm run transpile && tap \\\"test/**/*.test.js\\\" --no-check-coverage\",\"transpile\":\"sh ./test/ts/transpile.sh\",\"prepare\":\"husky install\"},\"standard\":{\"ignore\":[\"test/ts/**/*\",\"test/syntax-error.mjs\"]},\"repository\":{\"type\":\"git\",\"url\":\"git+https://github.com/mcollina/thread-stream.git\"},\"keywords\":[\"worker\",\"thread\",\"threads\",\"stream\"],\"author\":\"Matteo Collina <hello@matteocollina.com>\",\"license\":\"MIT\",\"bugs\":{\"url\":\"https://github.com/mcollina/thread-stream/issues\"},\"homepage\":\"https://github.com/mcollina/thread-stream#readme\"}","import { z } from \"zod\";\r\n\r\nimport { AppEnvSchema, buildEnvMeta, loadEnv } from \"@optiq/shared\";\r\n\r\nconst EnvSchema = z.object({\r\n  // Application\r\n  APP_ENV: AppEnvSchema.default(\"development\"),\r\n  NODE_ENV: z.enum([\"development\", \"production\", \"test\"]).default(\"development\"),\r\n  \r\n  // Database\r\n  DATABASE_URL: z.string().url().describe(\"PostgreSQL connection string\"),\r\n  \r\n  // NextAuth\r\n  NEXTAUTH_SECRET: z.string().min(32).describe(\"Secret for NextAuth session encryption (min 32 chars)\"),\r\n  NEXTAUTH_URL: z.string().url().optional().describe(\"Canonical URL of your site\"),\r\n\r\n  // Data Encryption\r\n  DATA_ENCRYPTION_KEY: z.string().min(32).describe(\"AES-256 key for encrypting sensitive data (32+ chars)\"),\r\n\r\n  // Google OAuth & Ads\r\n  GOOGLE_OAUTH_CLIENT_ID: z.string().min(1).describe(\"Google OAuth 2.0 Client ID\"),\r\n  GOOGLE_OAUTH_CLIENT_SECRET: z.string().min(1).describe(\"Google OAuth 2.0 Client Secret\"),\r\n  GOOGLE_OAUTH_REDIRECT_URI: z.string().url().describe(\"OAuth redirect URI for Google\"),\r\n  GOOGLE_ADS_DEVELOPER_TOKEN: z.string().min(1).describe(\"Google Ads API Developer Token\"),\r\n  GOOGLE_ADS_LOGIN_CUSTOMER_ID: z.string().min(1).optional().describe(\"Google Ads Manager Account ID (optional)\"),\r\n\r\n  // Meta (Facebook) Ads\r\n  META_APP_ID: z.string().min(1).describe(\"Meta App ID\"),\r\n  META_APP_SECRET: z.string().min(1).describe(\"Meta App Secret\"),\r\n  META_OAUTH_REDIRECT_URI: z.string().url().describe(\"OAuth redirect URI for Meta\"),\r\n  META_API_VERSION: z.string().min(1).default(\"v20.0\").describe(\"Meta Graph API version\"),\r\n\r\n  // TikTok Ads\r\n  TIKTOK_APP_ID: z.string().min(1).describe(\"TikTok App ID\"),\r\n  TIKTOK_APP_SECRET: z.string().min(1).describe(\"TikTok App Secret\"),\r\n  TIKTOK_OAUTH_REDIRECT_URI: z.string().url().describe(\"OAuth redirect URI for TikTok\"),\r\n  TIKTOK_API_BASE_URL: z.string().url().default(\"https://business-api.tiktok.com\").describe(\"TikTok Business API base URL\"),\r\n  \r\n  // Email Notifications (Optional)\r\n  SMTP_HOST: z.string().optional().describe(\"SMTP server hostname\"),\r\n  SMTP_PORT: z.coerce.number().int().min(1).max(65535).optional().describe(\"SMTP server port\"),\r\n  SMTP_USER: z.string().optional().describe(\"SMTP username\"),\r\n  SMTP_PASSWORD: z.string().optional().describe(\"SMTP password\"),\r\n  SMTP_FROM_EMAIL: z.string().email().optional().describe(\"From email address for notifications\"),\r\n  SMTP_FROM_NAME: z.string().optional().describe(\"From name for notifications\"),\r\n});\r\n\r\nconst base = loadEnv(\r\n  EnvSchema,\r\n  {\r\n    APP_ENV: process.env.APP_ENV,\r\n    NODE_ENV: process.env.NODE_ENV,\r\n    DATABASE_URL: process.env.DATABASE_URL,\r\n    NEXTAUTH_SECRET: process.env.NEXTAUTH_SECRET,\r\n    NEXTAUTH_URL: process.env.NEXTAUTH_URL,\r\n    DATA_ENCRYPTION_KEY: process.env.DATA_ENCRYPTION_KEY,\r\n    GOOGLE_OAUTH_CLIENT_ID: process.env.GOOGLE_OAUTH_CLIENT_ID,\r\n    GOOGLE_OAUTH_CLIENT_SECRET: process.env.GOOGLE_OAUTH_CLIENT_SECRET,\r\n    GOOGLE_OAUTH_REDIRECT_URI: process.env.GOOGLE_OAUTH_REDIRECT_URI,\r\n    GOOGLE_ADS_DEVELOPER_TOKEN: process.env.GOOGLE_ADS_DEVELOPER_TOKEN,\r\n    GOOGLE_ADS_LOGIN_CUSTOMER_ID: process.env.GOOGLE_ADS_LOGIN_CUSTOMER_ID,\r\n    META_APP_ID: process.env.META_APP_ID,\r\n    META_APP_SECRET: process.env.META_APP_SECRET,\r\n    META_OAUTH_REDIRECT_URI: process.env.META_OAUTH_REDIRECT_URI,\r\n    META_API_VERSION: process.env.META_API_VERSION,\r\n    TIKTOK_APP_ID: process.env.TIKTOK_APP_ID,\r\n    TIKTOK_APP_SECRET: process.env.TIKTOK_APP_SECRET,\r\n    TIKTOK_OAUTH_REDIRECT_URI: process.env.TIKTOK_OAUTH_REDIRECT_URI,\r\n    TIKTOK_API_BASE_URL: process.env.TIKTOK_API_BASE_URL,\r\n    SMTP_HOST: process.env.SMTP_HOST,\r\n    SMTP_PORT: process.env.SMTP_PORT,\r\n    SMTP_USER: process.env.SMTP_USER,\r\n    SMTP_PASSWORD: process.env.SMTP_PASSWORD,\r\n    SMTP_FROM_EMAIL: process.env.SMTP_FROM_EMAIL,\r\n    SMTP_FROM_NAME: process.env.SMTP_FROM_NAME,\r\n  },\r\n  {\r\n    redactKeys: [\r\n      \"DATABASE_URL\",\r\n      \"NEXTAUTH_SECRET\",\r\n      \"DATA_ENCRYPTION_KEY\",\r\n      \"GOOGLE_OAUTH_CLIENT_SECRET\",\r\n      \"GOOGLE_ADS_DEVELOPER_TOKEN\",\r\n      \"META_APP_SECRET\",\r\n      \"TIKTOK_APP_SECRET\",\r\n      \"SMTP_PASSWORD\",\r\n    ],\r\n  },\r\n);\r\n\r\nexport const env = {\r\n  ...base,\r\n  ...buildEnvMeta(base.APP_ENV),\r\n} as const;\r\n","import \"server-only\";\r\n\r\nimport argon2 from \"argon2\";\r\n\r\nexport async function hashPassword(password: string): Promise<string> {\r\n  return argon2.hash(password, {\r\n    type: argon2.argon2id,\r\n  });\r\n}\r\n\r\nexport async function verifyPassword(\r\n  hash: string,\r\n  password: string,\r\n): Promise<boolean> {\r\n  return argon2.verify(hash, password);\r\n}\r\n","import \"server-only\";\r\n\r\nimport { getServerSession } from \"next-auth\";\r\nimport { NextResponse } from \"next/server\";\r\n\r\nimport { authOptions } from \"@/lib/auth\";\r\nimport { prisma } from \"@/lib/prisma\";\r\nimport {\r\n  hasPermission,\r\n  hasAnyPermission,\r\n  isRoleAtLeast,\r\n  type WorkspaceRole,\r\n  type Permission,\r\n} from \"./rbac\";\r\n\r\n/**\r\n * Authorization Context\r\n * \r\n * Contains user, organization, and role information for authorization checks.\r\n */\r\nexport interface AuthContext {\r\n  userId: string;\r\n  organizationId: string;\r\n  role: WorkspaceRole;\r\n  email: string;\r\n}\r\n\r\nexport interface AuthResult {\r\n  authorized: boolean;\r\n  context?: AuthContext;\r\n  error?: string;\r\n  status?: number;\r\n}\r\n\r\n/**\r\n * Get authorization context for the current request\r\n * Returns null if not authenticated or no active organization\r\n */\r\nexport async function getAuthContext(): Promise<AuthContext | null> {\r\n  const session = await getServerSession(authOptions);\r\n\r\n  if (!session?.user?.id || !session?.user?.activeOrgId) {\r\n    return null;\r\n  }\r\n\r\n  const membership = await prisma.membership.findUnique({\r\n    where: {\r\n      userId_organizationId: {\r\n        userId: session.user.id,\r\n        organizationId: session.user.activeOrgId,\r\n      },\r\n    },\r\n    select: { role: true },\r\n  });\r\n\r\n  if (!membership) {\r\n    return null;\r\n  }\r\n\r\n  return {\r\n    userId: session.user.id,\r\n    organizationId: session.user.activeOrgId,\r\n    role: membership.role as WorkspaceRole,\r\n    email: session.user.email ?? \"\",\r\n  };\r\n}\r\n\r\n/**\r\n * Require authentication and return auth context\r\n */\r\nexport async function requireAuth(): Promise<AuthResult> {\r\n  const context = await getAuthContext();\r\n\r\n  if (!context) {\r\n    return {\r\n      authorized: false,\r\n      error: \"Authentication required\",\r\n      status: 401,\r\n    };\r\n  }\r\n\r\n  return {\r\n    authorized: true,\r\n    context,\r\n  };\r\n}\r\n\r\n/**\r\n * Require a specific permission\r\n */\r\nexport async function requirePermission(permission: Permission): Promise<AuthResult> {\r\n  const authResult = await requireAuth();\r\n\r\n  if (!authResult.authorized || !authResult.context) {\r\n    return authResult;\r\n  }\r\n\r\n  if (!hasPermission(authResult.context.role, permission)) {\r\n    return {\r\n      authorized: false,\r\n      context: authResult.context,\r\n      error: `Permission denied: ${permission}`,\r\n      status: 403,\r\n    };\r\n  }\r\n\r\n  return authResult;\r\n}\r\n\r\n/**\r\n * Require any of the specified permissions\r\n */\r\nexport async function requireAnyPermission(permissions: Permission[]): Promise<AuthResult> {\r\n  const authResult = await requireAuth();\r\n\r\n  if (!authResult.authorized || !authResult.context) {\r\n    return authResult;\r\n  }\r\n\r\n  if (!hasAnyPermission(authResult.context.role, permissions)) {\r\n    return {\r\n      authorized: false,\r\n      context: authResult.context,\r\n      error: `Permission denied: requires one of ${permissions.join(\", \")}`,\r\n      status: 403,\r\n    };\r\n  }\r\n\r\n  return authResult;\r\n}\r\n\r\n/**\r\n * Require a minimum role level\r\n */\r\nexport async function requireRole(minimumRole: WorkspaceRole): Promise<AuthResult> {\r\n  const authResult = await requireAuth();\r\n\r\n  if (!authResult.authorized || !authResult.context) {\r\n    return authResult;\r\n  }\r\n\r\n  if (!isRoleAtLeast(authResult.context.role, minimumRole)) {\r\n    return {\r\n      authorized: false,\r\n      context: authResult.context,\r\n      error: `Role ${minimumRole} or higher required`,\r\n      status: 403,\r\n    };\r\n  }\r\n\r\n  return authResult;\r\n}\r\n\r\n/**\r\n * Create an error response for authorization failures\r\n */\r\nexport function authErrorResponse(result: AuthResult): NextResponse {\r\n  return NextResponse.json(\r\n    { error: result.error ?? \"Unauthorized\" },\r\n    { status: result.status ?? 403 }\r\n  );\r\n}\r\n\r\n/**\r\n * Verify that a resource belongs to the user's organization\r\n * This is critical for multi-tenant isolation\r\n */\r\nexport async function verifyResourceOwnership(\r\n  context: AuthContext,\r\n  resourceType: string,\r\n  resourceId: string\r\n): Promise<boolean> {\r\n  switch (resourceType) {\r\n    case \"adAccount\":\r\n      return verifyAdAccountOwnership(context.organizationId, resourceId);\r\n    case \"campaign\":\r\n      return verifyCampaignOwnership(context.organizationId, resourceId);\r\n    case \"trackingSite\":\r\n      return verifyTrackingSiteOwnership(context.organizationId, resourceId);\r\n    case \"alertRule\":\r\n      return verifyAlertRuleOwnership(context.organizationId, resourceId);\r\n    case \"journey\":\r\n      return verifyJourneyOwnership(context.organizationId, resourceId);\r\n    default:\r\n      return false;\r\n  }\r\n}\r\n\r\nasync function verifyAdAccountOwnership(organizationId: string, resourceId: string): Promise<boolean> {\r\n  const count = await prisma.adAccount.count({\r\n    where: { id: resourceId, organizationId },\r\n  });\r\n  return count > 0;\r\n}\r\n\r\nasync function verifyCampaignOwnership(organizationId: string, resourceId: string): Promise<boolean> {\r\n  const count = await prisma.campaign.count({\r\n    where: { id: resourceId, organizationId },\r\n  });\r\n  return count > 0;\r\n}\r\n\r\nasync function verifyTrackingSiteOwnership(organizationId: string, resourceId: string): Promise<boolean> {\r\n  const count = await prisma.trackingSite.count({\r\n    where: { id: resourceId, organizationId },\r\n  });\r\n  return count > 0;\r\n}\r\n\r\nasync function verifyAlertRuleOwnership(organizationId: string, resourceId: string): Promise<boolean> {\r\n  const count = await prisma.alertRule.count({\r\n    where: { id: resourceId, organizationId },\r\n  });\r\n  return count > 0;\r\n}\r\n\r\nasync function verifyJourneyOwnership(organizationId: string, resourceId: string): Promise<boolean> {\r\n  const count = await prisma.journey.count({\r\n    where: { id: resourceId, organizationId },\r\n  });\r\n  return count > 0;\r\n}\r\n\r\n/**\r\n * Scoped query helper - ensures all queries are scoped to the user's organization\r\n * Use this to build tenant-isolated queries\r\n */\r\nexport function scopedWhere<T extends Record<string, unknown>>(\r\n  context: AuthContext,\r\n  additionalWhere?: T\r\n): T & { organizationId: string } {\r\n  return {\r\n    ...additionalWhere,\r\n    organizationId: context.organizationId,\r\n  } as T & { organizationId: string };\r\n}\r\n\r\n/**\r\n * Verify membership in an organization\r\n */\r\nexport async function verifyMembership(\r\n  userId: string,\r\n  organizationId: string\r\n): Promise<{ isMember: boolean; role?: WorkspaceRole }> {\r\n  const membership = await prisma.membership.findUnique({\r\n    where: {\r\n      userId_organizationId: {\r\n        userId,\r\n        organizationId,\r\n      },\r\n    },\r\n    select: { role: true },\r\n  });\r\n\r\n  if (!membership) {\r\n    return { isMember: false };\r\n  }\r\n\r\n  return {\r\n    isMember: true,\r\n    role: membership.role as WorkspaceRole,\r\n  };\r\n}\r\n","import \"server-only\";\r\n\r\n/**\r\n * Role-Based Access Control (RBAC)\r\n * \r\n * Workspace roles: OWNER > ADMIN > MEMBER > VIEWER\r\n * Each role inherits permissions from lower roles.\r\n */\r\n\r\nexport type WorkspaceRole = \"OWNER\" | \"ADMIN\" | \"MEMBER\" | \"VIEWER\";\r\n\r\nexport type Permission =\r\n  // Organization management\r\n  | \"org:read\"\r\n  | \"org:update\"\r\n  | \"org:delete\"\r\n  | \"org:manage_billing\"\r\n  | \"org:manage_members\"\r\n  | \"org:transfer_ownership\"\r\n  // Ad accounts & connectors\r\n  | \"connectors:read\"\r\n  | \"connectors:create\"\r\n  | \"connectors:update\"\r\n  | \"connectors:delete\"\r\n  // Campaigns & ads\r\n  | \"campaigns:read\"\r\n  | \"campaigns:create\"\r\n  | \"campaigns:update\"\r\n  | \"campaigns:delete\"\r\n  // Tracking & attribution\r\n  | \"tracking:read\"\r\n  | \"tracking:create\"\r\n  | \"tracking:update\"\r\n  | \"tracking:delete\"\r\n  // Journeys\r\n  | \"journeys:read\"\r\n  | \"journeys:create\"\r\n  | \"journeys:update\"\r\n  | \"journeys:delete\"\r\n  // Alerts\r\n  | \"alerts:read\"\r\n  | \"alerts:create\"\r\n  | \"alerts:update\"\r\n  | \"alerts:delete\"\r\n  | \"alerts:acknowledge\"\r\n  // Settings\r\n  | \"settings:read\"\r\n  | \"settings:update\"\r\n  // Reports & analytics\r\n  | \"reports:read\"\r\n  | \"reports:export\"\r\n  // API keys\r\n  | \"api_keys:read\"\r\n  | \"api_keys:create\"\r\n  | \"api_keys:delete\";\r\n\r\n/**\r\n * Permission matrix by role\r\n * Each role includes all permissions of roles below it\r\n */\r\nconst ROLE_PERMISSIONS: Record<WorkspaceRole, Permission[]> = {\r\n  VIEWER: [\r\n    \"org:read\",\r\n    \"connectors:read\",\r\n    \"campaigns:read\",\r\n    \"tracking:read\",\r\n    \"journeys:read\",\r\n    \"alerts:read\",\r\n    \"settings:read\",\r\n    \"reports:read\",\r\n  ],\r\n\r\n  MEMBER: [\r\n    // Inherits VIEWER permissions\r\n    \"org:read\",\r\n    \"connectors:read\",\r\n    \"campaigns:read\",\r\n    \"tracking:read\",\r\n    \"journeys:read\",\r\n    \"alerts:read\",\r\n    \"settings:read\",\r\n    \"reports:read\",\r\n    // Additional permissions\r\n    \"campaigns:create\",\r\n    \"campaigns:update\",\r\n    \"tracking:create\",\r\n    \"tracking:update\",\r\n    \"journeys:create\",\r\n    \"journeys:update\",\r\n    \"alerts:create\",\r\n    \"alerts:update\",\r\n    \"alerts:acknowledge\",\r\n    \"reports:export\",\r\n  ],\r\n\r\n  ADMIN: [\r\n    // Inherits MEMBER permissions\r\n    \"org:read\",\r\n    \"connectors:read\",\r\n    \"campaigns:read\",\r\n    \"tracking:read\",\r\n    \"journeys:read\",\r\n    \"alerts:read\",\r\n    \"settings:read\",\r\n    \"reports:read\",\r\n    \"campaigns:create\",\r\n    \"campaigns:update\",\r\n    \"tracking:create\",\r\n    \"tracking:update\",\r\n    \"journeys:create\",\r\n    \"journeys:update\",\r\n    \"alerts:create\",\r\n    \"alerts:update\",\r\n    \"alerts:acknowledge\",\r\n    \"reports:export\",\r\n    // Additional permissions\r\n    \"org:update\",\r\n    \"org:manage_members\",\r\n    \"connectors:create\",\r\n    \"connectors:update\",\r\n    \"connectors:delete\",\r\n    \"campaigns:delete\",\r\n    \"tracking:delete\",\r\n    \"journeys:delete\",\r\n    \"alerts:delete\",\r\n    \"settings:update\",\r\n    \"api_keys:read\",\r\n    \"api_keys:create\",\r\n    \"api_keys:delete\",\r\n  ],\r\n\r\n  OWNER: [\r\n    // All permissions\r\n    \"org:read\",\r\n    \"org:update\",\r\n    \"org:delete\",\r\n    \"org:manage_billing\",\r\n    \"org:manage_members\",\r\n    \"org:transfer_ownership\",\r\n    \"connectors:read\",\r\n    \"connectors:create\",\r\n    \"connectors:update\",\r\n    \"connectors:delete\",\r\n    \"campaigns:read\",\r\n    \"campaigns:create\",\r\n    \"campaigns:update\",\r\n    \"campaigns:delete\",\r\n    \"tracking:read\",\r\n    \"tracking:create\",\r\n    \"tracking:update\",\r\n    \"tracking:delete\",\r\n    \"journeys:read\",\r\n    \"journeys:create\",\r\n    \"journeys:update\",\r\n    \"journeys:delete\",\r\n    \"alerts:read\",\r\n    \"alerts:create\",\r\n    \"alerts:update\",\r\n    \"alerts:delete\",\r\n    \"alerts:acknowledge\",\r\n    \"settings:read\",\r\n    \"settings:update\",\r\n    \"reports:read\",\r\n    \"reports:export\",\r\n    \"api_keys:read\",\r\n    \"api_keys:create\",\r\n    \"api_keys:delete\",\r\n  ],\r\n};\r\n\r\n/**\r\n * Role hierarchy (higher index = more permissions)\r\n */\r\nconst ROLE_HIERARCHY: WorkspaceRole[] = [\"VIEWER\", \"MEMBER\", \"ADMIN\", \"OWNER\"];\r\n\r\nexport function hasPermission(role: WorkspaceRole, permission: Permission): boolean {\r\n  const permissions = ROLE_PERMISSIONS[role];\r\n  return permissions?.includes(permission) ?? false;\r\n}\r\n\r\nexport function hasAnyPermission(role: WorkspaceRole, permissions: Permission[]): boolean {\r\n  return permissions.some((p) => hasPermission(role, p));\r\n}\r\n\r\nexport function hasAllPermissions(role: WorkspaceRole, permissions: Permission[]): boolean {\r\n  return permissions.every((p) => hasPermission(role, p));\r\n}\r\n\r\nexport function getRolePermissions(role: WorkspaceRole): Permission[] {\r\n  return ROLE_PERMISSIONS[role] ?? [];\r\n}\r\n\r\nexport function isRoleAtLeast(role: WorkspaceRole, minimumRole: WorkspaceRole): boolean {\r\n  const roleIndex = ROLE_HIERARCHY.indexOf(role);\r\n  const minIndex = ROLE_HIERARCHY.indexOf(minimumRole);\r\n  return roleIndex >= minIndex;\r\n}\r\n\r\nexport function canManageRole(actorRole: WorkspaceRole, targetRole: WorkspaceRole): boolean {\r\n  // Can only manage roles below your own\r\n  const actorIndex = ROLE_HIERARCHY.indexOf(actorRole);\r\n  const targetIndex = ROLE_HIERARCHY.indexOf(targetRole);\r\n  return actorIndex > targetIndex;\r\n}\r\n\r\nexport function getAssignableRoles(actorRole: WorkspaceRole): WorkspaceRole[] {\r\n  const actorIndex = ROLE_HIERARCHY.indexOf(actorRole);\r\n  // Can assign roles below your own\r\n  return ROLE_HIERARCHY.slice(0, actorIndex);\r\n}\r\n\r\nexport function getRoleDisplayName(role: WorkspaceRole): string {\r\n  const names: Record<WorkspaceRole, string> = {\r\n    OWNER: \"Owner\",\r\n    ADMIN: \"Admin\",\r\n    MEMBER: \"Member\",\r\n    VIEWER: \"Viewer\",\r\n  };\r\n  return names[role] ?? role;\r\n}\r\n\r\nexport function getRoleDescription(role: WorkspaceRole): string {\r\n  const descriptions: Record<WorkspaceRole, string> = {\r\n    OWNER: \"Full access including billing and ownership transfer\",\r\n    ADMIN: \"Can manage members, connectors, and all settings\",\r\n    MEMBER: \"Can create and edit campaigns, tracking, and alerts\",\r\n    VIEWER: \"Read-only access to all data\",\r\n  };\r\n  return descriptions[role] ?? \"\";\r\n}\r\n"],"names":[],"mappings":"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"}