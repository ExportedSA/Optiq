module.exports=[92509,(e,t,r)=>{t.exports=e.x("url",()=>require("url"))},27699,(e,t,r)=>{t.exports=e.x("events",()=>require("events"))},24361,(e,t,r)=>{t.exports=e.x("util",()=>require("util"))},54799,(e,t,r)=>{t.exports=e.x("crypto",()=>require("crypto"))},21517,(e,t,r)=>{t.exports=e.x("http",()=>require("http"))},49719,(e,t,r)=>{t.exports=e.x("assert",()=>require("assert"))},45706,(e,t,r)=>{t.exports=e.x("querystring",()=>require("querystring"))},874,(e,t,r)=>{t.exports=e.x("buffer",()=>require("buffer"))},6461,(e,t,r)=>{t.exports=e.x("zlib",()=>require("zlib"))},24836,(e,t,r)=>{t.exports=e.x("https",()=>require("https"))},46069,(e,t,r)=>{t.exports=e.x("argon2",()=>require("argon2"))},42797,e=>{e.v({name:"openid-client",version:"5.7.1",description:"OpenID Connect Relying Party (RP, Client) implementation for Node.js runtime, supports passportjs",keywords:["auth","authentication","basic","certified","client","connect","dynamic","electron","hybrid","identity","implicit","oauth","oauth2","oidc","openid","passport","relying party","strategy"],homepage:"https://github.com/panva/openid-client",repository:"panva/openid-client",funding:{url:"https://github.com/sponsors/panva"},license:"MIT",author:"Filip Skokan <panva.ip@gmail.com>",exports:{types:"./types/index.d.ts",import:"./lib/index.mjs",require:"./lib/index.js"},main:"./lib/index.js",types:"./types/index.d.ts",files:["lib","types/index.d.ts"],scripts:{format:"npx prettier --loglevel silent --write ./lib ./test ./certification ./types",test:"mocha test/**/*.test.js"},dependencies:{jose:"^4.15.9","lru-cache":"^6.0.0","object-hash":"^2.2.0","oidc-token-hash":"^5.0.3"},devDependencies:{"@types/node":"^16.18.106","@types/passport":"^1.0.16",base64url:"^3.0.1",chai:"^4.5.0",mocha:"^10.7.3",nock:"^13.5.5",prettier:"^2.8.8","readable-mock-req":"^0.2.2",sinon:"^9.2.4",timekeeper:"^2.3.1"},"standard-version":{scripts:{postchangelog:"sed -i '' -e 's/### \\[/## [/g' CHANGELOG.md"},types:[{type:"feat",section:"Features"},{type:"fix",section:"Fixes"},{type:"chore",hidden:!0},{type:"docs",hidden:!0},{type:"style",hidden:!0},{type:"refactor",section:"Refactor",hidden:!1},{type:"perf",section:"Performance",hidden:!1},{type:"test",hidden:!0}]}})},1466,91490,42960,37966,e=>{"use strict";let t={fatal:60,error:50,warn:40,info:30,debug:20,trace:10,silent:1/0};class r{name;level;bindings;constructor(e={},r={}){this.name=e.name??"optiq",this.level=t[e.level??"info"],this.bindings=r}shouldLog(e){return t[e]>=this.level}formatMessage(e,t,r,n){if(!this.shouldLog(e))return;let i=new Date().toISOString(),s=`[${i}] ${e.toUpperCase()} (${this.name})`;if("string"==typeof t)return void console[e](s,t,...void 0!==r?[r,...n||[]]:n||[]);let a={...this.bindings,...t};Object.keys(a).length>0?console[e](s,r||"",a,...n||[]):console[e](s,r||"",...n||[])}fatal(e,t,...r){this.formatMessage("error",e,t,r)}error(e,t,...r){this.formatMessage("error",e,t,r)}warn(e,t,...r){this.formatMessage("warn",e,t,r)}info(e,t,...r){this.formatMessage("info",e,t,r)}debug(e,t,...r){this.formatMessage("debug",e,t,r)}trace(e,t,...r){this.formatMessage("debug",e,t,r)}child(e){return new r({name:this.name,level:Object.keys(t).find(e=>t[e]===this.level)},{...this.bindings,...e})}}!function(e={}){new r(e)}();var n=e.i(46989);let i=n.z.enum(["GOOGLE_ADS","META","TIKTOK","LINKEDIN","X"]),s=n.z.string().regex(/^\d{4}-\d{2}-\d{2}$/);n.z.object({channel:i,date:s,campaign_id:n.z.string().min(1),campaign_name:n.z.string().min(1).optional(),adset_id:n.z.string().min(1).optional(),adset_name:n.z.string().min(1).optional(),ad_id:n.z.string().min(1).optional(),ad_name:n.z.string().min(1).optional(),spend_micros:n.z.bigint().nonnegative(),clicks:n.z.bigint().nonnegative(),impressions:n.z.bigint().nonnegative(),publisher_platform:n.z.string().min(1).optional()});let a={FREE:{tier:"FREE",name:"Free",description:"Get started with basic tracking",limits:{maxWorkspaces:1,maxConnectors:1,monthlyEventLimit:1e3,dataRetentionDays:7,attributionModels:["LAST_TOUCH"],alertsEnabled:!1,ssoEnabled:!1,prioritySupport:!1},pricing:{monthlyPriceCents:0,annualPriceCents:0,overageEventsPer10kCents:0,overageConnectorCents:0},features:["1 workspace","1 ad platform connector","1,000 events/month","Last-touch attribution","7-day data retention"]},STARTER:{tier:"STARTER",name:"Starter",description:"For small teams getting started with attribution",limits:{maxWorkspaces:1,maxConnectors:2,monthlyEventLimit:1e4,dataRetentionDays:14,attributionModels:["FIRST_TOUCH","LAST_TOUCH","LINEAR"],alertsEnabled:!1,ssoEnabled:!1,prioritySupport:!1},pricing:{monthlyPriceCents:4900,annualPriceCents:47e3,overageEventsPer10kCents:500,overageConnectorCents:1500},features:["1 workspace","2 ad platform connectors","10,000 events/month","First, last & linear attribution","14-day data retention","Email support"]},GROWTH:{tier:"GROWTH",name:"Growth",description:"For growing teams who need full attribution insights",limits:{maxWorkspaces:3,maxConnectors:10,monthlyEventLimit:1e5,dataRetentionDays:90,attributionModels:["FIRST_TOUCH","LAST_TOUCH","LINEAR","TIME_DECAY","POSITION_BASED"],alertsEnabled:!0,ssoEnabled:!1,prioritySupport:!1},pricing:{monthlyPriceCents:14900,annualPriceCents:143e3,overageEventsPer10kCents:400,overageConnectorCents:1e3},features:["3 workspaces","All ad platform connectors","100,000 events/month","All attribution models","90-day data retention","Waste & CPA alerts","Priority email support"],recommended:!0},SCALE:{tier:"SCALE",name:"Scale",description:"For enterprises with advanced needs",limits:{maxWorkspaces:-1,maxConnectors:-1,monthlyEventLimit:1e6,dataRetentionDays:365,attributionModels:["FIRST_TOUCH","LAST_TOUCH","LINEAR","TIME_DECAY","POSITION_BASED","DATA_DRIVEN"],alertsEnabled:!0,ssoEnabled:!0,prioritySupport:!0},pricing:{monthlyPriceCents:49900,annualPriceCents:479e3,overageEventsPer10kCents:300,overageConnectorCents:500},features:["Unlimited workspaces","Unlimited connectors","1,000,000+ events/month","All attribution models + data-driven","365-day data retention","Custom lookback windows","SSO/SAML (coming soon)","Dedicated support","SLA guarantee"]}};function o(e){return a[e]}function c(e){return a[e].limits}function d(e){return -1===e}function l(e,t,r){let n=Math.max(0,e.trackedEvents-t.monthlyEventLimit),i=d(t.maxConnectors)?0:Math.max(0,e.connectedAccounts-t.maxConnectors),s=Math.ceil(n/1e4)*r.overageEventsPer10kCents,a=i*r.overageConnectorCents;return{eventsOverage:n,connectorsOverage:i,eventsOverageCents:s,connectorsOverageCents:a,totalOverageCents:s+a}}function u(e,t){let r=[];return!d(t.maxWorkspaces)&&e.workspacesUsed>t.maxWorkspaces&&r.push(`Workspace limit exceeded (${e.workspacesUsed}/${t.maxWorkspaces})`),!d(t.maxConnectors)&&e.connectedAccounts>t.maxConnectors&&r.push(`Connector limit exceeded (${e.connectedAccounts}/${t.maxConnectors})`),e.trackedEvents>1.5*t.monthlyEventLimit&&r.push(`Event limit significantly exceeded (${e.trackedEvents}/${t.monthlyEventLimit})`),{withinLimits:0===r.length,violations:r}}function p(e,t){let r=["FREE","STARTER","GROWTH","SCALE"];return r.indexOf(t)>r.indexOf(e)}function E(e,t){let r=["FREE","STARTER","GROWTH","SCALE"];return r.indexOf(t)<r.indexOf(e)}function _(e){let t=["FREE","STARTER","GROWTH","SCALE"],r=t.indexOf(e);return r<t.length-1?t[r+1]:null}e.s(["PLAN_DEFINITIONS",0,a,"calculateOverages",()=>l,"canDowngrade",()=>E,"canUpgrade",()=>p,"checkLimits",()=>u,"getPlanDefinition",()=>o,"getPlanLimits",()=>c,"getUpgradePath",()=>_,"isUnlimited",()=>d],91490),e.s([],42960),e.i(54799);let T=n.z.enum(["development","staging","production"]);class m extends Error{details;constructor(e,t){super(e),this.name="EnvValidationError",this.details=t}}function g(e,t,r={}){let n=e.safeParse(t);if(n.success)return n.data;let i=new Set(r.redactKeys??[]),s={};for(let[e,r]of Object.entries(t))s[e]=i.has(e)?"[REDACTED]":r;let a=function(e){let t=e.flatten(),r=[];for(let[e,n]of Object.entries(t.fieldErrors))Array.isArray(n)&&n.length>0&&r.push(`  • ${e}: ${n.join(", ")}`);return t.formErrors.length>0&&r.push(`  • ${t.formErrors.join(", ")}`),{formErrors:t.formErrors,fieldErrors:t.fieldErrors,readableMessage:r.length>0?`
${r.join("\n")}`:"Unknown validation error"}}(n.error);throw new m(`
╔════════════════════════════════════════════════════════════════════════════╗
║ ENVIRONMENT CONFIGURATION ERROR                                            ║
╚════════════════════════════════════════════════════════════════════════════╝

Your application failed to start due to invalid or missing environment variables.

ERRORS:${a.readableMessage}

TROUBLESHOOTING:
  1. Copy .env.example to .env if you haven't already
  2. Fill in all required values in your .env file
  3. Ensure all values match the expected format (URLs, numbers, etc.)
  4. Check that sensitive values meet minimum length requirements

For more details, see .env.example in the project root.
`,{errors:a,snapshot:s})}function A(e){return{appEnv:e,isDevelopment:"development"===e,isStaging:"staging"===e,isProduction:"production"===e}}e.s(["AppEnvSchema",0,T,"buildEnvMeta",()=>A,"loadEnv",()=>g],37966),e.s([],1466)},80608,e=>{"use strict";var t=e.i(46989);e.i(1466);var r=e.i(37966);let n=t.z.object({APP_ENV:r.AppEnvSchema.default("development"),NODE_ENV:t.z.enum(["development","production","test"]).default("development"),DATABASE_URL:t.z.string().url().describe("PostgreSQL connection string"),NEXTAUTH_SECRET:t.z.string().min(32).describe("Secret for NextAuth session encryption (min 32 chars)"),NEXTAUTH_URL:t.z.string().url().optional().describe("Canonical URL of your site"),DATA_ENCRYPTION_KEY:t.z.string().min(32).describe("AES-256 key for encrypting sensitive data (32+ chars)"),GOOGLE_OAUTH_CLIENT_ID:t.z.string().min(1).describe("Google OAuth 2.0 Client ID"),GOOGLE_OAUTH_CLIENT_SECRET:t.z.string().min(1).describe("Google OAuth 2.0 Client Secret"),GOOGLE_OAUTH_REDIRECT_URI:t.z.string().url().describe("OAuth redirect URI for Google"),GOOGLE_ADS_DEVELOPER_TOKEN:t.z.string().min(1).describe("Google Ads API Developer Token"),GOOGLE_ADS_LOGIN_CUSTOMER_ID:t.z.string().min(1).optional().describe("Google Ads Manager Account ID (optional)"),META_APP_ID:t.z.string().min(1).describe("Meta App ID"),META_APP_SECRET:t.z.string().min(1).describe("Meta App Secret"),META_OAUTH_REDIRECT_URI:t.z.string().url().describe("OAuth redirect URI for Meta"),META_API_VERSION:t.z.string().min(1).default("v20.0").describe("Meta Graph API version"),TIKTOK_APP_ID:t.z.string().min(1).describe("TikTok App ID"),TIKTOK_APP_SECRET:t.z.string().min(1).describe("TikTok App Secret"),TIKTOK_OAUTH_REDIRECT_URI:t.z.string().url().describe("OAuth redirect URI for TikTok"),TIKTOK_API_BASE_URL:t.z.string().url().default("https://business-api.tiktok.com").describe("TikTok Business API base URL"),STRIPE_SECRET_KEY:t.z.string().startsWith("sk_").optional().describe("Stripe secret key (must start with sk_)"),STRIPE_WEBHOOK_SECRET:t.z.string().startsWith("whsec_").optional().describe("Stripe webhook signing secret (must start with whsec_)"),NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY:t.z.string().startsWith("pk_").optional().describe("Stripe publishable key (must start with pk_)"),SMTP_HOST:t.z.string().optional().describe("SMTP server hostname"),SMTP_PORT:t.z.coerce.number().int().min(1).max(65535).optional().describe("SMTP server port"),SMTP_USER:t.z.string().optional().describe("SMTP username"),SMTP_PASSWORD:t.z.string().optional().describe("SMTP password"),SMTP_FROM_EMAIL:t.z.string().email().optional().describe("From email address for notifications"),SMTP_FROM_NAME:t.z.string().optional().describe("From name for notifications")}),i=(0,r.loadEnv)(n,{APP_ENV:process.env.APP_ENV,NODE_ENV:"production",DATABASE_URL:process.env.DATABASE_URL,NEXTAUTH_SECRET:process.env.NEXTAUTH_SECRET,NEXTAUTH_URL:process.env.NEXTAUTH_URL,DATA_ENCRYPTION_KEY:process.env.DATA_ENCRYPTION_KEY,GOOGLE_OAUTH_CLIENT_ID:process.env.GOOGLE_OAUTH_CLIENT_ID,GOOGLE_OAUTH_CLIENT_SECRET:process.env.GOOGLE_OAUTH_CLIENT_SECRET,GOOGLE_OAUTH_REDIRECT_URI:process.env.GOOGLE_OAUTH_REDIRECT_URI,GOOGLE_ADS_DEVELOPER_TOKEN:process.env.GOOGLE_ADS_DEVELOPER_TOKEN,GOOGLE_ADS_LOGIN_CUSTOMER_ID:process.env.GOOGLE_ADS_LOGIN_CUSTOMER_ID,META_APP_ID:process.env.META_APP_ID,META_APP_SECRET:process.env.META_APP_SECRET,META_OAUTH_REDIRECT_URI:process.env.META_OAUTH_REDIRECT_URI,META_API_VERSION:process.env.META_API_VERSION,TIKTOK_APP_ID:process.env.TIKTOK_APP_ID,TIKTOK_APP_SECRET:process.env.TIKTOK_APP_SECRET,TIKTOK_OAUTH_REDIRECT_URI:process.env.TIKTOK_OAUTH_REDIRECT_URI,TIKTOK_API_BASE_URL:process.env.TIKTOK_API_BASE_URL,STRIPE_SECRET_KEY:process.env.STRIPE_SECRET_KEY,STRIPE_WEBHOOK_SECRET:process.env.STRIPE_WEBHOOK_SECRET,NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY:process.env.NEXT_PUBLIC_STRIPE_PUBLISHABLE_KEY,SMTP_HOST:process.env.SMTP_HOST,SMTP_PORT:process.env.SMTP_PORT,SMTP_USER:process.env.SMTP_USER,SMTP_PASSWORD:process.env.SMTP_PASSWORD,SMTP_FROM_EMAIL:process.env.SMTP_FROM_EMAIL,SMTP_FROM_NAME:process.env.SMTP_FROM_NAME},{redactKeys:["DATABASE_URL","NEXTAUTH_SECRET","DATA_ENCRYPTION_KEY","GOOGLE_OAUTH_CLIENT_SECRET","GOOGLE_ADS_DEVELOPER_TOKEN","META_APP_SECRET","TIKTOK_APP_SECRET","STRIPE_SECRET_KEY","STRIPE_WEBHOOK_SECRET","SMTP_PASSWORD"]}),s={...i,...(0,r.buildEnvMeta)(i.APP_ENV)};e.s(["env",0,s])},4587,e=>{"use strict";e.i(55007);var t=e.i(46069);async function r(e){return t.default.hash(e,{type:t.default.argon2id})}async function n(e,r){return t.default.verify(e,r)}e.s(["hashPassword",()=>r,"verifyPassword",()=>n])},94238,e=>{"use strict";e.i(55007);var t=e.i(68050),r=e.i(70081),n=e.i(16336),i=e.i(60806);let s={VIEWER:["org:read","connectors:read","campaigns:read","tracking:read","journeys:read","alerts:read","settings:read","reports:read"],MEMBER:["org:read","connectors:read","campaigns:read","tracking:read","journeys:read","alerts:read","settings:read","reports:read","campaigns:create","campaigns:update","tracking:create","tracking:update","journeys:create","journeys:update","alerts:create","alerts:update","alerts:acknowledge","reports:export"],ADMIN:["org:read","connectors:read","campaigns:read","tracking:read","journeys:read","alerts:read","settings:read","reports:read","campaigns:create","campaigns:update","tracking:create","tracking:update","journeys:create","journeys:update","alerts:create","alerts:update","alerts:acknowledge","reports:export","org:update","org:manage_members","connectors:create","connectors:update","connectors:delete","campaigns:delete","tracking:delete","journeys:delete","alerts:delete","settings:update","api_keys:read","api_keys:create","api_keys:delete"],OWNER:["org:read","org:update","org:delete","org:manage_billing","org:manage_members","org:transfer_ownership","connectors:read","connectors:create","connectors:update","connectors:delete","campaigns:read","campaigns:create","campaigns:update","campaigns:delete","tracking:read","tracking:create","tracking:update","tracking:delete","journeys:read","journeys:create","journeys:update","journeys:delete","alerts:read","alerts:create","alerts:update","alerts:delete","alerts:acknowledge","settings:read","settings:update","reports:read","reports:export","api_keys:read","api_keys:create","api_keys:delete"]},a=["VIEWER","MEMBER","ADMIN","OWNER"];function o(e,t){let r=s[e];return r?.includes(t)??!1}async function c(){let e=await (0,t.getServerSession)(n.authOptions);if(!e?.user?.id||!e?.user?.activeOrgId)return null;let r=await i.prisma.membership.findUnique({where:{userId_organizationId:{userId:e.user.id,organizationId:e.user.activeOrgId}},select:{role:!0}});return r?{userId:e.user.id,organizationId:e.user.activeOrgId,role:r.role,email:e.user.email??""}:null}async function d(){let e=await c();return e?{authorized:!0,context:e}:{authorized:!1,error:"Authentication required",status:401}}async function l(e){let t=await d();return t.authorized&&t.context?o(t.context.role,e)?t:{authorized:!1,context:t.context,error:`Permission denied: ${e}`,status:403}:t}async function u(e){var t;let r=await d();return r.authorized&&r.context?(t=r.context.role,e.some(e=>o(t,e)))?r:{authorized:!1,context:r.context,error:`Permission denied: requires one of ${e.join(", ")}`,status:403}:r}async function p(e){var t;let r=await d();return r.authorized&&r.context?(t=r.context.role,a.indexOf(t)>=a.indexOf(e))?r:{authorized:!1,context:r.context,error:`Role ${e} or higher required`,status:403}:r}function E(e){return r.NextResponse.json({error:e.error??"Unauthorized"},{status:e.status??403})}async function _(e,t,r){switch(t){case"adAccount":return T(e.organizationId,r);case"campaign":return m(e.organizationId,r);case"trackingSite":return g(e.organizationId,r);case"alertRule":return A(e.organizationId,r);case"journey":return O(e.organizationId,r);default:return!1}}async function T(e,t){return await i.prisma.adAccount.count({where:{id:t,organizationId:e}})>0}async function m(e,t){return await i.prisma.campaign.count({where:{id:t,organizationId:e}})>0}async function g(e,t){return await i.prisma.trackingSite.count({where:{id:t,organizationId:e}})>0}async function A(e,t){return await i.prisma.alertRule.count({where:{id:t,organizationId:e}})>0}async function O(e,t){return await i.prisma.journey.count({where:{id:t,organizationId:e}})>0}function R(e,t){return{...t,organizationId:e.organizationId}}async function h(e,t){let r=await i.prisma.membership.findUnique({where:{userId_organizationId:{userId:e,organizationId:t}},select:{role:!0}});return r?{isMember:!0,role:r.role}:{isMember:!1}}e.s(["authErrorResponse",()=>E,"getAuthContext",()=>c,"requireAnyPermission",()=>u,"requireAuth",()=>d,"requirePermission",()=>l,"requireRole",()=>p,"scopedWhere",()=>R,"verifyMembership",()=>h,"verifyResourceOwnership",()=>_],94238)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__48db98cd._.js.map