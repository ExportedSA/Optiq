{"version":3,"sources":["../../../../../../../../../../../OneDrive/Desktop/Optiq/CascadeProjects/windsurf-project/apps/frontend/src/components/dashboard/kpi-card.tsx/__nextjs-internal-proxy.mjs","../../../../../../../../../../../OneDrive/Desktop/Optiq/CascadeProjects/windsurf-project/apps/frontend/src/app/app/page.tsx","../../../../../../../../../../../OneDrive/Desktop/Optiq/CascadeProjects/windsurf-project/apps/frontend/src/lib/dashboard/queries.ts","../../../../../../../../../../../OneDrive/Desktop/Optiq/CascadeProjects/windsurf-project/apps/frontend/src/lib/metrics/types.ts","../../../../../../../../../../../OneDrive/Desktop/Optiq/CascadeProjects/windsurf-project/apps/frontend/src/lib/metrics/cache.ts","../../../../../../../../../../../OneDrive/Desktop/Optiq/CascadeProjects/windsurf-project/apps/frontend/src/lib/metrics/aggregator.ts","../../../../../../../../../../../OneDrive/Desktop/Optiq/CascadeProjects/windsurf-project/apps/frontend/src/components/dashboard/index.ts"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const KpiCard = registerClientReference(\n    function() { throw new Error(\"Attempted to call KpiCard() from the server but KpiCard is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/OneDrive/Desktop/Optiq/CascadeProjects/windsurf-project/apps/frontend/src/components/dashboard/kpi-card.tsx\",\n    \"KpiCard\",\n);\nexport const KpiCardGrid = registerClientReference(\n    function() { throw new Error(\"Attempted to call KpiCardGrid() from the server but KpiCardGrid is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/OneDrive/Desktop/Optiq/CascadeProjects/windsurf-project/apps/frontend/src/components/dashboard/kpi-card.tsx\",\n    \"KpiCardGrid\",\n);\n","import { getServerSession } from \"next-auth\";\r\n\r\nimport { authOptions } from \"@/lib/auth\";\r\nimport { getDashboardKpis, getRecentActivity, getTopWasteAlerts } from \"@/lib/dashboard\";\r\nimport { KpiCard, KpiCardGrid } from \"@/components/dashboard\";\r\nimport type { TrendDirection } from \"@/components/dashboard\";\r\n\r\nfunction formatCurrency(value: number): string {\r\n  return new Intl.NumberFormat(\"en-US\", {\r\n    style: \"currency\",\r\n    currency: \"USD\",\r\n    minimumFractionDigits: 2,\r\n    maximumFractionDigits: 2,\r\n  }).format(value);\r\n}\r\n\r\nfunction formatNumber(value: number): string {\r\n  return new Intl.NumberFormat(\"en-US\").format(value);\r\n}\r\n\r\nfunction formatPercent(value: number): string {\r\n  return `${value.toFixed(1)}%`;\r\n}\r\n\r\nfunction getTrend(change: number | null, invert = false): TrendDirection {\r\n  if (change === null || change === 0) return \"neutral\";\r\n  const isUp = change > 0;\r\n  if (invert) return isUp ? \"down\" : \"up\";\r\n  return isUp ? \"up\" : \"down\";\r\n}\r\n\r\nexport default async function DashboardPage() {\r\n  const session = await getServerSession(authOptions);\r\n  const orgId = session?.user?.activeOrgId;\r\n\r\n  let kpis = null;\r\n  let recentActivity: Awaited<ReturnType<typeof getRecentActivity>> = [];\r\n  let wasteAlerts: Awaited<ReturnType<typeof getTopWasteAlerts>> = [];\r\n\r\n  if (orgId) {\r\n    try {\r\n      [kpis, recentActivity, wasteAlerts] = await Promise.all([\r\n        getDashboardKpis({ organizationId: orgId, days: 30 }),\r\n        getRecentActivity({ organizationId: orgId, limit: 5 }),\r\n        getTopWasteAlerts({ organizationId: orgId, limit: 5 }),\r\n      ]);\r\n    } catch (error) {\r\n      console.error(\"Failed to load dashboard data:\", error);\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <div>\r\n        <h1 className=\"text-2xl font-semibold tracking-tight\">Dashboard</h1>\r\n        <p className=\"mt-1 text-sm text-zinc-600\">\r\n          Welcome back, {session?.user?.name ?? session?.user?.email}\r\n        </p>\r\n      </div>\r\n\r\n      <KpiCardGrid>\r\n        <KpiCard\r\n          title=\"Total Spend\"\r\n          value={kpis ? formatCurrency(kpis.totalSpend) : \"$0.00\"}\r\n          change={kpis?.changes?.spend ?? null}\r\n          changeLabel=\"vs last period\"\r\n          trend={getTrend(kpis?.changes?.spend ?? null)}\r\n          icon={<SpendIcon />}\r\n        />\r\n        <KpiCard\r\n          title=\"Conversions\"\r\n          value={kpis ? formatNumber(kpis.totalConversions) : \"0\"}\r\n          change={kpis?.changes?.conversions ?? null}\r\n          changeLabel=\"vs last period\"\r\n          trend={getTrend(kpis?.changes?.conversions ?? null)}\r\n          icon={<ConversionIcon />}\r\n        />\r\n        <KpiCard\r\n          title=\"CPA\"\r\n          value={kpis?.overallCpa ? formatCurrency(kpis.overallCpa) : \"â€”\"}\r\n          change={kpis?.changes?.cpa ?? null}\r\n          changeLabel=\"vs last period\"\r\n          trend={getTrend(kpis?.changes?.cpa ?? null, true)}\r\n          icon={<CpaIcon />}\r\n        />\r\n        <KpiCard\r\n          title=\"Wasted Spend\"\r\n          value={kpis ? formatPercent(kpis.wastedSpendPercent) : \"0.0%\"}\r\n          change={kpis?.changes?.wastedSpendPercent ?? null}\r\n          changeLabel=\"vs last period\"\r\n          trend={getTrend(kpis?.changes?.wastedSpendPercent ?? null, true)}\r\n          icon={<WasteIcon />}\r\n        />\r\n      </KpiCardGrid>\r\n\r\n      <div className=\"grid gap-4 lg:grid-cols-2\">\r\n        <div className=\"rounded-xl border border-zinc-200 bg-white p-6\">\r\n          <h2 className=\"text-sm font-medium text-zinc-900\">Recent Activity</h2>\r\n          {recentActivity.length > 0 ? (\r\n            <ul className=\"mt-4 space-y-3\">\r\n              {recentActivity.map((activity) => (\r\n                <li key={activity.id} className=\"flex items-start gap-3\">\r\n                  <span\r\n                    className={`mt-0.5 h-2 w-2 rounded-full ${\r\n                      activity.type === \"success\" ? \"bg-green-500\" : \"bg-red-500\"\r\n                    }`}\r\n                  />\r\n                  <div className=\"flex-1\">\r\n                    <p className=\"text-sm text-zinc-700\">{activity.description}</p>\r\n                    <p className=\"text-xs text-zinc-500\">\r\n                      {activity.timestamp.toLocaleString()}\r\n                    </p>\r\n                  </div>\r\n                </li>\r\n              ))}\r\n            </ul>\r\n          ) : (\r\n            <p className=\"mt-4 text-sm text-zinc-500\">No recent activity</p>\r\n          )}\r\n        </div>\r\n\r\n        <div className=\"rounded-xl border border-zinc-200 bg-white p-6\">\r\n          <h2 className=\"text-sm font-medium text-zinc-900\">Waste Alerts</h2>\r\n          {wasteAlerts.length > 0 ? (\r\n            <ul className=\"mt-4 space-y-3\">\r\n              {wasteAlerts.map((alert) => (\r\n                <li key={alert.id} className=\"flex items-start justify-between gap-3\">\r\n                  <div>\r\n                    <p className=\"text-sm font-medium text-zinc-700\">{alert.entityName}</p>\r\n                    <p className=\"text-xs text-zinc-500 capitalize\">{alert.reason}</p>\r\n                  </div>\r\n                  <span\r\n                    className={`rounded-full px-2 py-0.5 text-xs font-medium ${\r\n                      alert.level === \"critical\"\r\n                        ? \"bg-red-100 text-red-700\"\r\n                        : alert.level === \"high\"\r\n                        ? \"bg-orange-100 text-orange-700\"\r\n                        : \"bg-yellow-100 text-yellow-700\"\r\n                    }`}\r\n                  >\r\n                    {formatCurrency(alert.wastedSpend)}\r\n                  </span>\r\n                </li>\r\n              ))}\r\n            </ul>\r\n          ) : (\r\n            <p className=\"mt-4 text-sm text-zinc-500\">No waste alerts</p>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      <div className=\"rounded-xl border border-zinc-200 bg-white p-6\">\r\n        <h2 className=\"text-sm font-medium text-zinc-900\">Quick Actions</h2>\r\n        <div className=\"mt-4 flex flex-wrap gap-3\">\r\n          <a\r\n            href=\"/app/integrations\"\r\n            className=\"inline-flex items-center gap-2 rounded-lg border border-zinc-200 px-4 py-2 text-sm font-medium text-zinc-700 hover:bg-zinc-50\"\r\n          >\r\n            <span>ðŸ”Œ</span> Connect Ad Platform\r\n          </a>\r\n          <a\r\n            href=\"/app/campaigns\"\r\n            className=\"inline-flex items-center gap-2 rounded-lg border border-zinc-200 px-4 py-2 text-sm font-medium text-zinc-700 hover:bg-zinc-50\"\r\n          >\r\n            <span>ðŸ“¢</span> View Campaigns\r\n          </a>\r\n          <a\r\n            href=\"/app/waste\"\r\n            className=\"inline-flex items-center gap-2 rounded-lg border border-zinc-200 px-4 py-2 text-sm font-medium text-zinc-700 hover:bg-zinc-50\"\r\n          >\r\n            <span>ðŸ’¸</span> Check Waste\r\n          </a>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction SpendIcon() {\r\n  return (\r\n    <svg className=\"h-5 w-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={1.5} d=\"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n    </svg>\r\n  );\r\n}\r\n\r\nfunction ConversionIcon() {\r\n  return (\r\n    <svg className=\"h-5 w-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={1.5} d=\"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z\" />\r\n    </svg>\r\n  );\r\n}\r\n\r\nfunction CpaIcon() {\r\n  return (\r\n    <svg className=\"h-5 w-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={1.5} d=\"M7 12l3-3 3 3 4-4M8 21l4-4 4 4M3 4h18M4 4h16v12a1 1 0 01-1 1H5a1 1 0 01-1-1V4z\" />\r\n    </svg>\r\n  );\r\n}\r\n\r\nfunction WasteIcon() {\r\n  return (\r\n    <svg className=\"h-5 w-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\r\n      <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={1.5} d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\" />\r\n    </svg>\r\n  );\r\n}\r\n","import \"server-only\";\r\n\r\nimport { prisma } from \"@/lib/prisma\";\r\nimport { metricsAggregator } from \"@/lib/metrics\";\r\nimport { wasteEvaluator } from \"@/lib/waste\";\r\nimport type { MetricsSummary } from \"@/lib/metrics\";\r\n\r\nexport interface DashboardKpis {\r\n  totalSpend: number;\r\n  totalConversions: number;\r\n  overallCpa: number | null;\r\n  wastedSpendPercent: number;\r\n  roas: number | null;\r\n  previousPeriod: {\r\n    totalSpend: number;\r\n    totalConversions: number;\r\n    overallCpa: number | null;\r\n    wastedSpendPercent: number;\r\n  } | null;\r\n  changes: {\r\n    spend: number;\r\n    conversions: number;\r\n    cpa: number | null;\r\n    wastedSpendPercent: number;\r\n  } | null;\r\n}\r\n\r\nexport async function getDashboardKpis(params: {\r\n  organizationId: string;\r\n  days?: number;\r\n}): Promise<DashboardKpis> {\r\n  const days = params.days ?? 30;\r\n  const endDate = new Date();\r\n  endDate.setHours(23, 59, 59, 999);\r\n\r\n  const startDate = new Date(endDate);\r\n  startDate.setDate(startDate.getDate() - days + 1);\r\n  startDate.setHours(0, 0, 0, 0);\r\n\r\n  const summary = await metricsAggregator.getSummary({\r\n    filter: {\r\n      organizationId: params.organizationId,\r\n      dateRange: { start: startDate, end: endDate },\r\n    },\r\n    entityLevel: \"organization\",\r\n    comparePrevious: true,\r\n  });\r\n\r\n  const wasteAnalysis = await wasteEvaluator.evaluateOrganization({\r\n    organizationId: params.organizationId,\r\n    windowDays: days,\r\n    endDate,\r\n  });\r\n\r\n  const totalWastedSpend = wasteAnalysis.alerts.reduce(\r\n    (sum, a) => sum + Number(a.spendMicros) / 1_000_000,\r\n    0\r\n  );\r\n\r\n  const wastedSpendPercent =\r\n    summary.current.spend > 0\r\n      ? (totalWastedSpend / summary.current.spend) * 100\r\n      : 0;\r\n\r\n  let previousWastedPercent = 0;\r\n  if (summary.previous && summary.previous.spend > 0) {\r\n    const prevEndDate = new Date(startDate);\r\n    prevEndDate.setDate(prevEndDate.getDate() - 1);\r\n\r\n    const prevWasteAnalysis = await wasteEvaluator.evaluateOrganization({\r\n      organizationId: params.organizationId,\r\n      windowDays: days,\r\n      endDate: prevEndDate,\r\n    });\r\n\r\n    const prevTotalWasted = prevWasteAnalysis.alerts.reduce(\r\n      (sum, a) => sum + Number(a.spendMicros) / 1_000_000,\r\n      0\r\n    );\r\n\r\n    previousWastedPercent =\r\n      summary.previous.spend > 0\r\n        ? (prevTotalWasted / summary.previous.spend) * 100\r\n        : 0;\r\n  }\r\n\r\n  return {\r\n    totalSpend: summary.current.spend,\r\n    totalConversions: summary.current.conversions,\r\n    overallCpa: summary.current.cpa,\r\n    wastedSpendPercent,\r\n    roas: summary.current.roas,\r\n    previousPeriod: summary.previous\r\n      ? {\r\n          totalSpend: summary.previous.spend,\r\n          totalConversions: summary.previous.conversions,\r\n          overallCpa: summary.previous.cpa,\r\n          wastedSpendPercent: previousWastedPercent,\r\n        }\r\n      : null,\r\n    changes: summary.change\r\n      ? {\r\n          spend: summary.change.spend,\r\n          conversions: summary.change.conversions,\r\n          cpa: summary.change.cpa,\r\n          wastedSpendPercent: wastedSpendPercent - previousWastedPercent,\r\n        }\r\n      : null,\r\n  };\r\n}\r\n\r\nexport async function getRecentActivity(params: {\r\n  organizationId: string;\r\n  limit?: number;\r\n}): Promise<\r\n  Array<{\r\n    id: string;\r\n    type: string;\r\n    description: string;\r\n    timestamp: Date;\r\n  }>\r\n> {\r\n  const jobs = await prisma.ingestionJob.findMany({\r\n    where: {\r\n      organizationId: params.organizationId,\r\n      status: { in: [\"SUCCEEDED\", \"FAILED\"] },\r\n    },\r\n    orderBy: { updatedAt: \"desc\" },\r\n    take: params.limit ?? 5,\r\n    select: {\r\n      id: true,\r\n      platform: true,\r\n      jobType: true,\r\n      status: true,\r\n      updatedAt: true,\r\n    },\r\n  });\r\n\r\n  return jobs.map((job: typeof jobs[number]) => ({\r\n    id: job.id,\r\n    type: job.status === \"SUCCEEDED\" ? \"success\" : \"error\",\r\n    description: `${job.platform} ${job.jobType.toLowerCase().replace(\"_\", \" \")} ${job.status.toLowerCase()}`,\r\n    timestamp: job.updatedAt,\r\n  }));\r\n}\r\n\r\nexport async function getTopWasteAlerts(params: {\r\n  organizationId: string;\r\n  limit?: number;\r\n}): Promise<\r\n  Array<{\r\n    id: string;\r\n    entityName: string;\r\n    entityType: string;\r\n    wastedSpend: number;\r\n    reason: string;\r\n    level: string;\r\n  }>\r\n> {\r\n  const analysis = await wasteEvaluator.evaluateOrganization({\r\n    organizationId: params.organizationId,\r\n    windowDays: 7,\r\n  });\r\n\r\n  return analysis.alerts\r\n    .sort((a, b) => Number(b.spendMicros) - Number(a.spendMicros))\r\n    .slice(0, params.limit ?? 5)\r\n    .map((alert) => ({\r\n      id: alert.id,\r\n      entityName: alert.entityName,\r\n      entityType: alert.entityType,\r\n      wastedSpend: Number(alert.spendMicros) / 1_000_000,\r\n      reason: alert.reason.replace(/_/g, \" \"),\r\n      level: alert.level,\r\n    }));\r\n}\r\n","import \"server-only\";\r\n\r\nexport type TimeGranularity = \"day\" | \"week\" | \"month\" | \"quarter\" | \"year\";\r\n\r\nexport type EntityLevel = \"organization\" | \"platform\" | \"ad_account\" | \"campaign\" | \"ad\";\r\n\r\nexport interface DateRange {\r\n  start: Date;\r\n  end: Date;\r\n}\r\n\r\nexport interface MetricsFilter {\r\n  organizationId: string;\r\n  platformCodes?: string[];\r\n  adAccountIds?: string[];\r\n  campaignIds?: string[];\r\n  adIds?: string[];\r\n  dateRange: DateRange;\r\n}\r\n\r\nexport interface RawMetrics {\r\n  impressions: bigint;\r\n  clicks: bigint;\r\n  spendMicros: bigint;\r\n  conversions: bigint;\r\n  revenueMicros: bigint;\r\n}\r\n\r\nexport interface ComputedMetrics {\r\n  impressions: number;\r\n  clicks: number;\r\n  spend: number;\r\n  conversions: number;\r\n  revenue: number;\r\n  ctr: number | null;\r\n  cpc: number | null;\r\n  cpa: number | null;\r\n  roas: number | null;\r\n  conversionRate: number | null;\r\n}\r\n\r\nexport interface MetricsWithWaste extends ComputedMetrics {\r\n  wastedSpend: number;\r\n  wastePercent: number;\r\n  efficientSpend: number;\r\n}\r\n\r\nexport interface AggregatedMetricsRow {\r\n  period: string;\r\n  periodStart: Date;\r\n  periodEnd: Date;\r\n  entityId: string | null;\r\n  entityName: string | null;\r\n  entityLevel: EntityLevel;\r\n  platformCode: string | null;\r\n  metrics: MetricsWithWaste;\r\n}\r\n\r\nexport interface MetricsSummary {\r\n  current: MetricsWithWaste;\r\n  previous: MetricsWithWaste | null;\r\n  change: MetricsChange | null;\r\n}\r\n\r\nexport interface MetricsChange {\r\n  impressions: number;\r\n  clicks: number;\r\n  spend: number;\r\n  conversions: number;\r\n  revenue: number;\r\n  cpa: number | null;\r\n  roas: number | null;\r\n  wastePercent: number;\r\n}\r\n\r\nexport interface CacheKey {\r\n  type: \"metrics\";\r\n  organizationId: string;\r\n  entityLevel: EntityLevel;\r\n  entityId: string | null;\r\n  granularity: TimeGranularity;\r\n  dateRange: string;\r\n}\r\n\r\nexport interface CachedMetrics {\r\n  key: string;\r\n  data: AggregatedMetricsRow[];\r\n  computedAt: Date;\r\n  expiresAt: Date;\r\n}\r\n\r\nexport function microsToDollars(micros: bigint): number {\r\n  return Number(micros) / 1_000_000;\r\n}\r\n\r\nexport function computeMetrics(raw: RawMetrics, targetCpaMicros?: bigint): MetricsWithWaste {\r\n  const impressions = Number(raw.impressions);\r\n  const clicks = Number(raw.clicks);\r\n  const spend = microsToDollars(raw.spendMicros);\r\n  const conversions = Number(raw.conversions);\r\n  const revenue = microsToDollars(raw.revenueMicros);\r\n\r\n  const ctr = impressions > 0 ? (clicks / impressions) * 100 : null;\r\n  const cpc = clicks > 0 ? spend / clicks : null;\r\n  const cpa = conversions > 0 ? spend / conversions : null;\r\n  const roas = spend > 0 ? revenue / spend : null;\r\n  const conversionRate = clicks > 0 ? (conversions / clicks) * 100 : null;\r\n\r\n  let wastedSpend = 0;\r\n  let efficientSpend = spend;\r\n\r\n  if (conversions === 0 && spend > 0) {\r\n    wastedSpend = spend;\r\n    efficientSpend = 0;\r\n  } else if (targetCpaMicros && conversions > 0 && cpa !== null) {\r\n    const targetCpa = microsToDollars(targetCpaMicros);\r\n    if (cpa > targetCpa) {\r\n      wastedSpend = spend - targetCpa * conversions;\r\n      efficientSpend = targetCpa * conversions;\r\n    }\r\n  }\r\n\r\n  const wastePercent = spend > 0 ? (wastedSpend / spend) * 100 : 0;\r\n\r\n  return {\r\n    impressions,\r\n    clicks,\r\n    spend,\r\n    conversions,\r\n    revenue,\r\n    ctr,\r\n    cpc,\r\n    cpa,\r\n    roas,\r\n    conversionRate,\r\n    wastedSpend,\r\n    wastePercent,\r\n    efficientSpend,\r\n  };\r\n}\r\n\r\nexport function computeChange(\r\n  current: MetricsWithWaste,\r\n  previous: MetricsWithWaste\r\n): MetricsChange {\r\n  const pctChange = (curr: number, prev: number): number => {\r\n    if (prev === 0) return curr > 0 ? 100 : 0;\r\n    return ((curr - prev) / prev) * 100;\r\n  };\r\n\r\n  return {\r\n    impressions: pctChange(current.impressions, previous.impressions),\r\n    clicks: pctChange(current.clicks, previous.clicks),\r\n    spend: pctChange(current.spend, previous.spend),\r\n    conversions: pctChange(current.conversions, previous.conversions),\r\n    revenue: pctChange(current.revenue, previous.revenue),\r\n    cpa:\r\n      current.cpa !== null && previous.cpa !== null\r\n        ? pctChange(current.cpa, previous.cpa)\r\n        : null,\r\n    roas:\r\n      current.roas !== null && previous.roas !== null\r\n        ? pctChange(current.roas, previous.roas)\r\n        : null,\r\n    wastePercent: current.wastePercent - previous.wastePercent,\r\n  };\r\n}\r\n\r\nexport function buildCacheKey(params: {\r\n  organizationId: string;\r\n  entityLevel: EntityLevel;\r\n  entityId: string | null;\r\n  granularity: TimeGranularity;\r\n  dateRange: DateRange;\r\n}): string {\r\n  const dateStr = `${params.dateRange.start.toISOString().split(\"T\")[0]}_${params.dateRange.end.toISOString().split(\"T\")[0]}`;\r\n  return `metrics:${params.organizationId}:${params.entityLevel}:${params.entityId ?? \"all\"}:${params.granularity}:${dateStr}`;\r\n}\r\n\r\nexport function getPeriodBounds(\r\n  date: Date,\r\n  granularity: TimeGranularity\r\n): { start: Date; end: Date; label: string } {\r\n  const d = new Date(date);\r\n\r\n  switch (granularity) {\r\n    case \"day\": {\r\n      const start = new Date(d.getFullYear(), d.getMonth(), d.getDate());\r\n      const end = new Date(start);\r\n      end.setDate(end.getDate() + 1);\r\n      end.setMilliseconds(-1);\r\n      return { start, end, label: start.toISOString().split(\"T\")[0] };\r\n    }\r\n\r\n    case \"week\": {\r\n      const day = d.getDay();\r\n      const diff = d.getDate() - day + (day === 0 ? -6 : 1);\r\n      const start = new Date(d.getFullYear(), d.getMonth(), diff);\r\n      const end = new Date(start);\r\n      end.setDate(end.getDate() + 7);\r\n      end.setMilliseconds(-1);\r\n      const weekNum = Math.ceil(\r\n        ((start.getTime() - new Date(start.getFullYear(), 0, 1).getTime()) / 86400000 + 1) / 7\r\n      );\r\n      return { start, end, label: `${start.getFullYear()}-W${String(weekNum).padStart(2, \"0\")}` };\r\n    }\r\n\r\n    case \"month\": {\r\n      const start = new Date(d.getFullYear(), d.getMonth(), 1);\r\n      const end = new Date(d.getFullYear(), d.getMonth() + 1, 0, 23, 59, 59, 999);\r\n      return {\r\n        start,\r\n        end,\r\n        label: `${start.getFullYear()}-${String(start.getMonth() + 1).padStart(2, \"0\")}`,\r\n      };\r\n    }\r\n\r\n    case \"quarter\": {\r\n      const quarter = Math.floor(d.getMonth() / 3);\r\n      const start = new Date(d.getFullYear(), quarter * 3, 1);\r\n      const end = new Date(d.getFullYear(), quarter * 3 + 3, 0, 23, 59, 59, 999);\r\n      return { start, end, label: `${start.getFullYear()}-Q${quarter + 1}` };\r\n    }\r\n\r\n    case \"year\": {\r\n      const start = new Date(d.getFullYear(), 0, 1);\r\n      const end = new Date(d.getFullYear(), 11, 31, 23, 59, 59, 999);\r\n      return { start, end, label: String(d.getFullYear()) };\r\n    }\r\n  }\r\n}\r\n","import \"server-only\";\r\n\r\nimport type { AggregatedMetricsRow, CachedMetrics } from \"./types\";\r\n\r\nconst DEFAULT_TTL_MS = 5 * 60 * 1000;\r\n\r\nconst memoryCache = new Map<string, CachedMetrics>();\r\n\r\nexport interface CacheOptions {\r\n  ttlMs?: number;\r\n}\r\n\r\nexport class MetricsCache {\r\n  private readonly ttlMs: number;\r\n\r\n  constructor(options: CacheOptions = {}) {\r\n    this.ttlMs = options.ttlMs ?? DEFAULT_TTL_MS;\r\n  }\r\n\r\n  get(key: string): AggregatedMetricsRow[] | null {\r\n    const cached = memoryCache.get(key);\r\n\r\n    if (!cached) return null;\r\n\r\n    if (new Date() > cached.expiresAt) {\r\n      memoryCache.delete(key);\r\n      return null;\r\n    }\r\n\r\n    return cached.data;\r\n  }\r\n\r\n  set(key: string, data: AggregatedMetricsRow[], ttlMs?: number): void {\r\n    const now = new Date();\r\n    const expiresAt = new Date(now.getTime() + (ttlMs ?? this.ttlMs));\r\n\r\n    memoryCache.set(key, {\r\n      key,\r\n      data,\r\n      computedAt: now,\r\n      expiresAt,\r\n    });\r\n  }\r\n\r\n  invalidate(key: string): boolean {\r\n    return memoryCache.delete(key);\r\n  }\r\n\r\n  invalidatePattern(pattern: string): number {\r\n    let count = 0;\r\n    const regex = new RegExp(pattern.replace(/\\*/g, \".*\"));\r\n\r\n    for (const key of memoryCache.keys()) {\r\n      if (regex.test(key)) {\r\n        memoryCache.delete(key);\r\n        count++;\r\n      }\r\n    }\r\n\r\n    return count;\r\n  }\r\n\r\n  invalidateOrganization(organizationId: string): number {\r\n    return this.invalidatePattern(`metrics:${organizationId}:.*`);\r\n  }\r\n\r\n  clear(): void {\r\n    memoryCache.clear();\r\n  }\r\n\r\n  size(): number {\r\n    return memoryCache.size;\r\n  }\r\n\r\n  prune(): number {\r\n    const now = new Date();\r\n    let pruned = 0;\r\n\r\n    for (const [key, cached] of memoryCache.entries()) {\r\n      if (now > cached.expiresAt) {\r\n        memoryCache.delete(key);\r\n        pruned++;\r\n      }\r\n    }\r\n\r\n    return pruned;\r\n  }\r\n\r\n  getStats(): {\r\n    size: number;\r\n    keys: string[];\r\n    oldestEntry: Date | null;\r\n    newestEntry: Date | null;\r\n  } {\r\n    let oldest: Date | null = null;\r\n    let newest: Date | null = null;\r\n\r\n    for (const cached of memoryCache.values()) {\r\n      if (!oldest || cached.computedAt < oldest) oldest = cached.computedAt;\r\n      if (!newest || cached.computedAt > newest) newest = cached.computedAt;\r\n    }\r\n\r\n    return {\r\n      size: memoryCache.size,\r\n      keys: Array.from(memoryCache.keys()),\r\n      oldestEntry: oldest,\r\n      newestEntry: newest,\r\n    };\r\n  }\r\n}\r\n\r\nexport const metricsCache = new MetricsCache();\r\n","import \"server-only\";\r\n\r\nimport { prisma } from \"@/lib/prisma\";\r\nimport type {\r\n  TimeGranularity,\r\n  EntityLevel,\r\n  DateRange,\r\n  MetricsFilter,\r\n  RawMetrics,\r\n  AggregatedMetricsRow,\r\n  MetricsSummary,\r\n  MetricsWithWaste,\r\n} from \"./types\";\r\nimport {\r\n  computeMetrics,\r\n  computeChange,\r\n  buildCacheKey,\r\n  getPeriodBounds,\r\n} from \"./types\";\r\nimport { MetricsCache, metricsCache } from \"./cache\";\r\n\r\nexport interface AggregatorConfig {\r\n  targetCpaMicros?: bigint;\r\n  useCache?: boolean;\r\n  cacheTtlMs?: number;\r\n}\r\n\r\nconst DEFAULT_TARGET_CPA_MICROS = BigInt(25_000_000);\r\n\r\nexport class MetricsAggregator {\r\n  private readonly config: Required<AggregatorConfig>;\r\n  private readonly cache: MetricsCache;\r\n\r\n  constructor(config: AggregatorConfig = {}) {\r\n    this.config = {\r\n      targetCpaMicros: config.targetCpaMicros ?? DEFAULT_TARGET_CPA_MICROS,\r\n      useCache: config.useCache ?? true,\r\n      cacheTtlMs: config.cacheTtlMs ?? 5 * 60 * 1000,\r\n    };\r\n    this.cache = metricsCache;\r\n  }\r\n\r\n  async aggregateByPeriod(params: {\r\n    filter: MetricsFilter;\r\n    granularity: TimeGranularity;\r\n    entityLevel: EntityLevel;\r\n  }): Promise<AggregatedMetricsRow[]> {\r\n    const cacheKey = buildCacheKey({\r\n      organizationId: params.filter.organizationId,\r\n      entityLevel: params.entityLevel,\r\n      entityId: null,\r\n      granularity: params.granularity,\r\n      dateRange: params.filter.dateRange,\r\n    });\r\n\r\n    if (this.config.useCache) {\r\n      const cached = this.cache.get(cacheKey);\r\n      if (cached) return cached;\r\n    }\r\n\r\n    const rows = await this.queryMetrics(params);\r\n\r\n    if (this.config.useCache) {\r\n      this.cache.set(cacheKey, rows, this.config.cacheTtlMs);\r\n    }\r\n\r\n    return rows;\r\n  }\r\n\r\n  private async queryMetrics(params: {\r\n    filter: MetricsFilter;\r\n    granularity: TimeGranularity;\r\n    entityLevel: EntityLevel;\r\n  }): Promise<AggregatedMetricsRow[]> {\r\n    const { filter, granularity, entityLevel } = params;\r\n\r\n    switch (entityLevel) {\r\n      case \"organization\":\r\n        return this.aggregateOrganization(filter, granularity);\r\n      case \"platform\":\r\n        return this.aggregateByPlatform(filter, granularity);\r\n      case \"ad_account\":\r\n        return this.aggregateByAdAccount(filter, granularity);\r\n      case \"campaign\":\r\n        return this.aggregateByCampaign(filter, granularity);\r\n      case \"ad\":\r\n        return this.aggregateByAd(filter, granularity);\r\n      default:\r\n        return [];\r\n    }\r\n  }\r\n\r\n  private async aggregateOrganization(\r\n    filter: MetricsFilter,\r\n    granularity: TimeGranularity\r\n  ): Promise<AggregatedMetricsRow[]> {\r\n    const metrics = await prisma.dailyAdAccountMetric.findMany({\r\n      where: {\r\n        organizationId: filter.organizationId,\r\n        date: { gte: filter.dateRange.start, lte: filter.dateRange.end },\r\n        ...(filter.platformCodes?.length\r\n          ? { platform: { code: { in: filter.platformCodes as (\"GOOGLE_ADS\" | \"META\" | \"TIKTOK\" | \"LINKEDIN\")[] } } }\r\n          : {}),\r\n      },\r\n      select: {\r\n        date: true,\r\n        impressions: true,\r\n        clicks: true,\r\n        spendMicros: true,\r\n        conversions: true,\r\n        revenueMicros: true,\r\n      },\r\n    });\r\n\r\n    return this.groupByPeriod(metrics, granularity, {\r\n      entityLevel: \"organization\",\r\n      entityId: filter.organizationId,\r\n      entityName: \"Organization Total\",\r\n      platformCode: null,\r\n    });\r\n  }\r\n\r\n  private async aggregateByPlatform(\r\n    filter: MetricsFilter,\r\n    granularity: TimeGranularity\r\n  ): Promise<AggregatedMetricsRow[]> {\r\n    const metrics = await prisma.dailyAdAccountMetric.findMany({\r\n      where: {\r\n        organizationId: filter.organizationId,\r\n        date: { gte: filter.dateRange.start, lte: filter.dateRange.end },\r\n        ...(filter.platformCodes?.length\r\n          ? { platform: { code: { in: filter.platformCodes as (\"GOOGLE_ADS\" | \"META\" | \"TIKTOK\" | \"LINKEDIN\")[] } } }\r\n          : {}),\r\n      },\r\n      select: {\r\n        date: true,\r\n        impressions: true,\r\n        clicks: true,\r\n        spendMicros: true,\r\n        conversions: true,\r\n        revenueMicros: true,\r\n        platform: { select: { code: true, name: true } },\r\n      },\r\n    });\r\n\r\n    const byPlatform = new Map<string, typeof metrics>();\r\n    for (const m of metrics) {\r\n      const key = m.platform.code;\r\n      if (!byPlatform.has(key)) byPlatform.set(key, []);\r\n      byPlatform.get(key)!.push(m);\r\n    }\r\n\r\n    const results: AggregatedMetricsRow[] = [];\r\n    for (const [platformCode, platformMetrics] of byPlatform) {\r\n      const platformName = platformMetrics[0]?.platform.name ?? platformCode;\r\n      const rows = this.groupByPeriod(platformMetrics, granularity, {\r\n        entityLevel: \"platform\",\r\n        entityId: platformCode,\r\n        entityName: platformName,\r\n        platformCode,\r\n      });\r\n      results.push(...rows);\r\n    }\r\n\r\n    return results.sort((a, b) => a.periodStart.getTime() - b.periodStart.getTime());\r\n  }\r\n\r\n  private async aggregateByAdAccount(\r\n    filter: MetricsFilter,\r\n    granularity: TimeGranularity\r\n  ): Promise<AggregatedMetricsRow[]> {\r\n    const metrics = await prisma.dailyAdAccountMetric.findMany({\r\n      where: {\r\n        organizationId: filter.organizationId,\r\n        date: { gte: filter.dateRange.start, lte: filter.dateRange.end },\r\n        ...(filter.adAccountIds?.length ? { adAccountId: { in: filter.adAccountIds } } : {}),\r\n        ...(filter.platformCodes?.length\r\n          ? { platform: { code: { in: filter.platformCodes as (\"GOOGLE_ADS\" | \"META\" | \"TIKTOK\" | \"LINKEDIN\")[] } } }\r\n          : {}),\r\n      },\r\n      select: {\r\n        date: true,\r\n        adAccountId: true,\r\n        impressions: true,\r\n        clicks: true,\r\n        spendMicros: true,\r\n        conversions: true,\r\n        revenueMicros: true,\r\n        adAccount: { select: { name: true } },\r\n        platform: { select: { code: true } },\r\n      },\r\n    });\r\n\r\n    const byAccount = new Map<string, typeof metrics>();\r\n    for (const m of metrics) {\r\n      if (!byAccount.has(m.adAccountId)) byAccount.set(m.adAccountId, []);\r\n      byAccount.get(m.adAccountId)!.push(m);\r\n    }\r\n\r\n    const results: AggregatedMetricsRow[] = [];\r\n    for (const [accountId, accountMetrics] of byAccount) {\r\n      const accountName = accountMetrics[0]?.adAccount.name ?? accountId;\r\n      const platformCode = accountMetrics[0]?.platform.code ?? null;\r\n      const rows = this.groupByPeriod(accountMetrics, granularity, {\r\n        entityLevel: \"ad_account\",\r\n        entityId: accountId,\r\n        entityName: accountName,\r\n        platformCode,\r\n      });\r\n      results.push(...rows);\r\n    }\r\n\r\n    return results.sort((a, b) => a.periodStart.getTime() - b.periodStart.getTime());\r\n  }\r\n\r\n  private async aggregateByCampaign(\r\n    filter: MetricsFilter,\r\n    granularity: TimeGranularity\r\n  ): Promise<AggregatedMetricsRow[]> {\r\n    const metrics = await prisma.dailyCampaignMetric.findMany({\r\n      where: {\r\n        organizationId: filter.organizationId,\r\n        date: { gte: filter.dateRange.start, lte: filter.dateRange.end },\r\n        ...(filter.campaignIds?.length ? { campaignId: { in: filter.campaignIds } } : {}),\r\n        ...(filter.adAccountIds?.length ? { adAccountId: { in: filter.adAccountIds } } : {}),\r\n        ...(filter.platformCodes?.length\r\n          ? { platform: { code: { in: filter.platformCodes as (\"GOOGLE_ADS\" | \"META\" | \"TIKTOK\" | \"LINKEDIN\")[] } } }\r\n          : {}),\r\n      },\r\n      select: {\r\n        date: true,\r\n        campaignId: true,\r\n        impressions: true,\r\n        clicks: true,\r\n        spendMicros: true,\r\n        conversions: true,\r\n        revenueMicros: true,\r\n        campaign: { select: { name: true } },\r\n        platform: { select: { code: true } },\r\n      },\r\n    });\r\n\r\n    const byCampaign = new Map<string, typeof metrics>();\r\n    for (const m of metrics) {\r\n      if (!byCampaign.has(m.campaignId)) byCampaign.set(m.campaignId, []);\r\n      byCampaign.get(m.campaignId)!.push(m);\r\n    }\r\n\r\n    const results: AggregatedMetricsRow[] = [];\r\n    for (const [campaignId, campaignMetrics] of byCampaign) {\r\n      const campaignName = campaignMetrics[0]?.campaign.name ?? campaignId;\r\n      const platformCode = campaignMetrics[0]?.platform.code ?? null;\r\n      const rows = this.groupByPeriod(campaignMetrics, granularity, {\r\n        entityLevel: \"campaign\",\r\n        entityId: campaignId,\r\n        entityName: campaignName,\r\n        platformCode,\r\n      });\r\n      results.push(...rows);\r\n    }\r\n\r\n    return results.sort((a, b) => a.periodStart.getTime() - b.periodStart.getTime());\r\n  }\r\n\r\n  private async aggregateByAd(\r\n    filter: MetricsFilter,\r\n    granularity: TimeGranularity\r\n  ): Promise<AggregatedMetricsRow[]> {\r\n    const metrics = await prisma.dailyAdMetric.findMany({\r\n      where: {\r\n        organizationId: filter.organizationId,\r\n        date: { gte: filter.dateRange.start, lte: filter.dateRange.end },\r\n        ...(filter.adIds?.length ? { adId: { in: filter.adIds } } : {}),\r\n        ...(filter.campaignIds?.length ? { campaignId: { in: filter.campaignIds } } : {}),\r\n        ...(filter.adAccountIds?.length ? { adAccountId: { in: filter.adAccountIds } } : {}),\r\n        ...(filter.platformCodes?.length\r\n          ? { platform: { code: { in: filter.platformCodes as (\"GOOGLE_ADS\" | \"META\" | \"TIKTOK\" | \"LINKEDIN\")[] } } }\r\n          : {}),\r\n      },\r\n      select: {\r\n        date: true,\r\n        adId: true,\r\n        impressions: true,\r\n        clicks: true,\r\n        spendMicros: true,\r\n        conversions: true,\r\n        revenueMicros: true,\r\n        ad: { select: { name: true } },\r\n        platform: { select: { code: true } },\r\n      },\r\n    });\r\n\r\n    const byAd = new Map<string, typeof metrics>();\r\n    for (const m of metrics) {\r\n      if (!byAd.has(m.adId)) byAd.set(m.adId, []);\r\n      byAd.get(m.adId)!.push(m);\r\n    }\r\n\r\n    const results: AggregatedMetricsRow[] = [];\r\n    for (const [adId, adMetrics] of byAd) {\r\n      const adName = adMetrics[0]?.ad.name ?? adId;\r\n      const platformCode = adMetrics[0]?.platform.code ?? null;\r\n      const rows = this.groupByPeriod(adMetrics, granularity, {\r\n        entityLevel: \"ad\",\r\n        entityId: adId,\r\n        entityName: adName,\r\n        platformCode,\r\n      });\r\n      results.push(...rows);\r\n    }\r\n\r\n    return results.sort((a, b) => a.periodStart.getTime() - b.periodStart.getTime());\r\n  }\r\n\r\n  private groupByPeriod(\r\n    metrics: Array<{\r\n      date: Date;\r\n      impressions: bigint;\r\n      clicks: bigint;\r\n      spendMicros: bigint;\r\n      conversions: bigint;\r\n      revenueMicros: bigint;\r\n    }>,\r\n    granularity: TimeGranularity,\r\n    entity: {\r\n      entityLevel: EntityLevel;\r\n      entityId: string;\r\n      entityName: string;\r\n      platformCode: string | null;\r\n    }\r\n  ): AggregatedMetricsRow[] {\r\n    const byPeriod = new Map<string, RawMetrics>();\r\n\r\n    for (const m of metrics) {\r\n      const { label } = getPeriodBounds(m.date, granularity);\r\n\r\n      if (!byPeriod.has(label)) {\r\n        byPeriod.set(label, {\r\n          impressions: BigInt(0),\r\n          clicks: BigInt(0),\r\n          spendMicros: BigInt(0),\r\n          conversions: BigInt(0),\r\n          revenueMicros: BigInt(0),\r\n        });\r\n      }\r\n\r\n      const agg = byPeriod.get(label)!;\r\n      agg.impressions += m.impressions;\r\n      agg.clicks += m.clicks;\r\n      agg.spendMicros += m.spendMicros;\r\n      agg.conversions += m.conversions;\r\n      agg.revenueMicros += m.revenueMicros;\r\n    }\r\n\r\n    const rows: AggregatedMetricsRow[] = [];\r\n\r\n    for (const [period, raw] of byPeriod) {\r\n      const sampleDate = metrics.find((m) => {\r\n        const { label } = getPeriodBounds(m.date, granularity);\r\n        return label === period;\r\n      })?.date;\r\n\r\n      if (!sampleDate) continue;\r\n\r\n      const { start, end } = getPeriodBounds(sampleDate, granularity);\r\n\r\n      rows.push({\r\n        period,\r\n        periodStart: start,\r\n        periodEnd: end,\r\n        entityId: entity.entityId,\r\n        entityName: entity.entityName,\r\n        entityLevel: entity.entityLevel,\r\n        platformCode: entity.platformCode,\r\n        metrics: computeMetrics(raw, this.config.targetCpaMicros),\r\n      });\r\n    }\r\n\r\n    return rows.sort((a, b) => a.periodStart.getTime() - b.periodStart.getTime());\r\n  }\r\n\r\n  async getSummary(params: {\r\n    filter: MetricsFilter;\r\n    entityLevel: EntityLevel;\r\n    comparePrevious?: boolean;\r\n  }): Promise<MetricsSummary> {\r\n    const currentMetrics = await this.aggregateTotal(params.filter, params.entityLevel);\r\n\r\n    if (!params.comparePrevious) {\r\n      return { current: currentMetrics, previous: null, change: null };\r\n    }\r\n\r\n    const rangeDays = Math.ceil(\r\n      (params.filter.dateRange.end.getTime() - params.filter.dateRange.start.getTime()) /\r\n        (1000 * 60 * 60 * 24)\r\n    );\r\n\r\n    const previousEnd = new Date(params.filter.dateRange.start);\r\n    previousEnd.setDate(previousEnd.getDate() - 1);\r\n    const previousStart = new Date(previousEnd);\r\n    previousStart.setDate(previousStart.getDate() - rangeDays + 1);\r\n\r\n    const previousFilter: MetricsFilter = {\r\n      ...params.filter,\r\n      dateRange: { start: previousStart, end: previousEnd },\r\n    };\r\n\r\n    const previousMetrics = await this.aggregateTotal(previousFilter, params.entityLevel);\r\n\r\n    return {\r\n      current: currentMetrics,\r\n      previous: previousMetrics,\r\n      change: computeChange(currentMetrics, previousMetrics),\r\n    };\r\n  }\r\n\r\n  private async aggregateTotal(\r\n    filter: MetricsFilter,\r\n    entityLevel: EntityLevel\r\n  ): Promise<MetricsWithWaste> {\r\n    const rows = await this.aggregateByPeriod({\r\n      filter,\r\n      granularity: \"day\",\r\n      entityLevel,\r\n    });\r\n\r\n    const totals: RawMetrics = {\r\n      impressions: BigInt(0),\r\n      clicks: BigInt(0),\r\n      spendMicros: BigInt(0),\r\n      conversions: BigInt(0),\r\n      revenueMicros: BigInt(0),\r\n    };\r\n\r\n    for (const row of rows) {\r\n      totals.impressions += BigInt(Math.round(row.metrics.impressions));\r\n      totals.clicks += BigInt(Math.round(row.metrics.clicks));\r\n      totals.spendMicros += BigInt(Math.round(row.metrics.spend * 1_000_000));\r\n      totals.conversions += BigInt(Math.round(row.metrics.conversions));\r\n      totals.revenueMicros += BigInt(Math.round(row.metrics.revenue * 1_000_000));\r\n    }\r\n\r\n    return computeMetrics(totals, this.config.targetCpaMicros);\r\n  }\r\n\r\n  invalidateCache(organizationId: string): number {\r\n    return this.cache.invalidateOrganization(organizationId);\r\n  }\r\n\r\n  getConfig(): AggregatorConfig {\r\n    return { ...this.config };\r\n  }\r\n}\r\n\r\nexport const metricsAggregator = new MetricsAggregator();\r\n","export { KpiCard, KpiCardGrid } from \"./kpi-card\";\r\nexport type { KpiCardProps, TrendDirection } from \"./kpi-card\";\r\n"],"names":[],"mappings":"uCACA,IAAA,EAAA,EAAA,CAAA,CAAA,OACO,IAAM,EAAU,CAAA,EAAA,EAAA,uBAAA,AAAuB,EAC1C,WAAa,MAAU,AAAJ,MAAU,4NAA8N,EAC3P,4IACA,WAES,EAAc,CAAA,EAAA,EAAA,uBAAA,AAAuB,EAC9C,WAAa,MAAM,AAAI,MAAM,oOAAsO,EACnQ,4IACA,8EATJ,IAAA,EAAA,EAAA,CAAA,CAAA,OACO,IAAM,EAAU,CAAA,EAAA,EAAA,uBAAA,AAAuB,EAC1C,WAAa,MAAM,AAAI,MAAM,4NAA8N,EAC3P,wHACA,WAES,EAAc,CAAA,EAAA,EAAA,uBAAA,AAAuB,EAC9C,WAAa,MAAM,AAAI,MAAM,oOAAsO,EACnQ,wHACA,0JCVJ,EAAA,EAAA,CAAA,CAAA,OAEA,EAAA,EAAA,CAAA,CAAA,OCFA,EAAA,CAAA,CAAA,OAEA,IAAA,EAAA,EAAA,CAAA,CAAA,OCyFO,SAAS,EAAgB,CAAc,EAC5C,OAAO,OAAO,GAAU,GAC1B,CAEO,SAAS,EAAe,CAAe,CAAE,CAAwB,EACtE,IAAM,EAAc,OAAO,EAAI,WAAW,EACpC,EAAS,OAAO,EAAI,MAAM,EAC1B,EAAQ,EAAgB,EAAI,WAAW,EACvC,EAAc,OAAO,EAAI,WAAW,EACpC,EAAU,EAAgB,EAAI,aAAa,EAI3C,EAAM,EAAc,EAAI,EAAQ,EAAc,KAIhD,EAAc,EACd,EAAiB,EAErB,GAAoB,IAAhB,GAAqB,EAAQ,EAC/B,CADkC,CACpB,EACd,EAAiB,OACZ,GAAI,GAAmB,EAAc,GAAa,OAAR,EAAc,CAC7D,IAAM,EAAY,EAAgB,GAC9B,EAAM,IACR,EAAc,EAAQ,EAAY,CADf,CAEnB,EAAiB,EAAY,EAEjC,CAEA,IAAM,EAAe,EAAQ,EAAK,EAAc,EAAS,IAAM,EAE/D,MAAO,aACL,SACA,QACA,cACA,UACA,EACA,IA5BU,EAAc,EAAK,EAAS,EAAe,IAAM,KA6B3D,IA5BU,EAAS,EAAI,EAAQ,EAAS,SA6BxC,EACA,KA5BW,EAAQ,EAAI,EAAU,EAAQ,KA6BzC,eA5BqB,EAAS,EAAK,EAAc,EAAU,IAAM,KA6BjE,2BACA,iBACA,CACF,CACF,CAwCO,SAAS,EACd,CAAU,CACV,CAA4B,EAE5B,IAAM,EAAI,IAAI,KAAK,GAEnB,OAAQ,GACN,IAAK,MAAO,CACV,IAAM,EAAQ,IAAI,KAAK,EAAE,WAAW,GAAI,EAAE,QAAQ,GAAI,EAAE,OAAO,IACzD,EAAM,IAAI,KAAK,GAGrB,OAFA,EAAI,OAAO,CAAC,EAAI,OAAO,GAAK,GAC5B,EAAI,eAAe,CAAC,CAAC,GACd,OAAE,MAAO,EAAK,MAAO,EAAM,WAAW,GAAG,KAAK,CAAC,IAAI,CAAC,EAAG,AAAD,CAC/D,CAEA,IAAK,OAAQ,CACX,IAAM,EAAM,EAAE,MAAM,GACd,EAAO,EAAE,OAAO,GAAK,GAAO,AAAQ,GAAT,GAAa,CAAC,GAAI,CAAC,CAC9C,EAAQ,IAAI,KAAK,EAAE,WAAW,GAAI,EAAE,QAAQ,GAAI,GAChD,EAAM,IAAI,KAAK,GACrB,EAAI,OAAO,CAAC,EAAI,OAAO,GAAK,GAC5B,EAAI,eAAe,CAAC,CAAC,GACrB,IAAM,EAAU,KAAK,IAAI,CACvB,CAAC,CAAC,EAAM,OAAO,GAAK,IAAI,KAAK,EAAM,WAAW,GAAI,EAAG,GAAG,OAAO,EAAA,CAAE,CAAI,OAAW,CAAC,CAAI,GAEvF,MAAO,OAAE,MAAO,EAAK,MAAO,CAAA,EAAG,EAAM,WAAW,GAAG,EAAE,EAAE,OAAO,GAAS,QAAQ,CAAC,EAAG,KAAA,CAAM,AAAC,CAC5F,CAEA,IAAK,QAAS,CACZ,IAAM,EAAQ,IAAI,KAAK,EAAE,WAAW,GAAI,EAAE,QAAQ,GAAI,GAEtD,MAAO,OACL,EACA,IAHU,IAAI,KAAK,EAAE,WAAW,GAAI,EAAE,QAAQ,GAAK,EAAG,EAAG,GAAI,GAAI,GAAI,KAIrE,MAAO,CAAA,EAAG,EAAM,WAAW,GAAG,CAAC,EAAE,OAAO,EAAM,QAAQ,GAAK,GAAG,QAAQ,CAAC,EAAG,KAAA,CAAM,AAClF,CACF,CAEA,IAAK,UAAW,CACd,IAAM,EAAU,KAAK,KAAK,CAAC,EAAE,QAAQ,GAAK,GACpC,EAAQ,IAAI,KAAK,EAAE,WAAW,GAAc,EAAV,EAAa,GAErD,MAAO,OAAE,EAAO,IADJ,IAAI,KAAK,EAAE,WAAW,GAAc,EAAV,EAAc,EAAG,EAAG,GAAI,GAAI,GAAI,KACjD,MAAO,CAAA,EAAG,EAAM,WAAW,GAAG,EAAE,EAAE,EAAU,EAAA,CAAG,AAAC,CACvE,CAEA,IAAK,OAGH,MAAO,CAAE,MAFK,IAAI,KAAK,EAAE,WAAW,GAAI,EAAG,GAE3B,IADJ,IAAI,KAAK,EAAE,WAAW,GAAI,GAAI,GAAI,GAAI,GAAI,GAAI,KACrC,MAAO,OAAO,EAAE,WAAW,GAAI,CAExD,CACF,CChOA,IAAM,EAAc,IAAI,IAyGX,EAAe,IAnGrB,AAmGyB,MAnGnB,AACM,KAAc,AAE/B,aAAY,EAAwB,CAAC,CAAC,CAAE,CACtC,IAAI,CAAC,KAAK,CAAG,EAAQ,KAAK,EAZP,EAYW,CAChC,CAEA,AAfyB,IAerB,CAAW,AAfe,CAekB,CAC9C,IAAM,EAAS,EAAY,GAAG,CAAC,UAE/B,AAAK,EAED,EAFA,EAEI,EAFK,GAEI,EAAO,SAAS,EAAE,AACjC,EAAY,MAAM,CAAC,GACZ,MAGF,EAAO,IAAI,CAPE,IAQtB,CAEA,IAAI,CAAW,CAAE,CAA4B,CAAE,CAAc,CAAQ,CACnE,IAAM,EAAM,IAAI,KACV,EAAY,IAAI,KAAK,EAAI,OAAO,GAAM,EAAD,EAAU,IAAI,CAAC,KAAA,AAAK,GAE/D,EAAY,GAAG,CAAC,EAAK,KACnB,OACA,EACA,WAAY,EACZ,WACF,EACF,CAEA,WAAW,CAAW,CAAW,CAC/B,OAAO,EAAY,MAAM,CAAC,EAC5B,CAEA,kBAAkB,CAAe,CAAU,CACzC,IAAI,EAAQ,EACN,EAAQ,IAAI,OAAO,EAAQ,OAAO,CAAC,MAAO,OAEhD,IAAK,IAAM,KAAO,EAAY,IAAI,GAAI,AAChC,EAAM,IAAI,CAAC,KACb,CADmB,CACP,MAAM,CAAC,GACnB,KAIJ,OAAO,CACT,CAEA,uBAAuB,CAAsB,CAAU,CACrD,OAAO,IAAI,CAAC,iBAAiB,CAAC,CAAC,QAAQ,EAAE,EAAe,GAAG,CAAC,CAC9D,CAEA,OAAc,CACZ,EAAY,KAAK,EACnB,CAEA,MAAe,CACb,OAAO,EAAY,IAAI,AACzB,CAEA,OAAgB,CACd,IAAM,EAAM,IAAI,KACZ,EAAS,EAEb,IAAK,GAAM,CAAC,EAAK,EAAO,GAAI,EAAY,OAAO,GAAI,AAC7C,EAAM,EAAO,SAAS,EAAE,CAC1B,EAAY,MAAM,CAAC,GACnB,KAIJ,OAAO,CACT,CAEA,UAKE,CACA,IAAI,EAAsB,KACtB,EAAsB,KAE1B,IAAK,IAAM,KAAU,EAAY,MAAM,GAAI,CACrC,CAAC,GAAU,EAAO,UAAU,CAAG,CAAA,GAAQ,GAAS,EAAO,UAAA,AAAU,GACjE,CAAC,GAAU,EAAO,UAAU,CAAG,CAAA,IAAQ,EAAS,EAAO,UAAA,AAAU,EAGvE,MAAO,CACL,KAAM,EAAY,IAAI,CACtB,KAAM,MAAM,IAAI,CAAC,EAAY,IAAI,IACjC,YAAa,EACb,YAAa,CACf,CACF,CACF,EClFM,EAA4B,OAAO,MA2a5B,EAAoB,IAAI,AAza9B,MAAM,AACM,MAAmC,CACnC,KAAoB,AAErC,aAAY,EAA2B,CAAC,CAAC,CAAE,CACzC,IAAI,CAAC,MAAM,CAAG,CACZ,gBAAiB,EAAO,eAAe,EAAI,EAC3C,SAAU,EAAO,QAAQ,GAAI,EAC7B,WAAY,EAAO,UAAU,EAAI,GACnC,CADuC,CAEvC,IAF4C,AAExC,CAAC,KAAK,CAAG,CACf,CAEA,MAAM,kBAAkB,CAIvB,CAAmC,aAC5B,GFyHoB,EEzHK,CAC7B,GF8HL,EE/HoB,UACC,EAAO,MAAM,CAAC,cAAc,CAC5C,YAAa,EAAO,WAAW,CAC/B,SAAU,KACV,YAAa,EAAO,WAAW,CAC/B,UAAW,EAAO,MAAM,CAAC,SAAS,AACpC,EF0HI,EAAU,CAAA,EAAG,EAAO,SAAS,CAAC,KAAK,CAAC,WAAW,GAAG,KAAK,CAAC,IAAI,CAAC,EAAE,CAAC,CAAC,EAAE,EAAO,SAAS,CAAC,GAAG,CAAC,WAAW,GAAG,KAAK,CAAC,IAAI,CAAC,EAAE,CAAA,CAAE,CACpH,CAAC,QAAQ,EAAE,EAAO,cAAc,CAAC,CAAC,EAAE,EAAO,WAAW,CAAC,CAAC,EAAE,EAAO,QAAQ,EAAI,MAAM,CAAC,EAAE,EAAO,WAAW,CAAC,CAAC,EAAE,EAAA,CAAS,EEzH1H,GAAI,IAAI,CAAC,MAAM,CAAC,QAAQ,CAAE,CACxB,IAAM,EAAS,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,GAC9B,GAAI,EAAQ,OAAO,CACrB,CAEA,IAAM,EAAO,MAAM,IAAI,CAAC,YAAY,CAAC,GAMrC,OAJI,IAAI,CAAC,MAAM,CAAC,QAAQ,EAAE,AACxB,IAAI,CAAC,KAAK,CAAC,GAAG,CAAC,EAAU,EAAM,IAAI,CAAC,MAAM,CAAC,UAAU,EAGhD,CACT,CAEA,MAAc,aAAa,CAI1B,CAAmC,CAClC,GAAM,QAAE,CAAM,aAAE,CAAW,CAAE,aAAW,CAAE,CAAG,EAE7C,OAAQ,GACN,IAAK,eACH,OAAO,IAAI,CAAC,qBAAqB,CAAC,EAAQ,EAC5C,KAAK,WACH,OAAO,IAAI,CAAC,mBAAmB,CAAC,EAAQ,EAC1C,KAAK,aACH,OAAO,IAAI,CAAC,oBAAoB,CAAC,EAAQ,EAC3C,KAAK,WACH,OAAO,IAAI,CAAC,mBAAmB,CAAC,EAAQ,EAC1C,KAAK,KACH,OAAO,IAAI,CAAC,aAAa,CAAC,EAAQ,EACpC,SACE,MAAO,EAAE,AACb,CACF,CAEA,MAAc,sBACZ,CAAqB,CACrB,CAA4B,CACK,CACjC,IAAM,EAAU,MAAM,EAAA,MAAM,CAAC,oBAAoB,CAAC,QAAQ,CAAC,CACzD,MAAO,CACL,eAAgB,EAAO,cAAc,CACrC,KAAM,CAAE,IAAK,EAAO,SAAS,CAAC,KAAK,CAAE,IAAK,EAAO,SAAS,CAAC,GAAG,AAAC,EAC/D,GAAI,EAAO,aAAa,EAAE,OACtB,CAAE,SAAU,CAAE,KAAM,CAAE,GAAI,EAAO,aAAa,AAAsD,CAAE,CAAE,EACxG,CAAC,CAAC,AACR,EACA,OAAQ,CACN,MAAM,EACN,aAAa,EACb,QAAQ,EACR,aAAa,EACb,aAAa,EACb,eAAe,CACjB,CACF,GAEA,OAAO,IAAI,CAAC,aAAa,CAAC,EAAS,EAAa,CAC9C,YAAa,eACb,SAAU,EAAO,cAAc,CAC/B,WAAY,qBACZ,aAAc,IAChB,EACF,CAEA,MAAc,oBACZ,CAAqB,CACrB,CAA4B,CACK,CACjC,IAAM,EAAU,MAAM,EAAA,MAAM,CAAC,oBAAoB,CAAC,QAAQ,CAAC,CACzD,MAAO,CACL,eAAgB,EAAO,cAAc,CACrC,KAAM,CAAE,IAAK,EAAO,SAAS,CAAC,KAAK,CAAE,IAAK,EAAO,SAAS,CAAC,GAAG,AAAC,EAC/D,GAAI,EAAO,aAAa,EAAE,OACtB,CAAE,SAAU,CAAE,KAAM,CAAE,GAAI,EAAO,aAAa,AAAsD,CAAE,CAAE,EACxG,CAAC,CAAC,AACR,EACA,OAAQ,CACN,MAAM,EACN,aAAa,EACb,QAAQ,EACR,aAAa,EACb,aAAa,EACb,eAAe,EACf,SAAU,CAAE,OAAQ,CAAE,MAAM,EAAM,MAAM,CAAK,CAAE,CACjD,CACF,GAEM,EAAa,IAAI,IACvB,IAAK,IAAM,KAAK,EAAS,CACvB,IAAM,EAAM,EAAE,QAAQ,CAAC,IACnB,AADuB,CACtB,EAAW,GAAG,CAAC,IAAM,EAAW,GAAG,CAAC,EAAK,EAAE,EAChD,EAAW,GAAG,CAAC,GAAM,IAAI,CAAC,EAC5B,CAEA,IAAM,EAAkC,EAAE,CAC1C,IAAK,GAAM,CAAC,EAAc,EAAgB,GAAI,EAAY,CACxD,IAAM,EAAe,CAAe,CAAC,EAAE,EAAE,SAAS,MAAQ,EACpD,EAAO,IAAI,CAAC,aAAa,CAAC,EAAiB,EAAa,CAC5D,YAAa,WACb,SAAU,EACV,WAAY,eACZ,CACF,GACA,EAAQ,IAAI,IAAI,EAClB,CAEA,OAAO,EAAQ,IAAI,CAAC,CAAC,EAAG,IAAM,EAAE,WAAW,CAAC,OAAO,GAAK,EAAE,WAAW,CAAC,OAAO,GAC/E,CAEA,MAAc,qBACZ,CAAqB,CACrB,CAA4B,CACK,CACjC,IAAM,EAAU,MAAM,EAAA,MAAM,CAAC,oBAAoB,CAAC,QAAQ,CAAC,CACzD,MAAO,CACL,eAAgB,EAAO,cAAc,CACrC,KAAM,CAAE,IAAK,EAAO,SAAS,CAAC,KAAK,CAAE,IAAK,EAAO,SAAS,CAAC,GAAG,AAAC,EAC/D,GAAI,EAAO,YAAY,EAAE,OAAS,CAAE,YAAa,CAAE,GAAI,EAAO,YAAY,AAAC,CAAE,EAAI,CAAC,CAAC,CACnF,GAAI,EAAO,aAAa,EAAE,OACtB,CAAE,SAAU,CAAE,KAAM,CAAE,GAAI,EAAO,aAAa,AAAsD,CAAE,CAAE,EACxG,CAAC,CAAC,AACR,EACA,OAAQ,CACN,MAAM,EACN,aAAa,EACb,aAAa,EACb,QAAQ,EACR,aAAa,EACb,aAAa,EACb,eAAe,EACf,UAAW,CAAE,OAAQ,CAAE,MAAM,CAAK,CAAE,EACpC,SAAU,CAAE,OAAQ,CAAE,MAAM,CAAK,CAAE,CACrC,CACF,GAEM,EAAY,IAAI,IACtB,IAAK,IAAM,KAAK,EACV,AAAC,EAAU,GAAG,CADK,AACJ,EAAE,WAAW,GAAG,EAAU,GAAG,CAAC,EAAE,WAAW,CAAE,EAAE,EAClE,EAAU,GAAG,CAAC,EAAE,WAAW,EAAG,IAAI,CAAC,GAGrC,IAAM,EAAkC,EAAE,CAC1C,IAAK,GAAM,CAAC,EAAW,EAAe,GAAI,EAAW,CACnD,IAAM,EAAc,CAAc,CAAC,EAAE,EAAE,UAAU,MAAQ,EACnD,EAAe,CAAc,CAAC,EAAE,EAAE,SAAS,MAAQ,KACnD,EAAO,IAAI,CAAC,aAAa,CAAC,EAAgB,EAAa,CAC3D,YAAa,aACb,SAAU,EACV,WAAY,eACZ,CACF,GACA,EAAQ,IAAI,IAAI,EAClB,CAEA,OAAO,EAAQ,IAAI,CAAC,CAAC,EAAG,IAAM,EAAE,WAAW,CAAC,OAAO,GAAK,EAAE,WAAW,CAAC,OAAO,GAC/E,CAEA,MAAc,oBACZ,CAAqB,CACrB,CAA4B,CACK,CACjC,IAAM,EAAU,MAAM,EAAA,MAAM,CAAC,mBAAmB,CAAC,QAAQ,CAAC,CACxD,MAAO,CACL,eAAgB,EAAO,cAAc,CACrC,KAAM,CAAE,IAAK,EAAO,SAAS,CAAC,KAAK,CAAE,IAAK,EAAO,SAAS,CAAC,GAAG,AAAC,EAC/D,GAAI,EAAO,WAAW,EAAE,OAAS,CAAE,WAAY,CAAE,GAAI,EAAO,WAAW,AAAC,CAAE,EAAI,CAAC,CAAC,CAChF,GAAI,EAAO,YAAY,EAAE,OAAS,CAAE,YAAa,CAAE,GAAI,EAAO,YAAY,AAAC,CAAE,EAAI,CAAC,CAAC,CACnF,GAAI,EAAO,aAAa,EAAE,OACtB,CAAE,SAAU,CAAE,KAAM,CAAE,GAAI,EAAO,aAAa,AAAsD,CAAE,CAAE,EACxG,CAAC,CAAC,AACR,EACA,OAAQ,CACN,KAAM,GACN,YAAY,EACZ,aAAa,EACb,QAAQ,EACR,aAAa,EACb,aAAa,EACb,eAAe,EACf,SAAU,CAAE,OAAQ,CAAE,MAAM,CAAK,CAAE,EACnC,SAAU,CAAE,OAAQ,CAAE,KAAM,EAAK,CAAE,CACrC,CACF,GAEM,EAAa,IAAI,IACvB,IAAK,IAAM,KAAK,EACV,AAAC,EAAW,GAAG,CAAC,AADG,EACD,UAAU,GAAG,EAAW,GAAG,CAAC,EAAE,UAAU,CAAE,EAAE,EAClE,EAAW,GAAG,CAAC,EAAE,UAAU,EAAG,IAAI,CAAC,GAGrC,IAAM,EAAkC,EAAE,CAC1C,IAAK,GAAM,CAAC,EAAY,EAAgB,GAAI,EAAY,CACtD,IAAM,EAAe,CAAe,CAAC,EAAE,EAAE,SAAS,MAAQ,EACpD,EAAe,CAAe,CAAC,EAAE,EAAE,SAAS,MAAQ,KACpD,EAAO,IAAI,CAAC,aAAa,CAAC,EAAiB,EAAa,CAC5D,YAAa,WACb,SAAU,EACV,WAAY,eACZ,CACF,GACA,EAAQ,IAAI,IAAI,EAClB,CAEA,OAAO,EAAQ,IAAI,CAAC,CAAC,EAAG,IAAM,EAAE,WAAW,CAAC,OAAO,GAAK,EAAE,WAAW,CAAC,OAAO,GAC/E,CAEA,MAAc,cACZ,CAAqB,CACrB,CAA4B,CACK,CACjC,IAAM,EAAU,MAAM,EAAA,MAAM,CAAC,aAAa,CAAC,QAAQ,CAAC,CAClD,MAAO,CACL,eAAgB,EAAO,cAAc,CACrC,KAAM,CAAE,IAAK,EAAO,SAAS,CAAC,KAAK,CAAE,IAAK,EAAO,SAAS,CAAC,GAAG,AAAC,EAC/D,GAAI,EAAO,KAAK,EAAE,OAAS,CAAE,KAAM,CAAE,GAAI,EAAO,KAAK,AAAC,CAAE,EAAI,CAAC,CAAC,CAC9D,GAAI,EAAO,WAAW,EAAE,OAAS,CAAE,WAAY,CAAE,GAAI,EAAO,WAAW,AAAC,CAAE,EAAI,CAAC,CAAC,CAChF,GAAI,EAAO,YAAY,EAAE,OAAS,CAAE,YAAa,CAAE,GAAI,EAAO,YAAY,AAAC,CAAE,EAAI,CAAC,CAAC,CACnF,GAAI,EAAO,aAAa,EAAE,OACtB,CAAE,SAAU,CAAE,KAAM,CAAE,GAAI,EAAO,aAAa,AAAsD,CAAE,CAAE,EACxG,CAAC,CAAC,AACR,EACA,OAAQ,CACN,MAAM,EACN,MAAM,EACN,aAAa,EACb,QAAQ,EACR,aAAa,EACb,aAAa,EACb,eAAe,EACf,GAAI,CAAE,OAAQ,CAAE,MAAM,CAAK,CAAE,EAC7B,SAAU,CAAE,OAAQ,CAAE,MAAM,CAAK,CAAE,CACrC,CACF,GAEM,EAAO,IAAI,IACjB,IAAK,IAAM,KAAK,EACV,AAAC,EAAK,GAAG,CADU,AACT,EAAE,IAAI,GAAG,EAAK,GAAG,CAAC,EAAE,IAAI,CAAE,EAAE,EAC1C,EAAK,GAAG,CAAC,EAAE,IAAI,EAAG,IAAI,CAAC,GAGzB,IAAM,EAAkC,EAAE,CAC1C,IAAK,GAAM,CAAC,EAAM,EAAU,GAAI,EAAM,CACpC,IAAM,EAAS,CAAS,CAAC,EAAE,EAAE,GAAG,MAAQ,EAClC,EAAe,CAAS,CAAC,EAAE,EAAE,SAAS,MAAQ,KAC9C,EAAO,IAAI,CAAC,aAAa,CAAC,EAAW,EAAa,CACtD,YAAa,KACb,SAAU,EACV,WAAY,eACZ,CACF,GACA,EAAQ,IAAI,IAAI,EAClB,CAEA,OAAO,EAAQ,IAAI,CAAC,CAAC,EAAG,IAAM,EAAE,WAAW,CAAC,OAAO,GAAK,EAAE,WAAW,CAAC,OAAO,GAC/E,CAEQ,cACN,CAOE,CACF,CAA4B,CAC5B,CAKC,CACuB,CACxB,IAAM,EAAW,IAAI,IAErB,IAAK,IAAM,KAAK,EAAS,CACvB,GAAM,OAAE,CAAK,CAAE,CAAG,EAAgB,EAAE,IAAI,CAAE,EAEtC,CAAC,EAAS,GAAG,CAAC,IAChB,EAAS,EADe,CACZ,CAAC,EAAO,CAClB,YAAa,OAAO,GACpB,OAAQ,OAAO,GACf,YAAa,OAAO,GACpB,YAAa,OAAO,GACpB,cAAe,OAAO,EACxB,GAGF,IAAM,EAAM,EAAS,GAAG,CAAC,GACzB,EAAI,WAAW,EAAI,EAAE,WAAW,CAChC,EAAI,MAAM,EAAI,EAAE,MAAM,CACtB,EAAI,WAAW,EAAI,EAAE,WAAW,CAChC,EAAI,WAAW,EAAI,EAAE,WAAW,CAChC,EAAI,aAAa,EAAI,EAAE,aAAa,AACtC,CAEA,IAAM,EAA+B,EAAE,CAEvC,IAAK,GAAM,CAAC,EAAQ,EAAI,GAAI,EAAU,CACpC,IAAM,EAAa,EAAQ,IAAI,CAAC,AAAC,IAC/B,GAAM,CAAE,OAAK,CAAE,CAAG,EAAgB,EAAE,IAAI,CAAE,GAC1C,OAAO,IAAU,CACnB,IAAI,KAEJ,GAAI,CAAC,EAAY,SAEjB,GAAM,OAAE,CAAK,KAAE,CAAG,CAAE,CAAG,EAAgB,EAAY,GAEnD,EAAK,IAAI,CAAC,QACR,EACA,YAAa,EACb,UAAW,EACX,SAAU,EAAO,QAAQ,CACzB,WAAY,EAAO,UAAU,CAC7B,YAAa,EAAO,WAAW,CAC/B,aAAc,EAAO,YAAY,CACjC,QAAS,EAAe,EAAK,IAAI,CAAC,MAAM,CAAC,eAAe,CAC1D,EACF,CAEA,OAAO,EAAK,IAAI,CAAC,CAAC,EAAG,IAAM,EAAE,WAAW,CAAC,OAAO,GAAK,EAAE,WAAW,CAAC,OAAO,GAC5E,CAEA,MAAM,WAAW,CAIhB,CAA2B,CAC1B,MAAM,EAAiB,MAAM,IAAI,CAAC,cAAc,CAAC,EAAO,MAAM,CAAE,EAAO,WAAW,EAElF,GAAI,CAAC,EAAO,eAAe,CACzB,CAD2B,KACpB,CAAE,QAAS,EAAgB,SAAU,KAAM,OAAQ,IAAK,EAGjE,IAAM,EAAY,KAAK,IAAI,CACzB,CAAC,EAAO,MAAM,CAAC,SAAS,CAAC,GAAG,CAAC,OAAO,GAAK,EAAO,MAAM,CAAC,SAAS,CAAC,KAAK,CAAC,OAAO,EAAA,CAAE,CAC7E,GAAD,IAAQ,AAGN,EAAc,GAHH,CAGO,IAHF,CAGO,CAHL,CAGY,MAAM,CAAC,SAAS,CAAC,KAAK,EAC1D,EAAY,OAAO,CAAC,EAAY,OAAO,GAAK,GAC5C,IAAM,EAAgB,IAAI,KAAK,GAC/B,EAAc,OAAO,CAAC,EAAc,OAAO,GAAK,EAAY,GAE5D,IAAM,EAAgC,CACpC,GAAG,EAAO,MAAM,CAChB,UAAW,CAAE,MAAO,EAAe,IAAK,CAAY,CACtD,EAEM,EAAkB,MAAM,IAAI,CAAC,cAAc,CAAC,EAAgB,EAAO,WAAW,EAEpF,MAAO,CACL,QAAS,EACT,SAAU,EACV,OFtQG,CACL,AEqQU,YFrQG,CANT,EAAY,CAAC,EAAc,IAClB,AAAb,GAAgB,CAAZ,EAA8B,KAAX,CAAiB,CAAV,GACtB,CAAC,EAAO,CAAA,CAAI,CAAI,EAAQ,KAIT,EAAQ,WAAW,CAAE,AEqQJ,EFrQa,WAAW,EAChE,OAAQ,EAAU,EAAQ,MAAM,CAAE,EAAS,MAAM,EACjD,MAAO,EAAU,EAAQ,KAAK,CAAE,EAAS,KAAK,EAC9C,YAAa,EAAU,EAAQ,WAAW,CAAE,EAAS,WAAW,EAChE,QAAS,EAAU,EAAQ,OAAO,CAAE,EAAS,OAAO,EACpD,IACkB,OAAhB,EAAQ,GAAG,EAA8B,OAAjB,EAAS,GAAG,CAChC,EAAU,EAAQ,GAAG,CAAE,EAAS,GAAG,EACnC,KACN,KACmB,OAAjB,EAAQ,IAAI,EAA+B,OAAlB,EAAS,IAAI,CAClC,EAAU,AE0PQ,EF1PA,IAAI,CAAE,EAAS,IAAI,EACrC,KACN,aAAc,EAAQ,YAAY,CAAG,EAAS,YAChD,AAD4D,CEyP1D,CACF,CAEA,MAAc,eACZ,CAAqB,CACrB,CAAwB,CACG,CAC3B,IAAM,EAAO,MAAM,IAAI,CAAC,iBAAiB,CAAC,QACxC,EACA,YAAa,kBACb,CACF,GAEM,EAAqB,CACzB,YAAa,OAAO,GACpB,OAAQ,OAAO,GACf,YAAa,OAAO,GACpB,YAAa,OAAO,GACpB,cAAe,OAAO,EACxB,EAEA,IAAK,IAAM,KAAO,EAChB,EAAO,CADe,UACJ,EAAI,OAAO,KAAK,KAAK,CAAC,EAAI,OAAO,CAAC,WAAW,GAC/D,EAAO,MAAM,EAAI,OAAO,KAAK,KAAK,CAAC,EAAI,OAAO,CAAC,MAAM,GACrD,EAAO,WAAW,EAAI,OAAO,KAAK,KAAK,CAAqB,IAApB,EAAI,OAAO,CAAC,KAAK,GACzD,EAAO,WAAW,EAAI,OAAO,KAAK,KAAK,CAAC,EAAI,OAAO,CAAC,WAAW,GAC/D,EAAO,aAAa,EAAI,OAAO,KAAK,KAAK,CAAuB,IAAtB,EAAI,OAAO,CAAC,OAAO,GAG/D,OAAO,EAAe,EAAQ,IAAI,CAAC,MAAM,CAAC,eAAe,CAC3D,CAEA,gBAAgB,CAAsB,CAAU,CAC9C,OAAO,IAAI,CAAC,KAAK,CAAC,sBAAsB,CAAC,EAC3C,CAEA,WAA8B,CAC5B,MAAO,CAAE,GAAG,IAAI,CAAC,MAAM,AAAC,CAC1B,CACF,EHhcA,EAAA,CAAA,CAAA,OAAA,IAAA,EAAA,EAAA,CAAA,CAAA,OAuBO,eAAe,EAAiB,CAGtC,EACC,IAAM,EAAO,EAAO,IAAI,EAAI,GACtB,EAAU,IAAI,KACpB,EAAQ,QAAQ,CAAC,GAAI,GAAI,GAAI,KAE7B,IAAM,EAAY,IAAI,KAAK,GAC3B,EAAU,OAAO,CAAC,EAAU,OAAO,GAAK,EAAO,GAC/C,EAAU,QAAQ,CAAC,EAAG,EAAG,EAAG,GAE5B,IAAM,EAAU,MAAM,EAAkB,UAAU,CAAC,CACjD,OAAQ,CACN,eAAgB,EAAO,cAAc,CACrC,UAAW,CAAE,MAAO,EAAW,IAAK,CAAQ,CAC9C,EACA,YAAa,eACb,iBAAiB,CACnB,GAQM,EANgB,AAMG,OANG,EAAA,cAAc,CAAC,oBAAoB,CAAC,CAC9D,eAAgB,EAAO,cAAc,CACrC,WAAY,UACZ,CACF,EAAA,EAEuC,MAAM,CAAC,MAAM,CAClD,CAAC,EAAK,IAAM,EAAM,OAAO,EAAE,WAAW,EAAI,IAC1C,GAGI,EACJ,EAAQ,OAAO,CAAC,KAAK,CAAG,EACnB,EAAmB,EAAQ,OAAO,CAAC,KAAK,CAAI,IAC7C,EAEF,EAAwB,EAC5B,GAAI,EAAQ,QAAQ,EAAI,EAAQ,QAAQ,CAAC,KAAK,CAAG,EAAG,CAClD,IAAM,EAAc,IAAI,KAAK,GAC7B,EAAY,OAAO,CAAC,EAAY,OAAO,GAAK,GAQ5C,IAAM,EAAkB,CANE,MAAM,EAAA,cAAc,CAAC,oBAAoB,CAAC,CAClE,eAAgB,EAAO,cAAc,CACrC,WAAY,EACZ,QAAS,CACX,EAAA,EAE0C,MAAM,CAAC,MAAM,CACrD,CAAC,EAAK,IAAM,EAAM,OAAO,EAAE,WAAW,EAAI,IAC1C,GAGF,EACE,EAAQ,QAAQ,CAAC,KAAK,CAAG,EACpB,EAAkB,EAAQ,QAAQ,CAAC,KAAK,CAAI,IAC7C,CACR,CAEA,MAAO,CACL,WAAY,EAAQ,OAAO,CAAC,KAAK,CACjC,iBAAkB,EAAQ,OAAO,CAAC,WAAW,CAC7C,WAAY,EAAQ,OAAO,CAAC,GAAG,oBAC/B,EACA,KAAM,EAAQ,OAAO,CAAC,IAAI,CAC1B,eAAgB,EAAQ,QAAQ,CAC5B,CACE,WAAY,EAAQ,QAAQ,CAAC,KAAK,CAClC,iBAAkB,EAAQ,QAAQ,CAAC,WAAW,CAC9C,WAAY,EAAQ,QAAQ,CAAC,GAAG,CAChC,mBAAoB,CACtB,EACA,KACJ,QAAS,EAAQ,MAAM,CACnB,CACE,MAAO,EAAQ,MAAM,CAAC,KAAK,CAC3B,YAAa,EAAQ,MAAM,CAAC,WAAW,CACvC,IAAK,EAAQ,MAAM,CAAC,GAAG,CACvB,mBAAoB,EAAqB,CAC3C,EACA,IACN,CACF,CAEO,eAAe,EAAkB,CAGvC,EAwBC,MAAO,CAhBM,MAAM,EAAA,MAAM,CAAC,YAAY,CAAC,QAAQ,CAAC,CAC9C,MAAO,CACL,eAAgB,EAAO,cAAc,CACrC,OAAQ,CAAE,GAAI,CAAC,YAAa,SAAS,AAAC,CACxC,EACA,QAAS,CAAE,UAAW,MAAO,EAC7B,KAAM,EAAO,KAAK,EAAI,EACtB,OAAQ,CACN,IAAI,EACJ,UAAU,EACV,SAAS,EACT,QAAQ,EACR,WAAW,CACb,CACF,EAAA,EAEY,GAAG,CAAC,AAAC,IAA8B,CAC7C,CAD4C,EACxC,EAAI,EAAE,CACV,KAAM,AAAe,gBAAX,MAAM,CAAmB,UAAY,QAC/C,YAAa,CAAA,EAAG,EAAI,QAAQ,CAAC,CAAC,EAAE,EAAI,OAAO,CAAC,WAAW,GAAG,OAAO,CAAC,IAAK,KAAK,CAAC,EAAE,EAAI,MAAM,CAAC,WAAW,GAAA,CAAI,CACzG,UAAW,EAAI,SAAS,CAC1B,CAAC,CACH,CAEO,eAAe,EAAkB,CAGvC,EAeC,MAAO,CALU,MAAM,EAAA,cAAc,CAAC,oBAAoB,CAAC,CACzD,eAAgB,EAAO,cAAc,CACrC,WAAY,CACd,EAAA,EAEgB,MAAM,CACnB,IAAI,CAAC,CAAC,EAAG,IAAM,OAAO,EAAE,WAAW,EAAI,OAAO,EAAE,WAAW,GAC3D,KAAK,CAAC,EAAG,EAAO,KAAK,EAAI,GACzB,GAAG,CAAC,AAAC,GAAW,EACf,GADc,AACV,EAAM,EAAE,CACZ,WAAY,EAAM,UAAU,CAC5B,WAAY,EAAM,UAAU,CAC5B,YAAa,OAAO,EAAM,WAAW,EAAI,IACzC,OAAQ,EAAM,MAAM,CAAC,OAAO,CAAC,KAAM,KACnC,MAAO,EAAM,KAAK,CACpB,CAAC,CACL,CI/KA,IAAA,EAAA,EAAA,CAAA,CAAA,OLOA,SAAS,EAAe,CAAa,EACnC,OAAO,IAAI,KAAK,YAAY,CAAC,QAAS,CACpC,MAAO,WACP,SAAU,MACV,sBAAuB,EACvB,sBAAuB,CACzB,GAAG,MAAM,CAAC,EACZ,CAUA,SAAS,EAAS,CAAqB,CAAE,GAAS,CAAK,EACrD,GAAI,AAAW,UAAmB,IAAX,EAAc,MAAO,UAC5C,IAAM,EAAO,EAAS,SACtB,AAAI,EAAe,EAAO,IAAd,GAAuB,KAC5B,EAAO,KAAO,MACvB,CAEe,eAAe,YAC5B,IAAM,EAAU,MAAM,CAAA,EAAA,EAAA,gBAAA,AAAgB,EAAC,EAAA,WAAW,EAC5C,EAAQ,GAAS,MAAM,YAEzB,EAAO,KACP,EAAgE,EAAE,CAClE,EAA6D,EAAE,CAEnE,GAAI,EACF,GAAI,CACF,CAFO,AAEN,EAAM,EAAgB,EAAY,CAAG,MAAM,QAAQ,GAAG,CAAC,CACtD,EAAiB,CAAE,eAAgB,EAAO,KAAM,EAAG,GACnD,EAAkB,CAAE,eAAgB,EAAO,MAAO,CAAE,GACpD,EAAkB,CAAE,eAAgB,EAAO,MAAO,CAAE,GACrD,CACH,CAAE,MAAO,EAAO,CACd,QAAQ,KAAK,CAAC,iCAAkC,EAClD,CAGF,MACE,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,sBACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,WACC,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,iDAAwC,cACtD,CAAA,EAAA,EAAA,IAAA,EAAC,IAAA,CAAE,UAAU,uCAA6B,iBACzB,GAAS,MAAM,MAAQ,GAAS,MAAM,YAIzD,CAAA,EAAA,EAAA,IAAA,EAAC,EAAA,WAAW,CAAA,WACV,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,OAAO,CAAA,CACN,MAAM,cACN,MAAO,EAAO,EAAe,EAAK,UAAU,EAAI,QAChD,OAAQ,GAAM,SAAS,OAAS,KAChC,YAAY,iBACZ,MAAO,EAAS,GAAM,SAAS,OAAS,MACxC,KAAM,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,CAAA,KAET,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,OAAO,CAAA,CACN,MAAM,cACN,MAAO,GAvDK,EAuDe,EAAb,AAAkB,CAvDP,eAuDuB,CAtDjD,IAAI,KAAK,YAAY,CAAC,SAAS,MAAM,CAAC,IAsDe,IACpD,OAAQ,GAAM,SAAS,aAAe,KACtC,YAAY,iBACZ,MAAO,EAAS,GAAM,SAAS,aAAe,MAC9C,KAAM,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,CAAA,KAET,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,OAAO,CAAA,CACN,MAAM,MACN,MAAO,GAAM,WAAa,EAAe,EAAK,UAAU,EAAI,IAC5D,OAAQ,GAAM,SAAS,KAAO,KAC9B,YAAY,iBACZ,MAAO,EAAS,GAAM,SAAS,KAAO,MAAM,GAC5C,KAAM,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,CAAA,KAET,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,OAAO,CAAA,CACN,MAAM,eACN,MAAO,GAnEM,EAmEe,EAAd,AAAmB,CAnEP,iBAmEyB,CAlEpD,CAAA,EAAG,EAAM,OAAO,CAAC,GAAG,CAAC,CAAC,EAkEkC,OACvD,OAAQ,GAAM,SAAS,oBAAsB,KAC7C,YAAY,iBACZ,MAAO,EAAS,GAAM,SAAS,oBAAsB,MAAM,GAC3D,KAAM,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,CAAA,QAIX,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,sCACb,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,2DACb,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,6CAAoC,oBACjD,EAAe,MAAM,CAAG,EACvB,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,0BACX,EAAe,GAAG,CAAE,AAAD,GAClB,CAAA,EAAA,EAAA,IAAA,EAAC,KAAA,CAAqB,UAAU,mCAC9B,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CACC,UAAW,CAAC,4BAA4B,EACpB,YAAlB,EAAS,IAAI,CAAiB,eAAiB,aAAA,CAC/C,GAEJ,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,mBACb,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,iCAAyB,EAAS,WAAW,GAC1D,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,iCACV,EAAS,SAAS,CAAC,cAAc,UAT/B,EAAS,EAAE,KAgBxB,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,sCAA6B,0BAI9C,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,2DACb,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,6CAAoC,iBACjD,EAAY,MAAM,CAAG,EACpB,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,0BACX,EAAY,GAAG,CAAC,AAAC,GAChB,CAAA,EAAA,EAAA,IAAA,EAAC,KAAA,CAAkB,UAAU,mDAC3B,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,WACC,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,6CAAqC,EAAM,UAAU,GAClE,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,4CAAoC,EAAM,MAAM,MAE/D,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CACC,UAAW,CAAC,6CAA6C,EACvC,aAAhB,EAAM,KAAK,CACP,0BACgB,SAAhB,EAAM,KAAK,CACX,gCACA,gCAAA,CACJ,UAED,EAAe,EAAM,WAAW,MAd5B,EAAM,EAAE,KAoBrB,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,sCAA6B,0BAKhD,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,2DACb,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,6CAAoC,kBAClD,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,sCACb,CAAA,EAAA,EAAA,IAAA,EAAC,IAAA,CACC,KAAK,oBACL,UAAU,0IAEV,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,UAAK,OAAS,0BAEjB,CAAA,EAAA,EAAA,IAAA,EAAC,IAAA,CACC,KAAK,iBACL,UAAU,0IAEV,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,UAAK,OAAS,qBAEjB,CAAA,EAAA,EAAA,IAAA,EAAC,IAAA,CACC,KAAK,aACL,UAAU,0IAEV,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,UAAK,OAAS,0BAM3B,CAEA,SAAS,IACP,MACE,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,UAAU,KAAK,OAAO,OAAO,eAAe,QAAQ,qBACjE,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,cAAc,QAAQ,eAAe,QAAQ,YAAa,IAAK,EAAE,iLAG7E,CAEA,SAAS,IACP,MACE,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,UAAU,KAAK,OAAO,OAAO,eAAe,QAAQ,qBACjE,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,cAAc,QAAQ,eAAe,QAAQ,YAAa,IAAK,EAAE,mDAG7E,CAEA,SAAS,IACP,MACE,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,UAAU,KAAK,OAAO,OAAO,eAAe,QAAQ,qBACjE,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,cAAc,QAAQ,eAAe,QAAQ,YAAa,IAAK,EAAE,oFAG7E,CAEA,SAAS,IACP,MACE,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,UAAU,KAAK,OAAO,OAAO,eAAe,QAAQ,qBACjE,CAAA,EAAA,EAAA,GAAA,EAAC,OAAA,CAAK,cAAc,QAAQ,eAAe,QAAQ,YAAa,IAAK,EAAE,0IAG7E","ignoreList":[0]}