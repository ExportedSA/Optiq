module.exports=[79496,a=>{"use strict";var b=a.i(30091),c=a.i(51729);function d(a){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}).format(a)}function e(a){return new Intl.NumberFormat("en-US").format(a)}function f(a){return Number(a)/1e6}let g={critical:"bg-red-100 text-red-700",high:"bg-orange-100 text-orange-700",medium:"bg-yellow-100 text-yellow-700",low:"bg-zinc-100 text-zinc-700",none:"bg-zinc-100 text-zinc-700"};function h(a){return a.replace(/_/g," ")}function i(){let[a,i]=(0,c.useState)(7),[j,k]=(0,c.useState)(!0),[l,m]=(0,c.useState)(null),[n,o]=(0,c.useState)(null),[p,q]=(0,c.useState)(null),[r,s]=(0,c.useState)(null),[t,u]=(0,c.useState)(!1),v=(0,c.useMemo)(()=>n&&p?n.alerts.find(a=>a.id===p)??null:null,[n,p]),w=n?f(n.totals.totalWastedSpendMicros):0,x=(0,c.useCallback)(async()=>{k(!0),m(null);try{let b=await fetch(`/api/waste/alerts?windowDays=${a}`);if(!b.ok)throw Error("Failed to load waste alerts");let c=await b.json();o(c),c.alerts.length>0&&!p&&q(c.alerts[0].id)}catch(a){m(a instanceof Error?a.message:"Unknown error")}finally{k(!1)}},[a,p]),y=(0,c.useCallback)(async b=>{u(!0);try{let c=await fetch(`/api/waste/alerts/${encodeURIComponent(b)}?windowDays=${a}`);if(!c.ok)throw Error("Failed to load detail");let d=await c.json();s(d)}finally{u(!1)}},[a]);(0,c.useEffect)(()=>{x()},[x]),(0,c.useEffect)(()=>{p?y(p):s(null)},[p,y]);let z=(0,c.useMemo)(()=>n?.alerts??[],[n]);return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex flex-wrap items-end justify-between gap-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-2xl font-semibold tracking-tight",children:"Waste Detection"}),(0,b.jsx)("p",{className:"mt-1 text-sm text-zinc-600",children:"Flagged spend with evidence and a recommended next step."})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("label",{className:"text-sm text-zinc-600",children:"Window"}),(0,b.jsxs)("select",{value:a,onChange:a=>i(Number(a.target.value)),className:"rounded-lg border border-zinc-200 bg-white px-3 py-2 text-sm",children:[(0,b.jsx)("option",{value:7,children:"Last 7 days"}),(0,b.jsx)("option",{value:14,children:"Last 14 days"}),(0,b.jsx)("option",{value:30,children:"Last 30 days"})]}),(0,b.jsx)("button",{onClick:()=>void x(),className:"rounded-lg bg-zinc-900 px-4 py-2 text-sm font-medium text-white hover:bg-zinc-800",children:"Refresh"})]})]}),l&&(0,b.jsx)("div",{className:"rounded-lg border border-red-200 bg-red-50 p-4 text-sm text-red-700",children:l}),(0,b.jsxs)("div",{className:"grid gap-4 lg:grid-cols-3",children:[(0,b.jsxs)("div",{className:"lg:col-span-2",children:[(0,b.jsxs)("div",{className:"mb-3 flex items-center justify-between rounded-xl border border-zinc-200 bg-white p-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"text-sm text-zinc-600",children:"Total wasted spend"}),(0,b.jsx)("div",{className:"mt-1 text-xl font-semibold text-zinc-900",children:j?"…":d(w)})]}),n&&(0,b.jsxs)("div",{className:"text-sm text-zinc-600",children:[e(n.alerts.length)," flagged item",1===n.alerts.length?"":"s"]})]}),(0,b.jsx)("div",{className:"overflow-hidden rounded-xl border border-zinc-200 bg-white",children:(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)("table",{className:"w-full min-w-[700px]",children:[(0,b.jsx)("thead",{className:"border-b border-zinc-100 bg-zinc-50",children:(0,b.jsxs)("tr",{children:[(0,b.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-zinc-500",children:"Entity"}),(0,b.jsx)("th",{className:"px-3 py-2 text-left text-xs font-medium text-zinc-500",children:"Type"}),(0,b.jsx)("th",{className:"px-3 py-2 text-left text-xs font-medium text-zinc-500",children:"Channel"}),(0,b.jsx)("th",{className:"px-3 py-2 text-left text-xs font-medium text-zinc-500",children:"Reason"}),(0,b.jsx)("th",{className:"px-3 py-2 text-right text-xs font-medium text-zinc-500",children:"Wasted $"}),(0,b.jsx)("th",{className:"px-3 py-2 text-right text-xs font-medium text-zinc-500",children:"Conv."}),(0,b.jsx)("th",{className:"px-3 py-2 text-left text-xs font-medium text-zinc-500",children:"Level"})]})}),(0,b.jsx)("tbody",{className:"divide-y divide-zinc-100",children:j?(0,b.jsx)("tr",{children:(0,b.jsx)("td",{colSpan:7,className:"px-4 py-8 text-center text-sm text-zinc-500",children:"Loading…"})}):0===z.length?(0,b.jsx)("tr",{children:(0,b.jsx)("td",{colSpan:7,className:"px-4 py-8 text-center text-sm text-zinc-500",children:"No waste items found."})}):z.map(a=>{let c=a.id===p;return(0,b.jsxs)("tr",{className:`cursor-pointer ${c?"bg-zinc-50":"hover:bg-zinc-50"}`,onClick:()=>q(a.id),children:[(0,b.jsx)("td",{className:"max-w-[260px] truncate px-4 py-3 text-sm font-medium text-zinc-900",children:a.entityName}),(0,b.jsx)("td",{className:"px-3 py-3 text-sm text-zinc-700",children:a.entityType.replace(/_/g," ")}),(0,b.jsx)("td",{className:"px-3 py-3 text-sm text-zinc-700",children:a.platformCode}),(0,b.jsx)("td",{className:"px-3 py-3 text-sm text-zinc-700 capitalize",children:h(a.reason)}),(0,b.jsx)("td",{className:"px-3 py-3 text-right text-sm text-zinc-700",children:d(f(a.spendMicros))}),(0,b.jsx)("td",{className:"px-3 py-3 text-right text-sm text-zinc-700",children:e(a.conversions)}),(0,b.jsx)("td",{className:"px-3 py-3",children:(0,b.jsx)("span",{className:`rounded-full px-2 py-0.5 text-xs font-medium ${g[a.level]??g.low}`,children:a.level})})]},a.id)})})]})})})]}),(0,b.jsx)("div",{children:(0,b.jsx)("div",{className:"sticky top-4",children:(0,b.jsxs)("div",{className:"rounded-xl border border-zinc-200 bg-white p-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("h2",{className:"text-sm font-medium text-zinc-900",children:"Why this is flagged"}),v&&(0,b.jsx)("span",{className:`rounded-full px-2 py-0.5 text-xs font-medium ${g[v.level]??g.low}`,children:v.level})]}),p?t?(0,b.jsx)("p",{className:"mt-3 text-sm text-zinc-500",children:"Loading…"}):r?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"mt-3",children:[(0,b.jsx)("div",{className:"text-sm font-medium text-zinc-900",children:r.alert.entityName}),(0,b.jsxs)("div",{className:"mt-1 text-xs text-zinc-500",children:[r.alert.platformCode," · ",r.alert.entityType.replace(/_/g," ")]})]}),(0,b.jsxs)("div",{className:"mt-4 rounded-lg border border-zinc-200 bg-zinc-50 p-3",children:[(0,b.jsx)("div",{className:"text-xs font-medium text-zinc-600",children:"Evidence"}),(0,b.jsxs)("div",{className:"mt-2 space-y-1 text-sm text-zinc-700",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-zinc-500",children:"Reason:"})," ",h(r.alert.reason)]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-zinc-500",children:"Wasted spend:"})," ",d(f(r.alert.spendMicros))]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-zinc-500",children:"Conversions:"})," ",e(r.alert.conversions)]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-zinc-500",children:"CPA:"})," ",null!==r.alert.cpa?d(r.alert.cpa):"—"]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("span",{className:"text-zinc-500",children:"Target CPA:"})," ",null!==r.alert.targetCpa?d(r.alert.targetCpa):"—"]})]})]}),(0,b.jsxs)("div",{className:"mt-4",children:[(0,b.jsx)("div",{className:"text-xs font-medium text-zinc-600",children:"Recommended actions"}),(0,b.jsx)("div",{className:"mt-2 space-y-2",children:r.recommendedActions.map(a=>(0,b.jsxs)("div",{className:"rounded-lg border border-zinc-200 p-3",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("div",{className:"text-sm font-medium text-zinc-900",children:a.title}),(0,b.jsx)("span",{className:`rounded-full px-2 py-0.5 text-xs font-medium ${"high"===a.severity?"bg-red-100 text-red-700":"medium"===a.severity?"bg-yellow-100 text-yellow-700":"bg-zinc-100 text-zinc-700"}`,children:a.severity})]}),(0,b.jsx)("div",{className:"mt-1 text-sm text-zinc-600",children:a.description})]},a.key))})]}),(0,b.jsxs)("details",{className:"mt-4",children:[(0,b.jsx)("summary",{className:"cursor-pointer text-sm font-medium text-zinc-700",children:"Explainability JSON"}),(0,b.jsx)("pre",{className:"mt-2 max-h-[280px] overflow-auto rounded-lg border border-zinc-200 bg-zinc-50 p-3 text-xs text-zinc-700",children:JSON.stringify(r.explainability,null,2)})]})]}):(0,b.jsx)("p",{className:"mt-3 text-sm text-zinc-500",children:"No detail available."}):(0,b.jsx)("p",{className:"mt-3 text-sm text-zinc-500",children:"Select an item to view details."})]})})})]})]})}a.s(["WasteClient",()=>i])}];

//# sourceMappingURL=1c0b7_windsurf-project_apps_frontend_src_app_app_waste_client_tsx_c154181a._.js.map