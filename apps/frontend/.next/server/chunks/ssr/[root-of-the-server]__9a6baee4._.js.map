{"version":3,"sources":["../../../../../../../../../../../OneDrive/Desktop/Optiq/CascadeProjects/windsurf-project/apps/frontend/src/app/app/settings/alerts/client.tsx/__nextjs-internal-proxy.mjs","../../../../../../../../../../../OneDrive/Desktop/Optiq/CascadeProjects/windsurf-project/apps/frontend/src/app/app/settings/alerts/page.tsx","../../../../../../../../../../../OneDrive/Desktop/Optiq/CascadeProjects/windsurf-project/apps/frontend/src/lib/settings/queries.ts","../../../../../../../../../../../OneDrive/Desktop/Optiq/CascadeProjects/windsurf-project/apps/frontend/src/lib/settings/types.ts"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const AlertSettingsPageClient = registerClientReference(\n    function() { throw new Error(\"Attempted to call AlertSettingsPageClient() from the server but AlertSettingsPageClient is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/OneDrive/Desktop/Optiq/CascadeProjects/windsurf-project/apps/frontend/src/app/app/settings/alerts/client.tsx\",\n    \"AlertSettingsPageClient\",\n);\n","import { getServerSession } from \"next-auth\";\r\nimport { redirect } from \"next/navigation\";\r\n\r\nimport { authOptions } from \"@/lib/auth\";\r\nimport { getAlertSettings } from \"@/lib/settings\";\r\nimport { AlertSettingsPageClient } from \"./client\";\r\n\r\nexport default async function AlertSettingsPage() {\r\n  const session = await getServerSession(authOptions);\r\n  const orgId = session?.user?.activeOrgId;\r\n\r\n  if (!orgId) {\r\n    redirect(\"/app\");\r\n  }\r\n\r\n  const settings = await getAlertSettings(orgId);\r\n\r\n  return <AlertSettingsPageClient initialSettings={settings} />;\r\n}\r\n","import \"server-only\";\r\n\r\nimport { prisma } from \"@/lib/prisma\";\r\nimport type { AlertSettings, AlertSettingsUpdate } from \"./types\";\r\nimport { DEFAULT_ALERT_SETTINGS } from \"./types\";\r\n\r\nexport async function getAlertSettings(organizationId: string): Promise<AlertSettings> {\r\n  const settings = await prisma.organizationSettings.findUnique({\r\n    where: { organizationId },\r\n  });\r\n\r\n  if (!settings) {\r\n    return {\r\n      organizationId,\r\n      ...DEFAULT_ALERT_SETTINGS,\r\n      updatedAt: new Date(),\r\n    };\r\n  }\r\n\r\n  const alertSettings = settings.alertSettings as Record<string, unknown> | null;\r\n\r\n  return {\r\n    organizationId,\r\n    wasteAlerts: {\r\n      enabled: (alertSettings?.wasteAlerts as Record<string, unknown>)?.enabled as boolean ?? DEFAULT_ALERT_SETTINGS.wasteAlerts.enabled,\r\n      thresholdLevel: (alertSettings?.wasteAlerts as Record<string, unknown>)?.thresholdLevel as AlertSettings[\"wasteAlerts\"][\"thresholdLevel\"] ?? DEFAULT_ALERT_SETTINGS.wasteAlerts.thresholdLevel,\r\n      notifyEmail: (alertSettings?.wasteAlerts as Record<string, unknown>)?.notifyEmail as boolean ?? DEFAULT_ALERT_SETTINGS.wasteAlerts.notifyEmail,\r\n      notifyInApp: (alertSettings?.wasteAlerts as Record<string, unknown>)?.notifyInApp as boolean ?? DEFAULT_ALERT_SETTINGS.wasteAlerts.notifyInApp,\r\n    },\r\n    cpaAlerts: {\r\n      enabled: (alertSettings?.cpaAlerts as Record<string, unknown>)?.enabled as boolean ?? DEFAULT_ALERT_SETTINGS.cpaAlerts.enabled,\r\n      targetCpa: (alertSettings?.cpaAlerts as Record<string, unknown>)?.targetCpa as number ?? DEFAULT_ALERT_SETTINGS.cpaAlerts.targetCpa,\r\n      warningThresholdPercent: (alertSettings?.cpaAlerts as Record<string, unknown>)?.warningThresholdPercent as number ?? DEFAULT_ALERT_SETTINGS.cpaAlerts.warningThresholdPercent,\r\n      criticalThresholdPercent: (alertSettings?.cpaAlerts as Record<string, unknown>)?.criticalThresholdPercent as number ?? DEFAULT_ALERT_SETTINGS.cpaAlerts.criticalThresholdPercent,\r\n      notifyEmail: (alertSettings?.cpaAlerts as Record<string, unknown>)?.notifyEmail as boolean ?? DEFAULT_ALERT_SETTINGS.cpaAlerts.notifyEmail,\r\n      notifyInApp: (alertSettings?.cpaAlerts as Record<string, unknown>)?.notifyInApp as boolean ?? DEFAULT_ALERT_SETTINGS.cpaAlerts.notifyInApp,\r\n    },\r\n    performanceAlerts: {\r\n      enabled: (alertSettings?.performanceAlerts as Record<string, unknown>)?.enabled as boolean ?? DEFAULT_ALERT_SETTINGS.performanceAlerts.enabled,\r\n      conversionDropPercent: (alertSettings?.performanceAlerts as Record<string, unknown>)?.conversionDropPercent as number ?? DEFAULT_ALERT_SETTINGS.performanceAlerts.conversionDropPercent,\r\n      windowDays: (alertSettings?.performanceAlerts as Record<string, unknown>)?.windowDays as number ?? DEFAULT_ALERT_SETTINGS.performanceAlerts.windowDays,\r\n      notifyEmail: (alertSettings?.performanceAlerts as Record<string, unknown>)?.notifyEmail as boolean ?? DEFAULT_ALERT_SETTINGS.performanceAlerts.notifyEmail,\r\n      notifyInApp: (alertSettings?.performanceAlerts as Record<string, unknown>)?.notifyInApp as boolean ?? DEFAULT_ALERT_SETTINGS.performanceAlerts.notifyInApp,\r\n    },\r\n    frequency: {\r\n      minIntervalMinutes: (alertSettings?.frequency as Record<string, unknown>)?.minIntervalMinutes as number ?? DEFAULT_ALERT_SETTINGS.frequency.minIntervalMinutes,\r\n      digestEnabled: (alertSettings?.frequency as Record<string, unknown>)?.digestEnabled as boolean ?? DEFAULT_ALERT_SETTINGS.frequency.digestEnabled,\r\n      digestFrequency: (alertSettings?.frequency as Record<string, unknown>)?.digestFrequency as AlertSettings[\"frequency\"][\"digestFrequency\"] ?? DEFAULT_ALERT_SETTINGS.frequency.digestFrequency,\r\n      digestTime: (alertSettings?.frequency as Record<string, unknown>)?.digestTime as string ?? DEFAULT_ALERT_SETTINGS.frequency.digestTime,\r\n    },\r\n    updatedAt: settings.updatedAt,\r\n  };\r\n}\r\n\r\nexport async function updateAlertSettings(\r\n  organizationId: string,\r\n  updates: AlertSettingsUpdate\r\n): Promise<AlertSettings> {\r\n  const current = await getAlertSettings(organizationId);\r\n\r\n  const merged = {\r\n    wasteAlerts: { ...current.wasteAlerts, ...updates.wasteAlerts },\r\n    cpaAlerts: { ...current.cpaAlerts, ...updates.cpaAlerts },\r\n    performanceAlerts: { ...current.performanceAlerts, ...updates.performanceAlerts },\r\n    frequency: { ...current.frequency, ...updates.frequency },\r\n  };\r\n\r\n  await prisma.organizationSettings.upsert({\r\n    where: { organizationId },\r\n    create: {\r\n      organizationId,\r\n      alertSettings: merged,\r\n    },\r\n    update: {\r\n      alertSettings: merged,\r\n    },\r\n  });\r\n\r\n  return getAlertSettings(organizationId);\r\n}\r\n","import \"server-only\";\r\n\r\nexport interface AlertSettings {\r\n  organizationId: string;\r\n  \r\n  wasteAlerts: {\r\n    enabled: boolean;\r\n    thresholdLevel: \"low\" | \"medium\" | \"high\" | \"critical\";\r\n    notifyEmail: boolean;\r\n    notifyInApp: boolean;\r\n  };\r\n\r\n  cpaAlerts: {\r\n    enabled: boolean;\r\n    targetCpa: number;\r\n    warningThresholdPercent: number;\r\n    criticalThresholdPercent: number;\r\n    notifyEmail: boolean;\r\n    notifyInApp: boolean;\r\n  };\r\n\r\n  performanceAlerts: {\r\n    enabled: boolean;\r\n    conversionDropPercent: number;\r\n    windowDays: number;\r\n    notifyEmail: boolean;\r\n    notifyInApp: boolean;\r\n  };\r\n\r\n  frequency: {\r\n    minIntervalMinutes: number;\r\n    digestEnabled: boolean;\r\n    digestFrequency: \"daily\" | \"weekly\";\r\n    digestTime: string;\r\n  };\r\n\r\n  updatedAt: Date;\r\n}\r\n\r\nexport const DEFAULT_ALERT_SETTINGS: Omit<AlertSettings, \"organizationId\" | \"updatedAt\"> = {\r\n  wasteAlerts: {\r\n    enabled: true,\r\n    thresholdLevel: \"medium\",\r\n    notifyEmail: true,\r\n    notifyInApp: true,\r\n  },\r\n  cpaAlerts: {\r\n    enabled: true,\r\n    targetCpa: 25,\r\n    warningThresholdPercent: 50,\r\n    criticalThresholdPercent: 100,\r\n    notifyEmail: true,\r\n    notifyInApp: true,\r\n  },\r\n  performanceAlerts: {\r\n    enabled: true,\r\n    conversionDropPercent: 50,\r\n    windowDays: 7,\r\n    notifyEmail: false,\r\n    notifyInApp: true,\r\n  },\r\n  frequency: {\r\n    minIntervalMinutes: 60,\r\n    digestEnabled: false,\r\n    digestFrequency: \"daily\",\r\n    digestTime: \"09:00\",\r\n  },\r\n};\r\n\r\nexport type AlertSettingsUpdate = Partial<Omit<AlertSettings, \"organizationId\" | \"updatedAt\">>;\r\n"],"names":[],"mappings":"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","ignoreList":[0]}