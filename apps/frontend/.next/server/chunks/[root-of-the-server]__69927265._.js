module.exports=[12941,e=>{"use strict";e.i(42960);var t=e.i(91490);e.s(["PLAN_DEFINITIONS",()=>t.PLAN_DEFINITIONS,"calculateOverages",()=>t.calculateOverages])},33405,(e,t,r)=>{t.exports=e.x("child_process",()=>require("child_process"))},12160,(e,t,r)=>{"use strict";var n=Object.prototype.toString,a=Math.max,i=function(e,t){for(var r=[],n=0;n<e.length;n+=1)r[n]=e[n];for(var a=0;a<t.length;a+=1)r[a+e.length]=t[a];return r},o=function(e,t){for(var r=[],n=t||0,a=0;n<e.length;n+=1,a+=1)r[a]=e[n];return r},s=function(e,t){for(var r="",n=0;n<e.length;n+=1)r+=e[n],n+1<e.length&&(r+=t);return r};t.exports=function(e){var t,r=this;if("function"!=typeof r||"[object Function]"!==n.apply(r))throw TypeError("Function.prototype.bind called on incompatible "+r);for(var l=o(arguments,1),u=a(0,r.length-l.length),c=[],d=0;d<u;d++)c[d]="$"+d;if(t=Function("binder","return function ("+s(c,",")+"){ return binder.apply(this,arguments); }")(function(){if(this instanceof t){var n=r.apply(this,i(l,arguments));return Object(n)===n?n:this}return r.apply(e,i(l,arguments))}),r.prototype){var p=function(){};p.prototype=r.prototype,t.prototype=new p,p.prototype=null}return t}},42804,(e,t,r)=>{"use strict";var n=e.r(12160);t.exports=Function.prototype.bind||n},51761,(e,t,r)=>{"use strict";var n=Function.prototype.call,a=Object.prototype.hasOwnProperty;t.exports=e.r(42804).call(n,a)},26204,e=>{"use strict";var t=e.i(56884),r=e.i(42064),n=e.i(1824),a=e.i(99326),i=e.i(18794),o=e.i(83629),s=e.i(41446),l=e.i(61251),u=e.i(5708),c=e.i(59092),d=e.i(99563),p=e.i(39870),h=e.i(8016),f=e.i(7624),R=e.i(70065),v=e.i(36141),g=e.i(93695);e.i(58762);var m=e.i(24378),w=e.i(70081),E=e.i(68050),y=e.i(46989),C=e.i(16336),x=e.i(60806);e.i(24060);var b=e.i(35515),N=e.i(94180);let A=y.z.object({tier:y.z.enum(["STARTER","GROWTH","SCALE"]),interval:y.z.enum(["monthly","annual"]).default("monthly")});async function I(e){if(!(0,N.isStripeConfigured)())return w.NextResponse.json({error:"Stripe is not configured"},{status:503});let t=await (0,E.getServerSession)(C.authOptions),r=t?.user?.id,n=t?.user?.activeOrgId;if(!r||!n)return w.NextResponse.json({error:"unauthorized"},{status:401});let a=await e.json().catch(()=>null),i=A.safeParse(a);if(!i.success)return w.NextResponse.json({error:"invalid_params"},{status:400});let{tier:o,interval:s}=i.data,l=(0,N.getPriceId)(o,s);if(!l)return w.NextResponse.json({error:"invalid_plan"},{status:400});try{let e=await x.prisma.subscription.findUnique({where:{organizationId:n},select:{stripeCustomerId:!0}}),t=e?.stripeCustomerId;if(!t){let e=await x.prisma.user.findUnique({where:{id:r},select:{email:!0,name:!0}});if(!e?.email)return w.NextResponse.json({error:"user_email_required"},{status:400});t=(await (0,b.createCustomer)({email:e.email,name:e.name??void 0,organizationId:n})).id,await x.prisma.subscription.upsert({where:{organizationId:n},create:{organizationId:n,plan:"FREE",status:"ACTIVE",stripeCustomerId:t,currentPeriodStart:new Date,currentPeriodEnd:new Date(Date.now()+2592e6)},update:{stripeCustomerId:t}})}let a=await (0,b.createCheckoutSession)({customerId:t,priceId:l,organizationId:n,trialDays:"STARTER"===o?14:void 0});return w.NextResponse.json({checkoutUrl:a.url,sessionId:a.id})}catch(e){return console.error("Checkout error:",e),w.NextResponse.json({error:"checkout_failed"},{status:500})}}e.s(["POST",()=>I],35514);var O=e.i(35514);let T=new t.AppRouteRouteModule({definition:{kind:r.RouteKind.APP_ROUTE,page:"/api/billing/checkout/route",pathname:"/api/billing/checkout",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/OneDrive/Desktop/Optiq/CascadeProjects/windsurf-project/apps/frontend/src/app/api/billing/checkout/route.ts",nextConfigOutput:"",userland:O}),{workAsyncStorage:S,workUnitAsyncStorage:P,serverHooks:_}=T;function j(){return(0,n.patchFetch)({workAsyncStorage:S,workUnitAsyncStorage:P})}async function k(e,t,n){T.isDev&&(0,a.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let w="/api/billing/checkout/route";w=w.replace(/\/index$/,"")||"/";let E=await T.prepare(e,t,{srcPage:w,multiZoneDraftMode:!1});if(!E)return t.statusCode=400,t.end("Bad Request"),null==n.waitUntil||n.waitUntil.call(n,Promise.resolve()),null;let{buildId:y,params:C,nextConfig:x,parsedUrl:b,isDraftMode:N,prerenderManifest:A,routerServerContext:I,isOnDemandRevalidate:O,revalidateOnlyGenerated:S,resolvedPathname:P,clientReferenceManifest:_,serverActionsManifest:j}=E,k=(0,l.normalizeAppPath)(w),D=!!(A.dynamicRoutes[k]||A.routes[P]),q=async()=>((null==I?void 0:I.render404)?await I.render404(e,t,b,!1):t.end("This page could not be found"),null);if(D&&!N){let e=!!A.routes[P],t=A.dynamicRoutes[k];if(t&&!1===t.fallback&&!e){if(x.experimental.adapterPath)return await q();throw new g.NoFallbackError}}let U=null;!D||T.isDev||N||(U="/index"===(U=P)?"/":U);let H=!0===T.isDev||!D,M=D&&!H;j&&_&&(0,o.setReferenceManifestsSingleton)({page:w,clientReferenceManifest:_,serverActionsManifest:j,serverModuleMap:(0,s.createServerModuleMap)({serverActionsManifest:j})});let F=e.method||"GET",z=(0,i.getTracer)(),$=z.getActiveScopeSpan(),K={params:C,prerenderManifest:A,renderOpts:{experimental:{authInterrupts:!!x.experimental.authInterrupts},cacheComponents:!!x.cacheComponents,supportsDynamicResponse:H,incrementalCache:(0,a.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:x.cacheLife,waitUntil:n.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,r,n)=>T.onRequestError(e,t,n,I)},sharedContext:{buildId:y}},L=new u.NodeNextRequest(e),B=new u.NodeNextResponse(t),G=c.NextRequestAdapter.fromNodeNextRequest(L,(0,c.signalFromNodeResponse)(t));try{let o=async e=>T.handle(G,K).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let r=z.getRootSpanAttributes();if(!r)return;if(r.get("next.span_type")!==d.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${r.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let n=r.get("next.route");if(n){let t=`${F} ${n}`;e.setAttributes({"next.route":n,"http.route":n,"next.span_name":t}),e.updateName(t)}else e.updateName(`${F} ${w}`)}),s=!!(0,a.getRequestMeta)(e,"minimalMode"),l=async a=>{var i,l;let u=async({previousCacheEntry:r})=>{try{if(!s&&O&&S&&!r)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let i=await o(a);e.fetchMetrics=K.renderOpts.fetchMetrics;let l=K.renderOpts.pendingWaitUntil;l&&n.waitUntil&&(n.waitUntil(l),l=void 0);let u=K.renderOpts.collectedTags;if(!D)return await (0,h.sendResponse)(L,B,i,K.renderOpts.pendingWaitUntil),null;{let e=await i.blob(),t=(0,f.toNodeOutgoingHttpHeaders)(i.headers);u&&(t[v.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let r=void 0!==K.renderOpts.collectedRevalidate&&!(K.renderOpts.collectedRevalidate>=v.INFINITE_CACHE)&&K.renderOpts.collectedRevalidate,n=void 0===K.renderOpts.collectedExpire||K.renderOpts.collectedExpire>=v.INFINITE_CACHE?void 0:K.renderOpts.collectedExpire;return{value:{kind:m.CachedRouteKind.APP_ROUTE,status:i.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:r,expire:n}}}}catch(t){throw(null==r?void 0:r.isStale)&&await T.onRequestError(e,t,{routerKind:"App Router",routePath:w,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:M,isOnDemandRevalidate:O})},I),t}},c=await T.handleResponse({req:e,nextConfig:x,cacheKey:U,routeKind:r.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:A,isRoutePPREnabled:!1,isOnDemandRevalidate:O,revalidateOnlyGenerated:S,responseGenerator:u,waitUntil:n.waitUntil,isMinimalMode:s});if(!D)return null;if((null==c||null==(i=c.value)?void 0:i.kind)!==m.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==c||null==(l=c.value)?void 0:l.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});s||t.setHeader("x-nextjs-cache",O?"REVALIDATED":c.isMiss?"MISS":c.isStale?"STALE":"HIT"),N&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let d=(0,f.fromNodeOutgoingHttpHeaders)(c.value.headers);return s&&D||d.delete(v.NEXT_CACHE_TAGS_HEADER),!c.cacheControl||t.getHeader("Cache-Control")||d.get("Cache-Control")||d.set("Cache-Control",(0,R.getCacheControlHeader)(c.cacheControl)),await (0,h.sendResponse)(L,B,new Response(c.value.body,{headers:d,status:c.value.status||200})),null};$?await l($):await z.withPropagatedContext(e.headers,()=>z.trace(d.BaseServerSpan.handleRequest,{spanName:`${F} ${w}`,kind:i.SpanKind.SERVER,attributes:{"http.method":F,"http.target":e.url}},l))}catch(t){if(t instanceof g.NoFallbackError||await T.onRequestError(e,t,{routerKind:"App Router",routePath:k,routeType:"route",revalidateReason:(0,p.getRevalidateReason)({isStaticGeneration:M,isOnDemandRevalidate:O})}),D)throw t;return await (0,h.sendResponse)(L,B,new Response(null,{status:500})),null}}e.s(["handler",()=>k,"patchFetch",()=>j,"routeModule",()=>T,"serverHooks",()=>_,"workAsyncStorage",()=>S,"workUnitAsyncStorage",()=>P],26204)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__69927265._.js.map