(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,16096,e=>{"use strict";var t=e.i(15442),s=e.i(30320);function i(e){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}).format(e)}function l(e){return new Intl.NumberFormat("en-US").format(e)}function n(e){return Number(e)/1e6}let a={critical:"bg-red-100 text-red-700",high:"bg-orange-100 text-orange-700",medium:"bg-yellow-100 text-yellow-700",low:"bg-zinc-100 text-zinc-700",none:"bg-zinc-100 text-zinc-700"};function c(e){return e.replace(/_/g," ")}function r(){let[e,r]=(0,s.useState)(7),[d,x]=(0,s.useState)(!0),[m,o]=(0,s.useState)(null),[h,p]=(0,s.useState)(null),[u,j]=(0,s.useState)(null),[N,g]=(0,s.useState)(null),[f,v]=(0,s.useState)(!1),y=(0,s.useMemo)(()=>h&&u?h.alerts.find(e=>e.id===u)??null:null,[h,u]),b=h?n(h.totals.totalWastedSpendMicros):0,z=(0,s.useCallback)(async()=>{x(!0),o(null);try{let t=await fetch(`/api/waste/alerts?windowDays=${e}`);if(!t.ok)throw Error("Failed to load waste alerts");let s=await t.json();p(s),s.alerts.length>0&&!u&&j(s.alerts[0].id)}catch(e){o(e instanceof Error?e.message:"Unknown error")}finally{x(!1)}},[e,u]),w=(0,s.useCallback)(async t=>{v(!0);try{let s=await fetch(`/api/waste/alerts/${encodeURIComponent(t)}?windowDays=${e}`);if(!s.ok)throw Error("Failed to load detail");let i=await s.json();g(i)}finally{v(!1)}},[e]);(0,s.useEffect)(()=>{z()},[z]),(0,s.useEffect)(()=>{u?w(u):g(null)},[u,w]);let C=(0,s.useMemo)(()=>h?.alerts??[],[h]);return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex flex-wrap items-end justify-between gap-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl font-semibold tracking-tight",children:"Waste Detection"}),(0,t.jsx)("p",{className:"mt-1 text-sm text-zinc-600",children:"Flagged spend with evidence and a recommended next step."})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("label",{className:"text-sm text-zinc-600",children:"Window"}),(0,t.jsxs)("select",{value:e,onChange:e=>r(Number(e.target.value)),className:"rounded-lg border border-zinc-200 bg-white px-3 py-2 text-sm",children:[(0,t.jsx)("option",{value:7,children:"Last 7 days"}),(0,t.jsx)("option",{value:14,children:"Last 14 days"}),(0,t.jsx)("option",{value:30,children:"Last 30 days"})]}),(0,t.jsx)("button",{onClick:()=>void z(),className:"rounded-lg bg-zinc-900 px-4 py-2 text-sm font-medium text-white hover:bg-zinc-800",children:"Refresh"})]})]}),m&&(0,t.jsx)("div",{className:"rounded-lg border border-red-200 bg-red-50 p-4 text-sm text-red-700",children:m}),(0,t.jsxs)("div",{className:"grid gap-4 lg:grid-cols-3",children:[(0,t.jsxs)("div",{className:"lg:col-span-2",children:[(0,t.jsxs)("div",{className:"mb-3 flex items-center justify-between rounded-xl border border-zinc-200 bg-white p-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-sm text-zinc-600",children:"Total wasted spend"}),(0,t.jsx)("div",{className:"mt-1 text-xl font-semibold text-zinc-900",children:d?"…":i(b)})]}),h&&(0,t.jsxs)("div",{className:"text-sm text-zinc-600",children:[l(h.alerts.length)," flagged item",1===h.alerts.length?"":"s"]})]}),(0,t.jsx)("div",{className:"overflow-hidden rounded-xl border border-zinc-200 bg-white",children:(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)("table",{className:"w-full min-w-[700px]",children:[(0,t.jsx)("thead",{className:"border-b border-zinc-100 bg-zinc-50",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-zinc-500",children:"Entity"}),(0,t.jsx)("th",{className:"px-3 py-2 text-left text-xs font-medium text-zinc-500",children:"Type"}),(0,t.jsx)("th",{className:"px-3 py-2 text-left text-xs font-medium text-zinc-500",children:"Channel"}),(0,t.jsx)("th",{className:"px-3 py-2 text-left text-xs font-medium text-zinc-500",children:"Reason"}),(0,t.jsx)("th",{className:"px-3 py-2 text-right text-xs font-medium text-zinc-500",children:"Wasted $"}),(0,t.jsx)("th",{className:"px-3 py-2 text-right text-xs font-medium text-zinc-500",children:"Conv."}),(0,t.jsx)("th",{className:"px-3 py-2 text-left text-xs font-medium text-zinc-500",children:"Level"})]})}),(0,t.jsx)("tbody",{className:"divide-y divide-zinc-100",children:d?(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:7,className:"px-4 py-8 text-center text-sm text-zinc-500",children:"Loading…"})}):0===C.length?(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:7,className:"px-4 py-8 text-center text-sm text-zinc-500",children:"No waste items found."})}):C.map(e=>{let s=e.id===u;return(0,t.jsxs)("tr",{className:`cursor-pointer ${s?"bg-zinc-50":"hover:bg-zinc-50"}`,onClick:()=>j(e.id),children:[(0,t.jsx)("td",{className:"max-w-[260px] truncate px-4 py-3 text-sm font-medium text-zinc-900",children:e.entityName}),(0,t.jsx)("td",{className:"px-3 py-3 text-sm text-zinc-700",children:e.entityType.replace(/_/g," ")}),(0,t.jsx)("td",{className:"px-3 py-3 text-sm text-zinc-700",children:e.platformCode}),(0,t.jsx)("td",{className:"px-3 py-3 text-sm text-zinc-700 capitalize",children:c(e.reason)}),(0,t.jsx)("td",{className:"px-3 py-3 text-right text-sm text-zinc-700",children:i(n(e.spendMicros))}),(0,t.jsx)("td",{className:"px-3 py-3 text-right text-sm text-zinc-700",children:l(e.conversions)}),(0,t.jsx)("td",{className:"px-3 py-3",children:(0,t.jsx)("span",{className:`rounded-full px-2 py-0.5 text-xs font-medium ${a[e.level]??a.low}`,children:e.level})})]},e.id)})})]})})})]}),(0,t.jsx)("div",{children:(0,t.jsx)("div",{className:"sticky top-4",children:(0,t.jsxs)("div",{className:"rounded-xl border border-zinc-200 bg-white p-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("h2",{className:"text-sm font-medium text-zinc-900",children:"Why this is flagged"}),y&&(0,t.jsx)("span",{className:`rounded-full px-2 py-0.5 text-xs font-medium ${a[y.level]??a.low}`,children:y.level})]}),u?f?(0,t.jsx)("p",{className:"mt-3 text-sm text-zinc-500",children:"Loading…"}):N?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"mt-3",children:[(0,t.jsx)("div",{className:"text-sm font-medium text-zinc-900",children:N.alert.entityName}),(0,t.jsxs)("div",{className:"mt-1 text-xs text-zinc-500",children:[N.alert.platformCode," · ",N.alert.entityType.replace(/_/g," ")]})]}),(0,t.jsxs)("div",{className:"mt-4 rounded-lg border border-zinc-200 bg-zinc-50 p-3",children:[(0,t.jsx)("div",{className:"text-xs font-medium text-zinc-600",children:"Evidence"}),(0,t.jsxs)("div",{className:"mt-2 space-y-1 text-sm text-zinc-700",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-zinc-500",children:"Reason:"})," ",c(N.alert.reason)]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-zinc-500",children:"Wasted spend:"})," ",i(n(N.alert.spendMicros))]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-zinc-500",children:"Conversions:"})," ",l(N.alert.conversions)]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-zinc-500",children:"CPA:"})," ",null!==N.alert.cpa?i(N.alert.cpa):"—"]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-zinc-500",children:"Target CPA:"})," ",null!==N.alert.targetCpa?i(N.alert.targetCpa):"—"]})]})]}),(0,t.jsxs)("div",{className:"mt-4",children:[(0,t.jsx)("div",{className:"text-xs font-medium text-zinc-600",children:"Recommended actions"}),(0,t.jsx)("div",{className:"mt-2 space-y-2",children:N.recommendedActions.map(e=>(0,t.jsxs)("div",{className:"rounded-lg border border-zinc-200 p-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("div",{className:"text-sm font-medium text-zinc-900",children:e.title}),(0,t.jsx)("span",{className:`rounded-full px-2 py-0.5 text-xs font-medium ${"high"===e.severity?"bg-red-100 text-red-700":"medium"===e.severity?"bg-yellow-100 text-yellow-700":"bg-zinc-100 text-zinc-700"}`,children:e.severity})]}),(0,t.jsx)("div",{className:"mt-1 text-sm text-zinc-600",children:e.description})]},e.key))})]}),(0,t.jsxs)("details",{className:"mt-4",children:[(0,t.jsx)("summary",{className:"cursor-pointer text-sm font-medium text-zinc-700",children:"Explainability JSON"}),(0,t.jsx)("pre",{className:"mt-2 max-h-[280px] overflow-auto rounded-lg border border-zinc-200 bg-zinc-50 p-3 text-xs text-zinc-700",children:JSON.stringify(N.explainability,null,2)})]})]}):(0,t.jsx)("p",{className:"mt-3 text-sm text-zinc-500",children:"No detail available."}):(0,t.jsx)("p",{className:"mt-3 text-sm text-zinc-500",children:"Select an item to view details."})]})})})]})]})}e.s(["WasteClient",()=>r])}]);