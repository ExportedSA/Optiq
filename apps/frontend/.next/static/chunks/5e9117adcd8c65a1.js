(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,61417,e=>{"use strict";var t=e.i(15442),s=e.i(35560),n=e.i(30320),i=e.i(97312);function l(e){return new Intl.NumberFormat("en-US").format(e)}function a(){var e;let s=(0,i.useRouter)(),a=(0,i.useSearchParams)(),[c,d]=(0,n.useState)([]),[o,m]=(0,n.useState)(null),[x,u]=(0,n.useState)(!0),[h,g]=(0,n.useState)(null),[p,b]=(0,n.useState)("monthly"),[v,j]=(0,n.useState)(null),f=(0,n.useCallback)(async()=>{u(!0);try{let[e,t]=await Promise.all([fetch("/api/billing/plans"),fetch("/api/billing/usage")]);if(e.ok){let t=await e.json();d(t.plans??[])}if(t.ok){let e=await t.json();m(e)}}finally{u(!1)}},[]);(0,n.useEffect)(()=>{f()},[f]),(0,n.useEffect)(()=>{a?.get("success")==="true"&&(j("Your subscription has been updated successfully!"),s.replace("/app/settings/billing"),f()),a?.get("canceled")==="true"&&s.replace("/app/settings/billing")},[a,s,f]);let N=async e=>{g(e);try{let t=await fetch("/api/billing/checkout",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tier:e,interval:p})});if(t.ok){let e=await t.json();e.checkoutUrl&&(window.location.href=e.checkoutUrl)}else{let e=await t.json();alert(e.error||"Failed to start checkout")}}finally{g(null)}},y=async()=>{try{let e=await fetch("/api/billing/portal",{method:"POST"});if(e.ok){let t=await e.json();t.portalUrl&&(window.location.href=t.portalUrl)}}catch{alert("Failed to open billing portal")}};return c.find(e=>e.tier===o?.plan)??c[0],(0,t.jsxs)("div",{className:"space-y-8",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl font-semibold tracking-tight",children:"Billing & Plans"}),(0,t.jsx)("p",{className:"mt-1 text-sm text-zinc-600",children:"Manage your subscription and view usage"})]}),o&&(0,t.jsxs)("section",{className:"rounded-xl border border-zinc-200 bg-white p-6",children:[(0,t.jsx)("h2",{className:"text-lg font-medium text-zinc-900",children:"Current Usage"}),(0,t.jsxs)("p",{className:"mt-1 text-sm text-zinc-500",children:["Billing period: ",new Date(o.periodStart).toLocaleDateString()," – ",new Date(o.periodEnd).toLocaleDateString()]}),(0,t.jsxs)("div",{className:"mt-6 grid gap-4 sm:grid-cols-3",children:[(0,t.jsx)(r,{label:"Tracked Events",current:o.usage.trackedEvents,limit:o.limits.monthlyEventLimit}),(0,t.jsx)(r,{label:"Connected Accounts",current:o.usage.connectedAccounts,limit:o.limits.maxConnectors}),(0,t.jsx)(r,{label:"Workspaces",current:o.usage.workspacesUsed,limit:o.limits.maxWorkspaces})]}),o.overages.totalOverageCents>0&&(0,t.jsxs)("div",{className:"mt-4 rounded-lg border border-yellow-200 bg-yellow-50 p-4",children:[(0,t.jsx)("div",{className:"text-sm font-medium text-yellow-800",children:"Estimated overage charges this period"}),(0,t.jsx)("div",{className:"mt-1 text-lg font-semibold text-yellow-900",children:(e=o.overages.totalOverageCents,new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(e/100))}),(0,t.jsxs)("div",{className:"mt-1 text-xs text-yellow-700",children:[o.overages.eventsOverage>0&&(0,t.jsxs)("span",{children:[l(o.overages.eventsOverage)," events over limit • "]}),o.overages.connectorsOverage>0&&(0,t.jsxs)("span",{children:[o.overages.connectorsOverage," connectors over limit"]})]})]})]}),(0,t.jsxs)("section",{children:[(0,t.jsxs)("div",{className:"mb-6 flex items-center justify-between",children:[(0,t.jsx)("h2",{className:"text-lg font-medium text-zinc-900",children:"Plans"}),(0,t.jsxs)("div",{className:"flex rounded-lg border border-zinc-200 bg-zinc-50 p-1",children:[(0,t.jsx)("button",{onClick:()=>b("monthly"),className:`rounded-md px-3 py-1 text-sm font-medium transition-colors ${"monthly"===p?"bg-white text-zinc-900 shadow-sm":"text-zinc-600 hover:text-zinc-900"}`,children:"Monthly"}),(0,t.jsxs)("button",{onClick:()=>b("annual"),className:`rounded-md px-3 py-1 text-sm font-medium transition-colors ${"annual"===p?"bg-white text-zinc-900 shadow-sm":"text-zinc-600 hover:text-zinc-900"}`,children:["Annual ",(0,t.jsx)("span",{className:"text-green-600",children:"Save 20%"})]})]})]}),x?(0,t.jsx)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[1,2,3,4].map(e=>(0,t.jsx)("div",{className:"h-[400px] animate-pulse rounded-xl bg-zinc-100"},e))}):(0,t.jsx)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:c.map(e=>{let s=e.tier===o?.plan,n="monthly"===p?e.pricing.monthly:e.pricing.annualMonthly;return(0,t.jsxs)("div",{className:`relative flex flex-col rounded-xl border p-6 ${e.recommended?"border-blue-500 ring-2 ring-blue-500":"border-zinc-200"} ${s?"bg-zinc-50":"bg-white"}`,children:[e.recommended&&(0,t.jsx)("div",{className:"absolute -top-3 left-1/2 -translate-x-1/2 rounded-full bg-blue-500 px-3 py-1 text-xs font-medium text-white",children:"Recommended"}),(0,t.jsxs)("div",{className:"mb-4",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-zinc-900",children:e.name}),(0,t.jsx)("p",{className:"mt-1 text-sm text-zinc-500",children:e.description})]}),(0,t.jsxs)("div",{className:"mb-6",children:[(0,t.jsxs)("span",{className:"text-3xl font-bold text-zinc-900",children:["$",n.toFixed(0)]}),(0,t.jsx)("span",{className:"text-zinc-500",children:"/mo"}),"annual"===p&&e.pricing.monthly>0&&(0,t.jsxs)("div",{className:"mt-1 text-xs text-zinc-500",children:["Billed annually ($",e.pricing.annual.toFixed(0),"/yr)"]})]}),(0,t.jsx)("ul",{className:"mb-6 flex-1 space-y-2",children:e.features.map((e,s)=>(0,t.jsxs)("li",{className:"flex items-start gap-2 text-sm text-zinc-600",children:[(0,t.jsx)("span",{className:"text-green-500",children:"✓"}),e]},s))}),e.overages.eventsPer10k>0&&(0,t.jsxs)("div",{className:"mb-4 rounded-lg bg-zinc-50 p-3 text-xs text-zinc-600",children:[(0,t.jsx)("div",{children:"Overages:"}),(0,t.jsxs)("div",{children:["$",e.overages.eventsPer10k.toFixed(2)," per 10k events"]}),(0,t.jsxs)("div",{children:["$",e.overages.connector.toFixed(2)," per extra connector"]})]}),(0,t.jsx)("button",{disabled:s||h===e.tier||"FREE"===e.tier,onClick:()=>N(e.tier),className:`w-full rounded-lg px-4 py-2 text-sm font-medium transition-colors ${s?"cursor-default bg-zinc-100 text-zinc-500":e.recommended?"bg-blue-600 text-white hover:bg-blue-700 disabled:opacity-50":"bg-zinc-900 text-white hover:bg-zinc-800 disabled:opacity-50"}`,children:h===e.tier?"Redirecting...":s?"Current Plan":"FREE"===e.tier?"Free":"Upgrade"})]},e.tier)})})]}),o?.plan&&"FREE"!==o.plan&&(0,t.jsxs)("section",{className:"rounded-xl border border-zinc-200 bg-white p-6",children:[(0,t.jsx)("h2",{className:"text-lg font-medium text-zinc-900",children:"Manage Subscription"}),(0,t.jsx)("p",{className:"mt-1 text-sm text-zinc-500",children:"Update payment method, view invoices, or cancel your subscription"}),(0,t.jsx)("button",{onClick:y,className:"mt-4 rounded-lg border border-zinc-300 bg-white px-4 py-2 text-sm font-medium text-zinc-700 hover:bg-zinc-50",children:"Open Billing Portal"})]}),v&&(0,t.jsx)("div",{className:"fixed bottom-4 right-4 rounded-lg border border-green-200 bg-green-50 p-4 shadow-lg",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-green-600",children:"✓"}),(0,t.jsx)("span",{className:"text-sm text-green-800",children:v}),(0,t.jsx)("button",{onClick:()=>j(null),className:"ml-2 text-green-600 hover:text-green-800",children:"×"})]})}),(0,t.jsxs)("section",{className:"rounded-xl border border-zinc-200 bg-white p-6",children:[(0,t.jsx)("h2",{className:"text-lg font-medium text-zinc-900",children:"Value Metrics"}),(0,t.jsx)("p",{className:"mt-1 text-sm text-zinc-500",children:"Your plan is based on tracked events and connected ad accounts"}),(0,t.jsxs)("div",{className:"mt-4 grid gap-4 sm:grid-cols-2",children:[(0,t.jsxs)("div",{className:"rounded-lg border border-zinc-100 p-4",children:[(0,t.jsx)("div",{className:"text-sm font-medium text-zinc-700",children:"Tracked Events"}),(0,t.jsx)("div",{className:"mt-1 text-xs text-zinc-500",children:"Every page view, conversion, and custom event counts toward your monthly limit. Overages are billed per 10,000 events."})]}),(0,t.jsxs)("div",{className:"rounded-lg border border-zinc-100 p-4",children:[(0,t.jsx)("div",{className:"text-sm font-medium text-zinc-700",children:"Connected Ad Accounts"}),(0,t.jsx)("div",{className:"mt-1 text-xs text-zinc-500",children:"Each connected Google, Meta, TikTok, or LinkedIn ad account counts toward your connector limit. Extra connectors can be added for a monthly fee."})]})]})]})]})}function r(e){let n,i,a,r,c,d,o,m,x,u=(0,s.c)(26),{label:h,current:g,limit:p}=e,b=-1===p,v=b?0:Math.min(100,g/p*100),j=!b&&g>p;u[0]!==h?(n=(0,t.jsx)("span",{className:"text-sm font-medium text-zinc-700",children:h}),u[0]=h,u[1]=n):n=u[1],u[2]!==g?(i=l(g),u[2]=g,u[3]=i):i=u[3],u[4]!==b||u[5]!==p?(a=b?"∞":l(p),u[4]=b,u[5]=p,u[6]=a):a=u[6],u[7]!==i||u[8]!==a?(r=(0,t.jsxs)("span",{className:"text-sm text-zinc-500",children:[i," / ",a]}),u[7]=i,u[8]=a,u[9]=r):r=u[9],u[10]!==n||u[11]!==r?(c=(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[n,r]}),u[10]=n,u[11]=r,u[12]=c):c=u[12];let f=`h-full rounded-full transition-all ${j?"bg-red-500":v>80?"bg-yellow-500":"bg-green-500"}`,N=`${Math.min(100,v)}%`;return u[13]!==N?(d={width:N},u[13]=N,u[14]=d):d=u[14],u[15]!==f||u[16]!==d?(o=(0,t.jsx)("div",{className:"mt-2 h-2 overflow-hidden rounded-full bg-zinc-100",children:(0,t.jsx)("div",{className:f,style:d})}),u[15]=f,u[16]=d,u[17]=o):o=u[17],u[18]!==g||u[19]!==j||u[20]!==p?(m=j&&(0,t.jsxs)("div",{className:"mt-1 text-xs text-red-600",children:[l(g-p)," over limit"]}),u[18]=g,u[19]=j,u[20]=p,u[21]=m):m=u[21],u[22]!==m||u[23]!==c||u[24]!==o?(x=(0,t.jsxs)("div",{className:"rounded-lg border border-zinc-100 p-4",children:[c,o,m]}),u[22]=m,u[23]=c,u[24]=o,u[25]=x):x=u[25],x}e.s(["BillingClient",()=>a])}]);