#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

echo "üîç Verifying package-lock.json integrity..."

# Check if package-lock.json has been modified
if git diff --cached --name-only | grep -q "package-lock.json"; then
  echo "üì¶ package-lock.json changed - verifying npm ci works..."
  
  # Run npm ci in dry-run mode to verify lock file integrity
  if npm ci --dry-run > /dev/null 2>&1; then
    echo "‚úÖ npm ci verification passed"
  else
    echo "‚ùå ERROR: npm ci failed - package-lock.json is out of sync"
    echo ""
    echo "To fix this issue:"
    echo "  1. Run: npm install"
    echo "  2. Add the updated package-lock.json: git add package-lock.json"
    echo "  3. Try committing again"
    echo ""
    exit 1
  fi
else
  echo "‚úÖ package-lock.json not modified - skipping verification"
fi

echo "‚úÖ Pre-commit checks passed"
